(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","diff_match_patch"],A)}else{A(CodeMirror)}}})(function(p){var a=p.Pos;var j="http://www.w3.org/2000/svg";function g(Ad,Ac){this.mv=Ad;this.type=Ac;this.classes=Ac=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}g.prototype={constructor:g,init:function(Ac,Af,Ad){this.edit=this.mv.edit;(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this);this.orig=p(Ac,C({value:Af,readOnly:!this.mv.options.allowEditingOriginals},C(Ad)));if(this.mv.options.connect=="align"){if(!this.edit.state.trackAlignable){this.edit.state.trackAlignable=new x(this.edit)}this.orig.state.trackAlignable=new x(this.orig)}this.orig.state.diffViews=[this];var Ae=Ad.chunkClassLocation||"background";if(Object.prototype.toString.call(Ae)!="[object Array]"){Ae=[Ae]}this.classes.classLocation=Ae;this.diff=R(J(Af),J(Ad.value));this.chunks=s(this.diff);this.diffOutOfDate=this.dealigned=false;this.needsScrollSync=null;this.showDifferences=Ad.showDifferences!==false},registerEvents:function(){this.forceUpdate=t(this);v(this,true,false);D(this)},setShowDifferences:function(Ac){Ac=Ac!==false;if(Ac!=this.showDifferences){this.showDifferences=Ac;this.forceUpdate("full")}}};function U(Ac){if(Ac.diffOutOfDate){Ac.diff=R(Ac.orig.getValue(),Ac.edit.getValue());Ac.chunks=s(Ac.diff);Ac.diffOutOfDate=false;p.signal(Ac.edit,"updateDiff",Ac.diff)}}var E=false;function t(Af){var Ai={from:0,to:0,marked:[]};var Al={from:0,to:0,marked:[]};var Ae,Ac=false;function Ah(Am){E=true;Ac=false;if(Am=="full"){if(Af.svg){F(Af.svg)}if(Af.copyButtons){F(Af.copyButtons)}Y(Af.edit,Ai.marked,Af.classes);Y(Af.orig,Al.marked,Af.classes);Ai.from=Ai.to=Al.from=Al.to=0}U(Af);if(Af.showDifferences){S(Af.edit,Af.diff,Ai,DIFF_INSERT,Af.classes);S(Af.orig,Af.diff,Al,DIFF_DELETE,Af.classes)}if(Af.mv.options.connect=="align"){k(Af)}n(Af);if(Af.needsScrollSync!=null){h(Af,Af.needsScrollSync)}E=false}function Ad(Am){if(E){return}Af.dealigned=true;Aj(Am)}function Aj(Am){if(E||Ac){return}clearTimeout(Ae);if(Am===true){Ac=true}Ae=setTimeout(Ah,Am===true?20:250)}function Ak(An,Am){if(!Af.diffOutOfDate){Af.diffOutOfDate=true;Ai.from=Ai.to=Al.from=Al.to=0}Ad(Am.text.length-1!=Am.to.line-Am.from.line)}function Ag(){Af.diffOutOfDate=true;Ah("full")}Af.edit.on("change",Ak);Af.orig.on("change",Ak);Af.edit.on("swapDoc",Ag);Af.orig.on("swapDoc",Ag);if(Af.mv.options.connect=="align"){p.on(Af.edit.state.trackAlignable,"realign",Ad);p.on(Af.orig.state.trackAlignable,"realign",Ad)}Af.edit.on("viewportChange",function(){Aj(false)});Af.orig.on("viewportChange",function(){Aj(false)});Ah();return Ah}function D(Ac){Ac.edit.on("scroll",function(){h(Ac,true)&&n(Ac)});Ac.orig.on("scroll",function(){h(Ac,false)&&n(Ac)})}function h(Aj,At){if(Aj.diffOutOfDate){if(Aj.lockScroll&&Aj.needsScrollSync==null){Aj.needsScrollSync=At}return false}Aj.needsScrollSync=null;if(!Aj.lockScroll){return true}var Ao,Ad,Ah=+new Date;if(At){Ao=Aj.edit;Ad=Aj.orig}else{Ao=Aj.orig;Ad=Aj.edit}if(Ao.state.scrollSetBy==Aj&&(Ao.state.scrollSetAt||0)+250>Ah){return false}var Ae=Ao.getScrollInfo();if(Aj.mv.options.connect=="align"){Ar=Ae.top}else{var Ap=0.5*Ae.clientHeight,An=Ae.top+Ap;var Ak=Ao.lineAtHeight(An,"local");var Aq=W(Aj.chunks,Ak,At);var Al=y(Ao,At?Aq.edit:Aq.orig);var Ag=y(Ad,At?Aq.orig:Aq.edit);var As=(An-Al.top)/(Al.bot-Al.top);var Ar=(Ag.top-Ap)+As*(Ag.bot-Ag.top);var Am,Ai;if(Ar>Ae.top&&(Ai=Ae.top/Ap)<1){Ar=Ar*Ai+Ae.top*(1-Ai)}else{if((Am=Ae.height-Ae.clientHeight-Ae.top)<Ap){var Ac=Ad.getScrollInfo();var Af=Ac.height-Ac.clientHeight-Ar;if(Af>Am&&(Ai=Am/Ap)<1){Ar=Ar*Ai+(Ac.height-Ac.clientHeight-Am)*(1-Ai)}}}}Ad.scrollTo(Ae.left,Ar);Ad.state.scrollSetAt=Ah;Ad.state.scrollSetBy=Aj;return true}function y(Ae,Ac){var Ad=Ac.after;if(Ad==null){Ad=Ae.lastLine()+1}return{top:Ae.heightAtLine(Ac.before||0,"local"),bot:Ae.heightAtLine(Ad,"local")}}function v(Ae,Ad,Ac){Ae.lockScroll=Ad;if(Ad&&Ac!=false){h(Ae,DIFF_INSERT)&&n(Ae)}Ae.lockButton.innerHTML=Ad?"\u21db\u21da":"\u21db&nbsp;&nbsp;\u21da"}function Ab(Af,Ag,Ae){var Ac=Ae.classLocation;for(var Ad=0;Ad<Ac.length;Ad++){Af.removeLineClass(Ag,Ac[Ad],Ae.chunk);Af.removeLineClass(Ag,Ac[Ad],Ae.start);Af.removeLineClass(Ag,Ac[Ad],Ae.end)}}function Y(Af,Ae,Ad){for(var Ac=0;Ac<Ae.length;++Ac){var Ag=Ae[Ac];if(Ag instanceof p.TextMarker){Ag.clear()}else{if(Ag.parent){Ab(Af,Ag,Ad)}}}Ae.length=0}function S(Af,Ag,Ah,Ac,Ad){var Ae=Af.getViewport();Af.operation(function(){if(Ah.from==Ah.to||Ae.from-Ah.to>20||Ah.from-Ae.to>20){Y(Af,Ah.marked,Ad);r(Af,Ag,Ac,Ah.marked,Ae.from,Ae.to,Ad);Ah.from=Ae.from;Ah.to=Ae.to}else{if(Ae.from<Ah.from){r(Af,Ag,Ac,Ah.marked,Ae.from,Ah.from,Ad);Ah.from=Ae.from}if(Ae.to>Ah.to){r(Af,Ag,Ac,Ah.marked,Ah.to,Ae.to,Ad);Ah.to=Ae.to}}})}function o(Ac,Ah,Af,Ai,Ad,Ae){var Aj=Af.classLocation,Ak=Ac.getLineHandle(Ah);for(var Ag=0;Ag<Aj.length;Ag++){if(Ai){Ac.addLineClass(Ak,Aj[Ag],Af.chunk)}if(Ad){Ac.addLineClass(Ak,Aj[Ag],Af.start)}if(Ae){Ac.addLineClass(Ak,Aj[Ag],Af.end)}}return Ak}function r(Am,Ai,Av,Au,Aq,Ae,Ar){var Aw=a(0,0);var At=a(Aq,0),Ao=Am.clipPos(a(Ae-1));var Ap=Av==DIFF_DELETE?Ar.del:Ar.insert;function Ah(AD,AC){var AB=Math.max(Aq,AD),Az=Math.min(Ae,AC);for(var AA=AB;AA<Az;++AA){Au.push(o(Am,AA,Ar,true,AA==AD,AA==AC-1))}if(AD==AC&&AB==AC&&Az==AC){if(AB){Au.push(o(Am,AB-1,Ar,false,false,true))}else{Au.push(o(Am,AB,Ar,false,true,false))}}}var Af=0,Ag=false;for(var Aj=0;Aj<Ai.length;++Aj){var Ac=Ai[Aj],As=Ac[0],Ak=Ac[1];if(As==DIFF_EQUAL){var Al=Aw.line+(Aa(Ai,Aj)?0:1);i(Aw,Ak);var An=Aw.line+(c(Ai,Aj)?1:0);if(An>Al){if(Ag){Ah(Af,Al);Ag=false}Af=An}}else{Ag=true;if(As==Av){var Ax=i(Aw,Ak,true);var Ad=M(At,Aw),Ay=Q(Ao,Ax);if(!L(Ad,Ay)){Au.push(Am.markText(Ad,Ay,{className:Ap}))}Aw=Ax}}}if(Ag){Ah(Af,Aw.line+1)}}function n(Ad){if(!Ad.showDifferences){return}if(Ad.svg){F(Ad.svg);var Ae=Ad.gap.offsetWidth;O(Ad.svg,"width",Ae,"height",Ad.gap.offsetHeight)}if(Ad.copyButtons){F(Ad.copyButtons)}var Af=Ad.edit.getViewport(),Ac=Ad.orig.getViewport();var Ag=Ad.mv.wrap.getBoundingClientRect().top;var Ak=Ag-Ad.edit.getScrollerElement().getBoundingClientRect().top+Ad.edit.getScrollInfo().top;var Aj=Ag-Ad.orig.getScrollerElement().getBoundingClientRect().top+Ad.orig.getScrollInfo().top;for(var Ai=0;Ai<Ad.chunks.length;Ai++){var Ah=Ad.chunks[Ai];if(Ah.editFrom<=Af.to&&Ah.editTo>=Af.from&&Ah.origFrom<=Ac.to&&Ah.origTo>=Ac.from){z(Ad,Ah,Aj,Ak,Ae)}}}function b(Af,Ah){var Ae=0,Ac=0;for(var Ad=0;Ad<Ah.length;Ad++){var Ag=Ah[Ad];if(Ag.editTo>Af&&Ag.editFrom<=Af){return null}if(Ag.editFrom>Af){break}Ae=Ag.editTo;Ac=Ag.origTo}return Ac+(Af-Ae)}function H(Ae,Ak,Al){var Af=Ae.state.trackAlignable;var Ad=Ae.firstLine(),Am=0;var Ac=[];for(var Ag=0;;Ag++){var Ai=Ak[Ag];var Ah=!Ai?Ae.lastLine()+1:Al?Ai.origFrom:Ai.editFrom;for(;Am<Af.alignable.length;Am+=2){var Aj=Af.alignable[Am]+1;if(Aj<=Ad){continue}if(Aj<Ah){Ac.push(Aj)}else{break}}if(!Ai){break}Ac.push(Ad=Al?Ai.origTo:Ai.editTo)}return Ac}function q(Ad,Ak,An,Ac){var Al=0,Ap=0,Ag=0,Ah=0;for(;;Al++){var Am=Ad[Al],Ai=Ak[Ap];if(!Am&&Ai==null){break}var Ae=Am?Am[0]:1000000000,Af=Ai==null?1000000000:Ai;while(Ag<An.length){var Aj=An[Ag];if(Aj.editTo>Ae){break}Ah+=(Aj.origTo-Aj.origFrom)-(Aj.editTo-Aj.editFrom);Ag++}if(Ae==Af-Ah){Am[Ac]=Af;Ap++}else{if(Ae<Af-Ah){Am[Ac]=Ae+Ah}else{var Ao=[Af-Ah,null,null];Ao[Ac]=Af;Ad.splice(Al,0,Ao);Ap++}}}}function V(Ag,Ai){var Ac=H(Ag.edit,Ag.chunks,false),Ae=[];if(Ai){for(var Ad=0,Ah=0;Ad<Ai.chunks.length;Ad++){var Af=Ai.chunks[Ad].editTo;while(Ah<Ac.length&&Ac[Ah]<Af){Ah++}if(Ah==Ac.length||Ac[Ah]!=Af){Ac.splice(Ah++,0,Af)}}}for(var Ad=0;Ad<Ac.length;Ad++){Ae.push([Ac[Ad],null,null])}q(Ae,H(Ag.orig,Ag.chunks,true),Ag.chunks,1);if(Ai){q(Ae,H(Ai.orig,Ai.chunks,true),Ai.chunks,2)}return Ae}function k(Ad,Ac){if(!Ad.dealigned&&!Ac){return}if(!Ad.orig.curOp){return Ad.orig.operation(function(){k(Ad,Ac)})}Ad.dealigned=false;var Aj=Ad.mv.left==Ad?Ad.mv.right:Ad.mv.left;if(Aj){U(Aj);Aj.dealigned=false}var Ak=V(Ad,Aj);var Ah=Ad.mv.aligners;for(var Ag=0;Ag<Ah.length;Ag++){Ah[Ag].clear()}Ah.length=0;var Af=[Ad.edit,Ad.orig],Ai=[];if(Aj){Af.push(Aj.orig)}for(var Ag=0;Ag<Af.length;Ag++){Ai.push(Af[Ag].getScrollInfo().top)}for(var Ae=0;Ae<Ak.length;Ae++){l(Af,Ak[Ae],Ah)}for(var Ag=0;Ag<Af.length;Ag++){Af[Ag].scrollTo(null,Ai[Ag])}}function l(Ad,Aj,Ac){var Ag=0,Ah=[];for(var Af=0;Af<Ad.length;Af++){if(Aj[Af]!=null){var Ai=Ad[Af].heightAtLine(Aj[Af],"local");Ah[Af]=Ai;Ag=Math.max(Ag,Ai)}}for(var Af=0;Af<Ad.length;Af++){if(Aj[Af]!=null){var Ae=Ag-Ah[Af];if(Ae>1){Ac.push(B(Ad[Af],Aj[Af],Ae))}}}}function B(Ag,Af,Ac){var Ad=true;if(Af>Ag.lastLine()){Af--;Ad=false}var Ae=document.createElement("div");Ae.className="CodeMirror-merge-spacer";Ae.style.height=Ac+"px";Ae.style.minWidth="1px";return Ag.addLineWidget(Af,Ae,{height:Ac,above:Ad,mergeSpacer:true})}function z(Aq,Ap,Ai,Ah,At){var Ak=Aq.type=="left";var An=Aq.orig.heightAtLine(Ap.origFrom,"local",true)-Ai;if(Aq.svg){var Ag=An;var As=Aq.edit.heightAtLine(Ap.editFrom,"local",true)-Ah;if(Ak){var Ae=Ag;Ag=As;As=Ae}var Ac=Aq.orig.heightAtLine(Ap.origTo,"local",true)-Ai;var Ar=Aq.edit.heightAtLine(Ap.editTo,"local",true)-Ah;if(Ak){var Ae=Ac;Ac=Ar;Ar=Ae}var Ao=" C "+At/2+" "+As+" "+At/2+" "+Ag+" "+(At+2)+" "+Ag;var Ad=" C "+At/2+" "+Ac+" "+At/2+" "+Ar+" -1 "+Ar;O(Aq.svg.appendChild(document.createElementNS(j,"path")),"d","M -1 "+As+Ao+" L "+(At+2)+" "+Ac+Ad+" z","class",Aq.classes.connect)}if(Aq.copyButtons){var Af=Aq.copyButtons.appendChild(d("div",Aq.type=="left"?"\u21dd":"\u21dc","CodeMirror-merge-copy"));var Aj=Aq.mv.options.allowEditingOriginals;Af.title=Aj?"Push to left":"Revert chunk";Af.chunk=Ap;Af.style.top=(Ap.origTo>Ap.origFrom?An:Aq.edit.heightAtLine(Ap.editFrom,"local")-Ah)+"px";if(Aj){var Al=Aq.edit.heightAtLine(Ap.editFrom,"local")-Ah;var Am=Aq.copyButtons.appendChild(d("div",Aq.type=="right"?"\u21dd":"\u21dc","CodeMirror-merge-copy-reverse"));Am.title="Push to right";Am.chunk={editFrom:Ap.origFrom,editTo:Ap.origTo,origFrom:Ap.editFrom,origTo:Ap.editTo};Am.style.top=Al+"px";Aq.type=="right"?Am.style.left="2px":Am.style.right="2px"}}}function m(Ad,Aj,Ai,Ah){if(Ad.diffOutOfDate){return}var Ac=Ah.origTo>Ai.lastLine()?a(Ah.origFrom-1):a(Ah.origFrom,0);var Ag=a(Ah.origTo,0);var Ae=Ah.editTo>Aj.lastLine()?a(Ah.editFrom-1):a(Ah.editFrom,0);var Ak=a(Ah.editTo,0);var Af=Ad.mv.options.revertChunk;if(Af){Af(Ad.mv,Ai,Ac,Ag,Aj,Ae,Ak)}else{Aj.replaceRange(Ai.getRange(Ac,Ag),Ae,Ak)}}var T=p.MergeView=function(Al,Am){if(!(this instanceof T)){return new T(Al,Am)}this.options=Am;var Ag=Am.origLeft,An=Am.origRight==null?Am.orig:Am.origRight;var Ai=Ag!=null,Ak=An!=null;var Af=1+(Ai?1:0)+(Ak?1:0);var Ar=[],Ao=this.left=null,Ad=this.right=null;var As=this;if(Ai){Ao=this.left=new g(this,"left");var Ae=d("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");Ar.push(Ae);Ar.push(f(Ao))}var Ac=d("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");Ar.push(Ac);if(Ak){Ad=this.right=new g(this,"right");Ar.push(f(Ad));var Ap=d("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");Ar.push(Ap)}(Ak?Ap:Ac).className+=" CodeMirror-merge-pane-rightmost";Ar.push(d("div",null,null,"height: 0; clear: both;"));var Ah=this.wrap=Al.appendChild(d("div",Ar,"CodeMirror-merge CodeMirror-merge-"+Af+"pane"));this.edit=p(Ac,C(Am));if(Ao){Ao.init(Ae,Ag,Am)}if(Ad){Ad.init(Ap,An,Am)}if(Am.collapseIdentical){this.editor().operation(function(){N(As,Am.collapseIdentical)})}if(Am.connect=="align"){this.aligners=[];k(this.left||this.right,true)}if(Ao){Ao.registerEvents()}if(Ad){Ad.registerEvents()}var Aj=function(){if(Ao){n(Ao)}if(Ad){n(Ad)}};p.on(window,"resize",Aj);var Aq=setInterval(function(){for(var At=Ah.parentNode;At&&At!=document.body;At=At.parentNode){}if(!At){clearInterval(Aq);p.off(window,"resize",Aj)}},5000)};function f(Af){var Ad=Af.lockButton=d("div",null,"CodeMirror-merge-scrolllock");Ad.title="Toggle locked scrolling";var Ag=d("div",[Ad],"CodeMirror-merge-scrolllock-wrap");p.on(Ad,"click",function(){v(Af,!Af.lockScroll)});var Ae=[Ag];if(Af.mv.options.revertButtons!==false){Af.copyButtons=d("div",null,"CodeMirror-merge-copybuttons-"+Af.type);p.on(Af.copyButtons,"click",function(Ah){var Ai=Ah.target||Ah.srcElement;if(!Ai.chunk){return}if(Ai.className=="CodeMirror-merge-copy-reverse"){m(Af,Af.orig,Af.edit,Ai.chunk);return}m(Af,Af.edit,Af.orig,Ai.chunk)});Ae.unshift(Af.copyButtons)}if(Af.mv.options.connect!="align"){var Ac=document.createElementNS&&document.createElementNS(j,"svg");if(Ac&&!Ac.createSVGRect){Ac=null}Af.svg=Ac;if(Ac){Ae.push(Ac)}}return Af.gap=d("div",Ae,"CodeMirror-merge-gap")}T.prototype={constructor:T,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(Ac){if(this.right){this.right.setShowDifferences(Ac)}if(this.left){this.left.setShowDifferences(Ac)}},rightChunks:function(){if(this.right){U(this.right);return this.right.chunks}},leftChunks:function(){if(this.left){U(this.left);return this.left.chunks}}};function J(Ac){if(typeof Ac=="string"){return Ac}else{return Ac.getValue()}}var X=new diff_match_patch();function R(Af,Ae){var Ag=X.diff_main(Af,Ae);for(var Ac=0;Ac<Ag.length;++Ac){var Ad=Ag[Ac];if(!Ad[1]){Ag.splice(Ac--,1)}else{if(Ac&&Ag[Ac-1][0]==Ad[0]){Ag.splice(Ac--,1);Ag[Ac][1]+=Ad[1]}}}return Ag}function s(Ai){var Ao=[];var Af=0,Ae=0;var Aj=a(0,0),Aq=a(0,0);for(var Ak=0;Ak<Ai.length;++Ak){var Am=Ai[Ak],Ah=Am[0];if(Ah==DIFF_EQUAL){var Ac=Aa(Ai,Ak)?0:1;var An=Aj.line+Ac,Ag=Aq.line+Ac;i(Aj,Am[1],null,Aq);var Ap=c(Ai,Ak)?1:0;var Al=Aj.line+Ap,Ad=Aq.line+Ap;if(Al>An){if(Ak){Ao.push({origFrom:Ae,origTo:Ag,editFrom:Af,editTo:An})}Af=Al;Ae=Ad}}else{i(Ah==DIFF_INSERT?Aj:Aq,Am[1])}}if(Af<=Aj.line||Ae<=Aq.line){Ao.push({origFrom:Ae,origTo:Aq.line+1,editFrom:Af,editTo:Aj.line+1})}return Ao}function c(Ae,Ac){if(Ac==Ae.length-1){return true}var Ad=Ae[Ac+1][1];if((Ad.length==1&&Ac<Ae.length-2)||Ad.charCodeAt(0)!=10){return false}if(Ac==Ae.length-2){return true}Ad=Ae[Ac+2][1];return(Ad.length>1||Ac==Ae.length-3)&&Ad.charCodeAt(0)==10}function Aa(Ae,Ac){if(Ac==0){return true}var Ad=Ae[Ac-1][1];if(Ad.charCodeAt(Ad.length-1)!=10){return false}if(Ac==1){return true}Ad=Ae[Ac-2][1];return Ad.charCodeAt(Ad.length-1)==10}function W(Ak,Aj,Am){var Ac,Al,Af,Ag;for(var Ai=0;Ai<Ak.length;Ai++){var Ah=Ak[Ai];var Ae=Am?Ah.editFrom:Ah.origFrom;var Ad=Am?Ah.editTo:Ah.origTo;if(Al==null){if(Ae>Aj){Al=Ah.editFrom;Ag=Ah.origFrom}else{if(Ad>Aj){Al=Ah.editTo;Ag=Ah.origTo}}}if(Ad<=Aj){Ac=Ah.editTo;Af=Ah.origTo}else{if(Ae<=Aj){Ac=Ah.editFrom;Af=Ah.origFrom}}}return{edit:{before:Ac,after:Al},orig:{before:Af,after:Ag}}}function P(Ag,Ac,Ad){Ag.addLineClass(Ac,"wrap","CodeMirror-merge-collapsed-line");var Af=document.createElement("span");Af.className="CodeMirror-merge-collapsed-widget";Af.title="Identical text collapsed. Click to expand.";var Ah=Ag.markText(a(Ac,0),a(Ad-1),{inclusiveLeft:true,inclusiveRight:true,replacedWith:Af,clearOnEnter:true});function Ae(){Ah.clear();Ag.removeLineClass(Ac,"wrap","CodeMirror-merge-collapsed-line")}p.on(Af,"click",Ae);return{mark:Ah,clear:Ae}}function u(Ac,Af){var Ai=[];function Ah(){for(var Aj=0;Aj<Ai.length;Aj++){Ai[Aj].clear()}}for(var Ad=0;Ad<Af.length;Ad++){var Ag=Af[Ad];var Ae=P(Ag.cm,Ag.line,Ag.line+Ac);Ai.push(Ae);Ae.mark.on("clear",Ah)}return Ai[0].mark}function Z(Ad,Ac,Ai,Aj){for(var Af=0;Af<Ad.chunks.length;Af++){var Ag=Ad.chunks[Af];for(var Ah=Ag.editFrom-Ac;Ah<Ag.editTo+Ac;Ah++){var Ae=Ah+Ai;if(Ae>=0&&Ae<Aj.length){Aj[Ae]=false}}}}function N(Al,Ag){if(typeof Ag!="number"){Ag=2}var An=[],Ah=Al.editor(),Am=Ah.firstLine();for(var Aj=Am,Ac=Ah.lastLine();Aj<=Ac;Aj++){An.push(true)}if(Al.left){Z(Al.left,Ag,Am,An)}if(Al.right){Z(Al.right,Ag,Am,An)}for(var Ak=0;Ak<An.length;Ak++){if(An[Ak]){var Ad=Ak+Am;for(var Ae=1;Ak<An.length-1&&An[Ak+1];Ak++,Ae++){}if(Ae>Ag){var Ai=[{line:Ad,cm:Ah}];if(Al.left){Ai.push({line:b(Ad,Al.left.chunks),cm:Al.left.orig})}if(Al.right){Ai.push({line:b(Ad,Al.right.chunks),cm:Al.right.orig})}var Af=u(Ae,Ai);if(Al.options.onCollapse){Al.options.onCollapse(Al,Ad,Ae,Af)}}}}}function d(Ac,Ah,Ad,Ag){var Ae=document.createElement(Ac);if(Ad){Ae.className=Ad}if(Ag){Ae.style.cssText=Ag}if(typeof Ah=="string"){Ae.appendChild(document.createTextNode(Ah))}else{if(Ah){for(var Af=0;Af<Ah.length;++Af){Ae.appendChild(Ah[Af])}}}return Ae}function F(Ad){for(var Ac=Ad.childNodes.length;Ac>0;--Ac){Ad.removeChild(Ad.firstChild)}}function O(Ad){for(var Ac=1;Ac<arguments.length;Ac+=2){Ad.setAttribute(arguments[Ac],arguments[Ac+1])}}function C(Ac,Ae){if(!Ae){Ae={}}for(var Ad in Ac){if(Ac.hasOwnProperty(Ad)){Ae[Ad]=Ac[Ad]}}return Ae}function i(Ad,Af,Ag,Ai){var Ae=Ag?a(Ad.line,Ad.ch):Ad,Ah=0;for(;;){var Ac=Af.indexOf("\n",Ah);if(Ac==-1){break}++Ae.line;if(Ai){++Ai.line}Ah=Ac+1}Ae.ch=(Ah?0:Ae.ch)+(Af.length-Ah);if(Ai){Ai.ch=(Ah?0:Ai.ch)+(Af.length-Ah)}return Ae}var G=1,w=2,e=4;function x(Ad){this.cm=Ad;this.alignable=[];var Ac=this;Ad.on("markerAdded",function(Ag,Ae){if(!Ae.collapsed){return}var Af=Ae.find(1);if(Af!=null){Ac.set(Af.line,e)}});Ad.on("markerCleared",function(Ah,Af,Ae,Ag){if(Ag!=null&&Af.collapsed){Ac.check(Ag,e,Ac.hasMarker)}});Ad.on("markerChanged",this.signal.bind(this));Ad.on("lineWidgetAdded",function(Ag,Af,Ae){if(Af.mergeSpacer){return}if(Af.above){Ac.set(Ae-1,w)}else{Ac.set(Ae,G)}});Ad.on("lineWidgetCleared",function(Ag,Af,Ae){if(Af.mergeSpacer){return}if(Af.above){Ac.check(Ae-1,w,Ac.hasWidgetBelow)}else{Ac.check(Ae,G,Ac.hasWidget)}});Ad.on("lineWidgetChanged",this.signal.bind(this));Ad.on("change",function(Aj,Ae){var Ai=Ae.from.line,Af=Ae.to.line-Ae.from.line;var Ah=Ae.text.length-1,Ag=Ai+Ah;if(Af||Ah){Ac.map(Ai,Af,Ah)}Ac.check(Ag,e,Ac.hasMarker);if(Af||Ah){Ac.check(Ae.from.line,e,Ac.hasMarker)}})}x.prototype={signal:function(){p.signal(this,"realign")},set:function(Ac,Ae){var Ad=-1;for(;Ad<this.alignable.length;Ad+=2){var Af=this.alignable[Ad]-Ac;if(Af==0){if((this.alignable[Ad+1]&Ae)==Ae){return}this.alignable[Ad+1]|=Ae;this.signal();return}if(Af>0){break}}this.signal();this.alignable.splice(Ad,0,Ac,Ae)},find:function(Ad){for(var Ac=0;Ac<this.alignable.length;Ac+=2){if(this.alignable[Ac]==Ad){return Ac}}return -1},check:function(Ac,Ag,Af){var Ad=this.find(Ac);if(Ad==-1||!(this.alignable[Ad+1]&Ag)){return}if(!Af.call(this,Ac)){this.signal();var Ae=this.alignable[Ad+1]&~Ag;if(Ae){this.alignable[Ad+1]=Ae}else{this.alignable.splice(Ad,2)}}},hasMarker:function(Ae){var Ac=this.cm.getLineHandle(Ae);if(Ac.markedSpans){for(var Ad=0;Ad<Ac.markedSpans.length;Ad++){if(Ac.markedSpans[Ad].mark.collapsed&&Ac.markedSpans[Ad].to!=null){return true}}}return false},hasWidget:function(Ae){var Ac=this.cm.getLineHandle(Ae);if(Ac.widgets){for(var Ad=0;Ad<Ac.widgets.length;Ad++){if(!Ac.widgets[Ad].above&&!Ac.widgets[Ad].mergeSpacer){return true}}}return false},hasWidgetBelow:function(Ae){if(Ae==this.cm.lastLine()){return false}var Ac=this.cm.getLineHandle(Ae+1);if(Ac.widgets){for(var Ad=0;Ad<Ac.widgets.length;Ad++){if(Ac.widgets[Ad].above&&!Ac.widgets[Ad].mergeSpacer){return true}}}return false},map:function(Ag,Ae,Al){var Ad=Al-Ae,Ak=Ag+Ae,Ac=-1,Ah=-1;for(var Aj=0;Aj<this.alignable.length;Aj+=2){var Af=this.alignable[Aj];if(Af==Ag&&(this.alignable[Aj+1]&w)){Ac=Aj}if(Af==Ak&&(this.alignable[Aj+1]&w)){Ah=Aj}if(Af<=Ag){continue}else{if(Af<Ak){this.alignable.splice(Aj--,2)}else{this.alignable[Aj]+=Ad}}}if(Ac>-1){var Ai=this.alignable[Ac+1];if(Ai==w){this.alignable.splice(Ac,2)}else{this.alignable[Ac+1]=Ai&~w}}if(Ah>-1&&Al){this.set(Ag+Al,w)}}};function Q(Ad,Ac){return(Ad.line-Ac.line||Ad.ch-Ac.ch)<0?Ad:Ac}function M(Ad,Ac){return(Ad.line-Ac.line||Ad.ch-Ac.ch)>0?Ad:Ac}function L(Ad,Ac){return Ad.line==Ac.line&&Ad.ch==Ac.ch}function K(Ah,Ag,Af){for(var Ad=Ah.length-1;Ad>=0;Ad--){var Ac=Ah[Ad];var Ae=(Af?Ac.origTo:Ac.editTo)-1;if(Ae<Ag){return Ae}}}function A(Ah,Ag,Af){for(var Ad=0;Ad<Ah.length;Ad++){var Ac=Ah[Ad];var Ae=(Af?Ac.origFrom:Ac.editFrom);if(Ae>Ag){return Ae}}}function I(Ag,Ae){var Ai=null,Ac=Ag.state.diffViews,Ad=Ag.getCursor().line;if(Ac){for(var Ah=0;Ah<Ac.length;Ah++){var Af=Ac[Ah],Ak=Ag==Af.orig;U(Af);var Aj=Ae<0?K(Af.chunks,Ad,Ak):A(Af.chunks,Ad,Ak);if(Aj!=null&&(Ai==null||(Ae<0?Aj>Ai:Aj<Ai))){Ai=Aj}}}if(Ai!=null){Ag.setCursor(Ai,0)}else{return p.Pass}}p.commands.goNextDiff=function(Ac){return I(Ac,1)};p.commands.goPrevDiff=function(Ac){return I(Ac,-1)}});