(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(L){var E=L.Pos;function G(R,Q){return R.line-Q.line||R.ch-Q.ch}var M="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var J=M+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040";var N=new RegExp("<(/?)(["+M+"]["+J+"]*)","g");function F(T,S,R,Q){this.line=S;this.ch=R;this.cm=T;this.text=T.getLine(S);this.min=Q?Math.max(Q.from,T.firstLine()):T.firstLine();this.max=Q?Math.min(Q.to-1,T.lastLine()):T.lastLine()}function D(R,S){var Q=R.cm.getTokenTypeAt(E(R.line,S));return Q&&/\btag\b/.test(Q)}function B(Q){if(Q.line>=Q.max){return}Q.ch=0;Q.text=Q.cm.getLine(++Q.line);return true}function O(Q){if(Q.line<=Q.min){return}Q.text=Q.cm.getLine(--Q.line);Q.ch=Q.text.length;return true}function P(R){for(;;){var Q=R.text.indexOf(">",R.ch);if(Q==-1){if(B(R)){continue}else{return}}if(!D(R,Q+1)){R.ch=Q+1;continue}var S=R.text.lastIndexOf("/",Q);var T=S>-1&&!/\S/.test(R.text.slice(S+1,Q));R.ch=Q+1;return T?"selfClose":"regular"}}function K(R){for(;;){var S=R.ch?R.text.lastIndexOf("<",R.ch-1):-1;if(S==-1){if(O(R)){continue}else{return}}if(!D(R,S+1)){R.ch=S;continue}N.lastIndex=S;R.ch=S;var Q=N.exec(R.text);if(Q&&Q.index==S){return Q}}}function H(Q){for(;;){N.lastIndex=Q.ch;var R=N.exec(Q.text);if(!R){if(B(Q)){continue}else{return}}if(!D(Q,R.index+1)){Q.ch=R.index+1;continue}Q.ch=R.index+R[0].length;return R}}function C(R){for(;;){var Q=R.ch?R.text.lastIndexOf(">",R.ch-1):-1;if(Q==-1){if(O(R)){continue}else{return}}if(!D(R,Q+1)){R.ch=Q;continue}var S=R.text.lastIndexOf("/",Q);var T=S>-1&&!/\S/.test(R.text.slice(S+1,Q));R.ch=Q+1;return T?"selfClose":"regular"}}function A(V,R){var X=[];for(;;){var W=H(V),S,T=V.line,Q=V.ch-(W?W[0].length:0);if(!W||!(S=P(V))){return}if(S=="selfClose"){continue}if(W[1]){for(var U=X.length-1;U>=0;--U){if(X[U]==W[2]){X.length=U;break}}if(U<0&&(!R||R==W[2])){return{tag:W[2],from:E(T,Q),to:E(V.line,V.ch)}}}else{X.push(W[2])}}}function I(R,S){var X=[];for(;;){var W=C(R);if(!W){return}if(W=="selfClose"){K(R);continue}var T=R.line,U=R.ch;var Q=K(R);if(!Q){return}if(Q[1]){X.push(Q[2])}else{for(var V=X.length-1;V>=0;--V){if(X[V]==Q[2]){X.length=V;break}}if(V<0&&(!S||S==Q[2])){return{tag:Q[2],from:E(R.line,R.ch),to:E(T,U)}}}}}L.registerHelper("fold","xml",function(V,W){var R=new F(V,W.line,0);for(;;){var Q=H(R),T;if(!Q||R.line!=W.line||!(T=P(R))){return}if(!Q[1]&&T!="selfClose"){var U=E(R.line,R.ch);var S=A(R,Q[2]);return S&&{from:U,to:S.from}}}});L.findMatchingTag=function(S,U,W){var T=new F(S,U.line,U.ch,W);if(T.text.indexOf(">")==-1&&T.text.indexOf("<")==-1){return}var R=P(T),X=R&&E(T.line,T.ch);var Q=R&&K(T);if(!R||!Q||G(T,U)>0){return}var V={from:E(T.line,T.ch),to:X,tag:Q[2]};if(R=="selfClose"){return{open:V,close:null,at:"open"}}if(Q[1]){return{open:I(T,Q[2]),close:V,at:"close"}}else{T=new F(S,X.line,X.ch,W);return{open:V,close:A(T,Q[2]),at:"open"}}};L.findEnclosingTag=function(V,S,W){var R=new F(V,S.line,S.ch,W);for(;;){var U=I(R);if(!U){break}var T=new F(V,S.line,S.ch,W);var Q=A(T,U.tag);if(Q){return{open:U,close:Q}}}};L.scanForClosingTag=function(U,R,S,T){var Q=new F(U,R.line,R.ch,T?{from:0,to:T}:null);return A(Q,S)}});