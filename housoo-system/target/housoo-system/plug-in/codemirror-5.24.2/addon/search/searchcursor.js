(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(C){var D=C.Pos;function B(J,G,E,L){this.atOccurrence=false;this.doc=J;if(L==null&&typeof G=="string"){L=false}E=E?J.clipPos(E):D(0,0);this.pos={from:E,to:E};if(typeof G!="string"){if(!G.global){G=new RegExp(G.source,G.ignoreCase?"ig":"g")}this.matches=function(P,R){if(P){G.lastIndex=0;var M=J.getLine(R.line).slice(0,R.ch),O=0,T,N;for(;;){G.lastIndex=O;var Q=G.exec(M);if(!Q){break}T=Q;N=T.index;O=T.index+(T[0].length||1);if(O==M.length){break}}var S=(T&&T[0].length)||0;if(!S){if(N==0&&M.length==0){T=undefined}else{if(N!=J.getLine(R.line).length){S++}}}}else{G.lastIndex=R.ch;var M=J.getLine(R.line),T=G.exec(M);var S=(T&&T[0].length)||0;var N=T&&T.index;if(N+S!=M.length&&!S){S=1}}if(T&&S){return{from:D(R.line,N),to:D(R.line,N+S),match:T}}}}else{var F=G;if(L){G=G.toLowerCase()}var I=L?function(M){return M.toLowerCase()}:function(M){return M};var K=G.split("\n");if(K.length==1){if(!G.length){this.matches=function(){}}else{this.matches=function(N,P){if(N){var M=J.getLine(P.line).slice(0,P.ch),Q=I(M);var O=Q.lastIndexOf(G);if(O>-1){O=A(M,Q,O);return{from:D(P.line,O),to:D(P.line,O+F.length)}}}else{var M=J.getLine(P.line).slice(P.ch),Q=I(M);var O=Q.indexOf(G);if(O>-1){O=A(M,Q,O)+P.ch;return{from:D(P.line,O),to:D(P.line,O+F.length)}}}}}}else{var H=F.split("\n");this.matches=function(P,T){var S=K.length-1;if(P){if(T.line-(K.length-1)<J.firstLine()){return}if(I(J.getLine(T.line).slice(0,H[S].length))!=K[K.length-1]){return}var U=D(T.line,H[S].length);for(var Q=T.line-1,R=S-1;R>=1;--R,--Q){if(K[R]!=I(J.getLine(Q))){return}}var N=J.getLine(Q),O=N.length-H[0].length;if(I(N.slice(O))!=K[0]){return}return{from:D(Q,O),to:U}}else{if(T.line+(K.length-1)>J.lastLine()){return}var N=J.getLine(T.line),O=N.length-H[0].length;if(I(N.slice(O))!=K[0]){return}var M=D(T.line,O);for(var Q=T.line+1,R=1;R<S;++R,++Q){if(K[R]!=I(J.getLine(Q))){return}}if(I(J.getLine(Q).slice(0,H[S].length))!=K[S]){return}return{from:M,to:D(Q,H[S].length)}}}}}}B.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(E){var I=this,F=this.doc.clipPos(E?this.pos.from:this.pos.to);function G(K){var J=D(K,0);I.pos={from:J,to:J};I.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(E,F)){this.atOccurrence=true;return this.pos.match||true}if(E){if(!F.line){return G(0)}F=D(F.line-1,this.doc.getLine(F.line-1).length)}else{var H=this.doc.lineCount();if(F.line==H-1){return G(H)}F=D(F.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(F,G){if(!this.atOccurrence){return}var E=C.splitLines(F);this.doc.replaceRange(E,this.pos.from,this.pos.to,G);this.pos.to=D(this.pos.from.line+E.length-1,E[E.length-1].length+(E.length==1?this.pos.from.ch:0))}};function A(E,G,F){if(E.length==G.length){return F}for(var H=Math.min(F,E.length);;){var I=E.slice(0,H).toLowerCase().length;if(I<F){++H}else{if(I>F){--H}else{return H}}}}C.defineExtension("getSearchCursor",function(G,E,F){return new B(this.doc,G,E,F)});C.defineDocExtension("getSearchCursor",function(G,E,F){return new B(this,G,E,F)});C.defineExtension("selectMatches",function(H,G){var F=[];var E=this.getSearchCursor(H,this.getCursor("from"),G);while(E.findNext()){if(C.cmpPos(E.to(),this.getCursor("to"))>0){break}F.push({anchor:E.from(),head:E.to()})}if(F.length){this.setSelections(F,0)}})});