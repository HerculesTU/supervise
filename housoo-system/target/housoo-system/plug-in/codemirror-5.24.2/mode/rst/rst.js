(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("rst",function(B,G){var H=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var M=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var F=/^``[^`\s](?:[^`]*[^`\s])``/;var K=/^(?:[\d]+(?:[\.,]\d+)*)/;var O=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var E=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var N="[Hh][Tt][Tt][Pp][Ss]?://";var C="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var J="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var L=new RegExp("^"+N+C+J);var D={token:function(P){if(P.match(H)&&P.match(/\W+|$/,false)){return"strong"}if(P.match(M)&&P.match(/\W+|$/,false)){return"em"}if(P.match(F)&&P.match(/\W+|$/,false)){return"string-2"}if(P.match(K)){return"number"}if(P.match(O)){return"positive"}if(P.match(E)){return"negative"}if(P.match(L)){return"link"}while(P.next()!=null){if(P.match(H,false)){break}if(P.match(M,false)){break}if(P.match(F,false)){break}if(P.match(K,false)){break}if(P.match(O,false)){break}if(P.match(E,false)){break}if(P.match(L,false)){break}}return null}};var I=A.getMode(B,G.backdrop||"rst-base");return A.overlayMode(I,D,true)},"python","stex");A.defineMode("rst-base",function(O){function R(z){var Aa=Array.prototype.slice.call(arguments,1);return z.replace(/{(\d+)}/g,function(Ac,Ab){return typeof Aa[Ab]!="undefined"?Aa[Ab]:Ac})}var H=A.getMode(O,"python");var d=A.getMode(O,"stex");var w="\\s+";var L="(?:\\s*|\\W|$)",J=new RegExp(R("^{0}",L));var i="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",X=new RegExp(R("^{0}",i));var W="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var v=R("(?:{0}|`{1}`)",i,W);var j="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var h="(?:[^\\`]+)",K=new RegExp(R("^{0}",h));var x=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var D=new RegExp(R("^\\.\\.{0}",w));var S=new RegExp(R("^_{0}:{1}|^__:{1}",v,L));var F=new RegExp(R("^{0}::{1}",v,L));var q=new RegExp(R("^\\|{0}\\|{1}{2}::{3}",j,w,v,L));var o=new RegExp(R("^\\[(?:\\d+|#{0}?|\\*)]{1}",v,L));var C=new RegExp(R("^\\[{0}\\]{1}",v,L));var p=new RegExp(R("^\\|{0}\\|",j));var y=new RegExp(R("^\\[(?:\\d+|#{0}?|\\*)]_",v));var a=new RegExp(R("^\\[{0}\\]_",v));var T=new RegExp(R("^{0}__?",v));var I=new RegExp(R("^`{0}`_",h));var G=new RegExp(R("^:{0}:`{1}`{2}",i,h,L));var V=new RegExp(R("^`{1}`:{0}:{2}",i,h,L));var U=new RegExp(R("^:{0}:{1}",i,L));var b=new RegExp(R("^{0}",v));var e=new RegExp(R("^::{0}",L));var M=new RegExp(R("^\\|{0}\\|",j));var P=new RegExp(R("^{0}",w));var Q=new RegExp(R("^{0}",v));var k=new RegExp(R("^::{0}",L));var r=new RegExp("^_");var E=new RegExp(R("^{0}|_",v));var u=new RegExp(R("^:{0}",L));var n=new RegExp("^::\\s*$");var c=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function m(Ab,Aa){var z=null;if(Ab.sol()&&Ab.match(c,false)){t(Aa,Y,{mode:H,local:A.startState(H)})}else{if(Ab.sol()&&Ab.match(D)){t(Aa,s);z="meta"}else{if(Ab.sol()&&Ab.match(x)){t(Aa,m);z="header"}else{if(l(Aa)==G||Ab.match(G,false)){switch(f(Aa)){case 0:t(Aa,m,B(G,1));Ab.match(/^:/);z="meta";break;case 1:t(Aa,m,B(G,2));Ab.match(X);z="keyword";if(Ab.current().match(/^(?:math|latex)/)){Aa.tmp_stex=true}break;case 2:t(Aa,m,B(G,3));Ab.match(/^:`/);z="meta";break;case 3:if(Aa.tmp_stex){Aa.tmp_stex=undefined;Aa.tmp={mode:d,local:A.startState(d)}}if(Aa.tmp){if(Ab.peek()=="`"){t(Aa,m,B(G,4));Aa.tmp=undefined;break}z=Aa.tmp.mode.token(Ab,Aa.tmp.local);break}t(Aa,m,B(G,4));Ab.match(K);z="string";break;case 4:t(Aa,m,B(G,5));Ab.match(/^`/);z="meta";break;case 5:t(Aa,m,B(G,6));Ab.match(J);break;default:t(Aa,m)}}else{if(l(Aa)==V||Ab.match(V,false)){switch(f(Aa)){case 0:t(Aa,m,B(V,1));Ab.match(/^`/);z="meta";break;case 1:t(Aa,m,B(V,2));Ab.match(K);z="string";break;case 2:t(Aa,m,B(V,3));Ab.match(/^`:/);z="meta";break;case 3:t(Aa,m,B(V,4));Ab.match(X);z="keyword";break;case 4:t(Aa,m,B(V,5));Ab.match(/^:/);z="meta";break;case 5:t(Aa,m,B(V,6));Ab.match(J);break;default:t(Aa,m)}}else{if(l(Aa)==U||Ab.match(U,false)){switch(f(Aa)){case 0:t(Aa,m,B(U,1));Ab.match(/^:/);z="meta";break;case 1:t(Aa,m,B(U,2));Ab.match(X);z="keyword";break;case 2:t(Aa,m,B(U,3));Ab.match(/^:/);z="meta";break;case 3:t(Aa,m,B(U,4));Ab.match(J);break;default:t(Aa,m)}}else{if(l(Aa)==p||Ab.match(p,false)){switch(f(Aa)){case 0:t(Aa,m,B(p,1));Ab.match(M);z="variable-2";break;case 1:t(Aa,m,B(p,2));if(Ab.match(/^_?_?/)){z="link"}break;default:t(Aa,m)}}else{if(Ab.match(y)){t(Aa,m);z="quote"}else{if(Ab.match(a)){t(Aa,m);z="quote"}else{if(Ab.match(T)){t(Aa,m);if(!Ab.peek()||Ab.peek().match(/^\W$/)){z="link"}}else{if(l(Aa)==I||Ab.match(I,false)){switch(f(Aa)){case 0:if(!Ab.peek()||Ab.peek().match(/^\W$/)){t(Aa,m,B(I,1))}else{Ab.match(I)}break;case 1:t(Aa,m,B(I,2));Ab.match(/^`/);z="link";break;case 2:t(Aa,m,B(I,3));Ab.match(K);break;case 3:t(Aa,m,B(I,4));Ab.match(/^`_/);z="link";break;default:t(Aa,m)}}else{if(Ab.match(n)){t(Aa,N)}else{if(Ab.next()){t(Aa,m)}}}}}}}}}}}}}return z}function s(Ab,Aa){var z=null;if(l(Aa)==q||Ab.match(q,false)){switch(f(Aa)){case 0:t(Aa,s,B(q,1));Ab.match(M);z="variable-2";break;case 1:t(Aa,s,B(q,2));Ab.match(P);break;case 2:t(Aa,s,B(q,3));Ab.match(Q);z="keyword";break;case 3:t(Aa,s,B(q,4));Ab.match(k);z="meta";break;default:t(Aa,m)}}else{if(l(Aa)==F||Ab.match(F,false)){switch(f(Aa)){case 0:t(Aa,s,B(F,1));Ab.match(b);z="keyword";if(Ab.current().match(/^(?:math|latex)/)){Aa.tmp_stex=true}else{if(Ab.current().match(/^python/)){Aa.tmp_py=true}}break;case 1:t(Aa,s,B(F,2));Ab.match(e);z="meta";if(Ab.match(/^latex\s*$/)||Aa.tmp_stex){Aa.tmp_stex=undefined;t(Aa,Y,{mode:d,local:A.startState(d)})}break;case 2:t(Aa,s,B(F,3));if(Ab.match(/^python\s*$/)||Aa.tmp_py){Aa.tmp_py=undefined;t(Aa,Y,{mode:H,local:A.startState(H)})}break;default:t(Aa,m)}}else{if(l(Aa)==S||Ab.match(S,false)){switch(f(Aa)){case 0:t(Aa,s,B(S,1));Ab.match(r);Ab.match(E);z="link";break;case 1:t(Aa,s,B(S,2));Ab.match(u);z="meta";break;default:t(Aa,m)}}else{if(Ab.match(o)){t(Aa,m);z="quote"}else{if(Ab.match(C)){t(Aa,m);z="quote"}else{Ab.eatSpace();if(Ab.eol()){t(Aa,m)}else{Ab.skipToEnd();t(Aa,Z);z="comment"}}}}}}return z}function Z(Aa,z){return g(Aa,z,"comment")}function N(Aa,z){return g(Aa,z,"meta")}function g(Ab,Aa,z){if(Ab.eol()||Ab.eatSpace()){Ab.skipToEnd();return z}else{t(Aa,m);return null}}function Y(Aa,z){if(z.ctx.mode&&z.ctx.local){if(Aa.sol()){if(!Aa.eatSpace()){t(z,m)}return null}return z.ctx.mode.token(Aa,z.ctx.local)}t(z,m);return null}function B(Ac,z,Aa,Ab){return{phase:Ac,stage:z,mode:Aa,local:Ab}}function t(Ab,z,Aa){Ab.tok=z;Ab.ctx=Aa||{}}function f(z){return z.ctx.stage||0}function l(z){return z.ctx.phase}return{startState:function(){return{tok:m,ctx:B(undefined,0)}},copyState:function(Ab){var Aa=Ab.ctx,z=Ab.tmp;if(Aa.local){Aa={mode:Aa.mode,local:A.copyState(Aa.mode,Aa.local)}}if(z){z={mode:z.mode,local:A.copyState(z.mode,z.local)}}return{tok:Ab.tok,ctx:Aa,tmp:z}},innerMode:function(z){return z.tmp?{state:z.tmp.local,mode:z.tmp.mode}:z.ctx.mode?{state:z.ctx.local,mode:z.ctx.mode}:null},token:function(Aa,z){return z.tok(Aa,z)}}},"python","stex");A.defineMIME("text/x-rst","rst")});