(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../javascript/javascript"],A)}else{A(CodeMirror)}}})(function(B){function C(G,D,E,F){this.state=G;this.mode=D;this.depth=E;this.prev=F}function A(D){return new C(B.copyState(D.mode,D.state),D.mode,D.depth,D.prev&&A(D.prev))}B.defineMode("jsx",function(D,F){var G=B.getMode(D,{name:"xml",allowMissing:true,multilineTagIndentPastTag:false});var H=B.getMode(D,F&&F.base||"javascript");function I(N){var L=N.tagName;N.tagName=null;var M=G.indent(N,"");N.tagName=L;return M}function K(M,L){if(L.context.mode==G){return J(M,L,L.context)}else{return E(M,L,L.context)}}function J(P,S,N){if(N.depth==2){if(P.match(/^.*?\*\//)){N.depth=1}else{P.skipToEnd()}return"comment"}if(P.peek()=="{"){G.skipAttribute(N.state);var R=I(N.state),Q=N.state.context;if(Q&&P.match(/^[^>]*>\s*$/,false)){while(Q.prev&&!Q.startOfLine){Q=Q.prev}if(Q.startOfLine){R-=D.indentUnit}else{if(N.prev.state.lexical){R=N.prev.state.lexical.indented}}}else{if(N.depth==1){R+=D.indentUnit}}S.context=new C(B.startState(H,R),H,0,S.context);return null}if(N.depth==1){if(P.peek()=="<"){G.skipAttribute(N.state);S.context=new C(B.startState(G,I(N.state)),G,0,S.context);return null}else{if(P.match("//")){P.skipToEnd();return"comment"}else{if(P.match("/*")){N.depth=2;return K(P,S)}}}}var O=G.token(P,N.state),L=P.current(),M;if(/\btag\b/.test(O)){if(/>$/.test(L)){if(N.state.context){N.depth=0}else{S.context=S.context.prev}}else{if(/^</.test(L)){N.depth=1}}}else{if(!O&&(M=L.indexOf("{"))>-1){P.backUp(L.length-M)}}return O}function E(P,N,O){if(P.peek()=="<"&&H.expressionAllowed(P,O.state)){H.skipExpression(O.state);N.context=new C(B.startState(G,H.indent(O.state,"")),G,0,N.context);return null}var M=H.token(P,O.state);if(!M&&O.depth!=null){var L=P.current();if(L=="{"){O.depth++}else{if(L=="}"){if(--O.depth==0){N.context=N.context.prev}}}}return M}return{startState:function(){return{context:new C(B.startState(H),H)}},copyState:function(L){return{context:A(L.context)}},token:K,indent:function(N,L,M){return N.context.mode.indent(N.context.state,L,M)},innerMode:function(L){return L.context}}},"xml","javascript");B.defineMIME("text/jsx","jsx");B.defineMIME("text/typescript-jsx",{name:"jsx",base:{name:"javascript",typescript:true}})});