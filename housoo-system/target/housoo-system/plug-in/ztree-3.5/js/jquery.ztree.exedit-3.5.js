(function(X){var H={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},I={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},Q=function(f){var e=W.getRoot(f),d=W.getRoots();e.curEditNode=null;e.curEditInput=null;e.curHoverNode=null;e.dragFlag=0;e.dragNodeShowBefore=[];e.dragMaskList=new Array();d.showHoverDom=true},V=function(d){},K=function(d){var e=d.treeObj;var f=Z.event;e.bind(f.RENAME,function(j,h,i,g){D.apply(d.callback.onRename,[j,h,i,g])});e.bind(f.DRAG,function(i,j,h,g){D.apply(d.callback.onDrag,[j,h,g])});e.bind(f.DRAGMOVE,function(i,j,h,g){D.apply(d.callback.onDragMove,[j,h,g])});e.bind(f.DROP,function(k,m,i,g,h,l,j){D.apply(d.callback.onDrop,[m,i,g,h,l,j])})},B=function(d){var e=d.treeObj;var f=Z.event;e.unbind(f.RENAME);e.unbind(f.DRAG);e.unbind(f.DRAGMOVE);e.unbind(f.DROP)},E=function(h){var o=h.target,j=W.getSetting(h.data.treeId),d=h.relatedTarget,n="",m=null,l="",g="",f=null,k=null,i=null;if(D.eqs(h.type,"mouseover")){i=D.getMDom(j,o,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(i){n=D.getNodeMainDom(i).id;l="hoverOverNode"}}else{if(D.eqs(h.type,"mouseout")){i=D.getMDom(j,d,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(!i){n="remove";l="hoverOutNode"}}else{if(D.eqs(h.type,"mousedown")){i=D.getMDom(j,o,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(i){n=D.getNodeMainDom(i).id;l="mousedownNode"}}}}if(n.length>0){m=W.getNodeCache(j,n);switch(l){case"mousedownNode":f=N.onMousedownNode;break;case"hoverOverNode":f=N.onHoverOverNode;break;case"hoverOutNode":f=N.onHoverOutNode;break}}var p={stop:false,node:m,nodeEventType:l,nodeEventCallback:f,treeEventType:g,treeEventCallback:k};return p},J=function(f,g,h,d,j,e,i){if(!h){return}h.isHover=false;h.editNameFlag=false},O=function(d,e){e.cancelEditName=function(g){var f=W.getRoot(this.setting);if(!f.curEditNode){return}T.cancelCurEditNode(this.setting,g?g:null,true)};e.copyNode=function(h,i,f,k){if(!i){return null}if(h&&!h.isParent&&this.setting.data.keep.leaf&&f===Z.move.TYPE_INNER){return null}var g=this,l=D.clone(i);if(!h){h=null;f=Z.move.TYPE_INNER}if(f==Z.move.TYPE_INNER){function j(){T.addNodes(g.setting,h,[l],k)}if(D.canAsync(this.setting,h)){T.asyncNode(this.setting,h,k,j)}else{j()}}else{T.addNodes(this.setting,h.parentNode,[l],k);T.moveNode(this.setting,h,l,f,false,k)}return l};e.editName=function(f){if(!f||!f.tId||f!==W.getNodeCache(this.setting,f.tId)){return}if(f.parentTId){T.expandCollapseParentNode(this.setting,f.getParentNode(),true)}T.editNode(this.setting,f)};e.moveNode=function(i,j,f,k){if(!j){return j}if(i&&!i.isParent&&this.setting.data.keep.leaf&&f===Z.move.TYPE_INNER){return null}else{if(i&&((j.parentTId==i.tId&&f==Z.move.TYPE_INNER)||Y(j,this.setting).find("#"+i.tId).length>0)){return null}else{if(!i){i=null}}}var g=this;function h(){T.moveNode(g.setting,i,j,f,false,k)}if(D.canAsync(this.setting,i)&&f===Z.move.TYPE_INNER){T.asyncNode(this.setting,i,k,h)}else{h()}return j};e.setEditable=function(f){this.setting.edit.enable=f;return this.refresh()}},L={setSonNodeLevel:function(f,d,g){if(!g){return}var j=f.data.key.children;g.level=(d)?d.level+1:0;if(!g[j]){return}for(var e=0,h=g[j].length;e<h;e++){if(g[j][e]){W.setSonNodeLevel(f,g,g[j][e])}}}},M={},N={onHoverOverNode:function(g,e){var d=W.getSetting(g.data.treeId),f=W.getRoot(d);if(f.curHoverNode!=e){N.onHoverOutNode(g)}f.curHoverNode=e;T.addHoverDom(d,e)},onHoverOutNode:function(g,e){var d=W.getSetting(g.data.treeId),f=W.getRoot(d);if(f.curHoverNode&&!W.isSelectedNode(d,f.curHoverNode)){T.removeTreeDom(d,f.curHoverNode);f.curHoverNode=null}},onMousedownNode:function(Ad,y){var n,q,Ab=W.getSetting(Ad.data.treeId),w=W.getRoot(Ab),r=W.getRoots();if(Ad.button==2||!Ab.edit.enable||(!Ab.edit.drag.isCopy&&!Ab.edit.drag.isMove)){return true}var Ae=Ad.target,j=W.getRoot(Ab).curSelectedList,k=[];if(!W.isSelectedNode(Ab,y)){k=[y]}else{for(n=0,q=j.length;n<q;n++){if(j[n].editNameFlag&&D.eqs(Ae.tagName,"input")&&Ae.getAttribute("treeNode"+Z.id.INPUT)!==null){return true}k.push(j[n]);if(k[0].parentTId!==j[n].parentTId){k=[y];break}}}T.editNodeBlur=true;T.cancelCurEditNode(Ab);var x=X(Ab.treeObj.get(0).ownerDocument),s=X(Ab.treeObj.get(0).ownerDocument.body),Ah,Af,g,Ac=false,d=Ab,Aa=Ab,z,v,Ai=null,p=null,h=null,Ag=Z.move.TYPE_INNER,e=Ad.clientX,u=Ad.clientY,t=(new Date()).getTime();if(D.uCanDo(Ab)){x.bind("mousemove",m)}function m(AJ){if(w.dragFlag==0&&Math.abs(e-AJ.clientX)<Ab.edit.drag.minMoveSize&&Math.abs(u-AJ.clientY)<Ab.edit.drag.minMoveSize){return true}var A1,A3,AR,Aq,AI,AD=Ab.data.key.children;s.css("cursor","pointer");if(w.dragFlag==0){if(D.apply(Ab.callback.beforeDrag,[Ab.treeId,k],true)==false){o(AJ);return true}for(A1=0,A3=k.length;A1<A3;A1++){if(A1==0){w.dragNodeShowBefore=[]}AR=k[A1];if(AR.isParent&&AR.open){T.expandCollapseNode(Ab,AR,!AR.open);w.dragNodeShowBefore[AR.tId]=true}else{w.dragNodeShowBefore[AR.tId]=false}}w.dragFlag=1;r.showHoverDom=false;D.showIfameMask(Ab,true);var AB=true,AQ=-1;if(k.length>1){var Au=k[0].parentTId?k[0].getParentNode()[AD]:W.getNodes(Ab);AI=[];for(A1=0,A3=Au.length;A1<A3;A1++){if(w.dragNodeShowBefore[Au[A1].tId]!==undefined){if(AB&&AQ>-1&&(AQ+1)!==A1){AB=false}AI.push(Au[A1]);AQ=A1}if(k.length===AI.length){k=AI;break}}}if(AB){z=k[0].getPreNode();v=k[k.length-1].getNextNode()}Ah=Y("<ul class='zTreeDragUL'></ul>",Ab);for(A1=0,A3=k.length;A1<A3;A1++){AR=k[A1];AR.editNameFlag=false;T.selectNode(Ab,AR,A1>0);T.removeTreeDom(Ab,AR);if(A1>Ab.edit.drag.maxShowNodeNum-1){continue}Aq=Y("<li id='"+AR.tId+"_tmp'></li>",Ab);Aq.append(Y(AR,Z.id.A,Ab).clone());Aq.css("padding","0");Aq.children("#"+AR.tId+Z.id.A).removeClass(Z.node.CURSELECTED);Ah.append(Aq);if(A1==Ab.edit.drag.maxShowNodeNum-1){Aq=Y("<li id='"+AR.tId+"_moretmp'><a>  ...  </a></li>",Ab);Ah.append(Aq)}}Ah.attr("id",k[0].tId+Z.id.UL+"_tmp");Ah.addClass(Ab.treeObj.attr("class"));Ah.appendTo(s);Af=Y("<span class='tmpzTreeMove_arrow'></span>",Ab);Af.attr("id","zTreeMove_arrow_tmp");Af.appendTo(s);Ab.treeObj.trigger(Z.event.DRAG,[AJ,Ab.treeId,k])}if(w.dragFlag==1){if(g&&Af.attr("id")==AJ.target.id&&h&&(AJ.clientX+x.scrollLeft()+2)>(X("#"+h+Z.id.A,g).offset().left)){var AV=X("#"+h+Z.id.A,g);AJ.target=(AV.length>0)?AV.get(0):AJ.target}else{if(g){g.removeClass(Z.node.TMPTARGET_TREE);if(h){X("#"+h+Z.id.A,g).removeClass(Z.node.TMPTARGET_NODE+"_"+Z.move.TYPE_PREV).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}}g=null;h=null;Ac=false;d=Ab;var AW=W.getSettings();for(var AX in AW){if(AW[AX].treeId&&AW[AX].edit.enable&&AW[AX].treeId!=Ab.treeId&&(AJ.target.id==AW[AX].treeId||X(AJ.target).parents("#"+AW[AX].treeId).length>0)){Ac=true;d=AW[AX]}}var AU=x.scrollTop(),Aw=x.scrollLeft(),AG=d.treeObj.offset(),AS=d.treeObj.get(0).scrollHeight,Am=d.treeObj.get(0).scrollWidth,AP=(AJ.clientY+AU-AG.top),Az=(d.treeObj.height()+AG.top-AJ.clientY-AU),AM=(AJ.clientX+Aw-AG.left),A6=(d.treeObj.width()+AG.left-AJ.clientX-Aw),AC=(AP<Ab.edit.drag.borderMax&&AP>Ab.edit.drag.borderMin),AZ=(Az<Ab.edit.drag.borderMax&&Az>Ab.edit.drag.borderMin),A2=(AM<Ab.edit.drag.borderMax&&AM>Ab.edit.drag.borderMin),AE=(A6<Ab.edit.drag.borderMax&&A6>Ab.edit.drag.borderMin),AH=AP>Ab.edit.drag.borderMin&&Az>Ab.edit.drag.borderMin&&AM>Ab.edit.drag.borderMin&&A6>Ab.edit.drag.borderMin,A0=(AC&&d.treeObj.scrollTop()<=0),A7=(AZ&&(d.treeObj.scrollTop()+d.treeObj.height()+10)>=AS),Ay=(A2&&d.treeObj.scrollLeft()<=0),AA=(AE&&(d.treeObj.scrollLeft()+d.treeObj.width()+10)>=Am);if(AJ.target&&D.isChildOrSelf(AJ.target,d.treeId)){var AN=AJ.target;while(AN&&AN.tagName&&!D.eqs(AN.tagName,"li")&&AN.id!=d.treeId){AN=AN.parentNode}var As=true;for(A1=0,A3=k.length;A1<A3;A1++){AR=k[A1];if(AN.id===AR.tId){As=false;break}else{if(Y(AR,Ab).find("#"+AN.id).length>0){As=false;break}}}if(As&&AJ.target&&D.isChildOrSelf(AJ.target,AN.id+Z.id.A)){g=X(AN);h=AN.id}}AR=k[0];if(AH&&D.isChildOrSelf(AJ.target,d.treeId)){if(!g&&(AJ.target.id==d.treeId||A0||A7||Ay||AA)&&(Ac||(!Ac&&AR.parentTId))){g=d.treeObj}if(AC){d.treeObj.scrollTop(d.treeObj.scrollTop()-10)}else{if(AZ){d.treeObj.scrollTop(d.treeObj.scrollTop()+10)}}if(A2){d.treeObj.scrollLeft(d.treeObj.scrollLeft()-10)}else{if(AE){d.treeObj.scrollLeft(d.treeObj.scrollLeft()+10)}}if(g&&g!=d.treeObj&&g.offset().left<d.treeObj.offset().left){d.treeObj.scrollLeft(d.treeObj.scrollLeft()+g.offset().left-d.treeObj.offset().left)}}Ah.css({"top":(AJ.clientY+AU+3)+"px","left":(AJ.clientX+Aw+3)+"px"});var A4=0;var Ar=0;if(g&&g.attr("id")!=d.treeId){var AT=h==null?null:W.getNodeCache(d,h),Aj=((AJ.ctrlKey||AJ.metaKey)&&Ab.edit.drag.isMove&&Ab.edit.drag.isCopy)||(!Ab.edit.drag.isMove&&Ab.edit.drag.isCopy),AF=!!(z&&h===z.tId),AO=!!(v&&h===v.tId),AL=(AR.parentTId&&AR.parentTId==h),Al=(Aj||!AO)&&D.apply(d.edit.drag.prev,[d.treeId,k,AT],!!d.edit.drag.prev),Ap=(Aj||!AF)&&D.apply(d.edit.drag.next,[d.treeId,k,AT],!!d.edit.drag.next),Ao=(Aj||!AL)&&!(d.data.keep.leaf&&!AT.isParent)&&D.apply(d.edit.drag.inner,[d.treeId,k,AT],!!d.edit.drag.inner);if(!Al&&!Ap&&!Ao){g=null;h="";Ag=Z.move.TYPE_INNER;Af.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var A5=X("#"+h+Z.id.A,g),Ak=AT.isLastNode?null:X("#"+AT.getNextNode().tId+Z.id.A,g.next()),An=A5.offset().top,Ax=A5.offset().left,AK=Al?(Ao?0.25:(Ap?0.5:1)):-1,AY=Ap?(Ao?0.75:(Al?0.5:0)):-1,At=(AJ.clientY+AU-An)/A5.height();if((AK==1||At<=AK&&At>=-0.2)&&Al){A4=1-Af.width();Ar=An-Af.height()/2;Ag=Z.move.TYPE_PREV}else{if((AY==0||At>=AY&&At<=1.2)&&Ap){A4=1-Af.width();Ar=(Ak==null||(AT.isParent&&AT.open))?(An+A5.height()-Af.height()/2):(Ak.offset().top-Af.height()/2);Ag=Z.move.TYPE_NEXT}else{A4=5-Af.width();Ar=An;Ag=Z.move.TYPE_INNER}}Af.css({"display":"block","top":Ar+"px","left":(Ax+A4)+"px"});A5.addClass(Z.node.TMPTARGET_NODE+"_"+Ag);if(Ai!=h||p!=Ag){t=(new Date()).getTime()}if(AT&&AT.isParent&&Ag==Z.move.TYPE_INNER){var Av=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==AT.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===AT.tId){Av=false}}if(Av){window.zTreeMoveTimer=setTimeout(function(){if(Ag!=Z.move.TYPE_INNER){return}if(AT&&AT.isParent&&!AT.open&&(new Date()).getTime()-t>d.edit.drag.autoOpenTime&&D.apply(d.callback.beforeDragOpen,[d.treeId,AT],true)){T.switchNode(d,AT);if(d.edit.drag.autoExpandTrigger){d.treeObj.trigger(Z.event.EXPAND,[d.treeId,AT])}}},d.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=AT.tId}}}}else{Ag=Z.move.TYPE_INNER;if(g&&D.apply(d.edit.drag.inner,[d.treeId,k,null],!!d.edit.drag.inner)){g.addClass(Z.node.TMPTARGET_TREE)}else{g=null}Af.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}Ai=h;p=Ag;Ab.treeObj.trigger(Z.event.DRAGMOVE,[AJ,Ab.treeId,k])}return false}x.bind("mouseup",o);function o(Ak){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}Ai=null;p=null;x.unbind("mousemove",m);x.unbind("mouseup",o);x.unbind("selectstart",f);s.css("cursor","auto");if(g){g.removeClass(Z.node.TMPTARGET_TREE);if(h){X("#"+h+Z.id.A,g).removeClass(Z.node.TMPTARGET_NODE+"_"+Z.move.TYPE_PREV).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}D.showIfameMask(Ab,false);r.showHoverDom=true;if(w.dragFlag==0){return}w.dragFlag=0;var Al,An,Aq;for(Al=0,An=k.length;Al<An;Al++){Aq=k[Al];if(Aq.isParent&&w.dragNodeShowBefore[Aq.tId]&&!Aq.open){T.expandCollapseNode(Ab,Aq,!Aq.open);delete w.dragNodeShowBefore[Aq.tId]}}if(Ah){Ah.remove()}if(Af){Af.remove()}var Ao=((Ak.ctrlKey||Ak.metaKey)&&Ab.edit.drag.isMove&&Ab.edit.drag.isCopy)||(!Ab.edit.drag.isMove&&Ab.edit.drag.isCopy);if(!Ao&&g&&h&&k[0].parentTId&&h==k[0].parentTId&&Ag==Z.move.TYPE_INNER){g=null}if(g){var Am=h==null?null:W.getNodeCache(d,h);if(D.apply(Ab.callback.beforeDrop,[d.treeId,k,Am,Ag,Ao],true)==false){T.selectNodes(Aa,k);return}var Ap=Ao?D.clone(k):k;function Aj(){if(Ac){if(!Ao){for(var Ar=0,As=k.length;Ar<As;Ar++){T.removeNode(Ab,k[Ar])}}if(Ag==Z.move.TYPE_INNER){T.addNodes(d,Am,Ap)}else{T.addNodes(d,Am.getParentNode(),Ap);if(Ag==Z.move.TYPE_PREV){for(Ar=0,As=Ap.length;Ar<As;Ar++){T.moveNode(d,Am,Ap[Ar],Ag,false)}}else{for(Ar=-1,As=Ap.length-1;Ar<As;As--){T.moveNode(d,Am,Ap[As],Ag,false)}}}}else{if(Ao&&Ag==Z.move.TYPE_INNER){T.addNodes(d,Am,Ap)}else{if(Ao){T.addNodes(d,Am.getParentNode(),Ap)}if(Ag!=Z.move.TYPE_NEXT){for(Ar=0,As=Ap.length;Ar<As;Ar++){T.moveNode(d,Am,Ap[Ar],Ag,false)}}else{for(Ar=-1,As=Ap.length-1;Ar<As;As--){T.moveNode(d,Am,Ap[As],Ag,false)}}}}T.selectNodes(d,Ap);Y(Ap[0],Ab).focus().blur();Ab.treeObj.trigger(Z.event.DROP,[Ak,d.treeId,Ap,Am,Ag,Ao])}if(Ag==Z.move.TYPE_INNER&&D.canAsync(d,Am)){T.asyncNode(d,Am,false,Aj)}else{Aj()}}else{T.selectNodes(Aa,k);Ab.treeObj.trigger(Z.event.DROP,[Ak,Ab.treeId,k,null,null,null])}}x.bind("selectstart",f);function f(){return false}if(Ad.preventDefault){Ad.preventDefault()}return true}},U={getAbs:function(d){var f=d.getBoundingClientRect(),e=document.body.scrollTop+document.documentElement.scrollTop,g=document.body.scrollLeft+document.documentElement.scrollLeft;return[f.left+g,f.top+e]},inputFocus:function(d){if(d.get(0)){d.focus();D.setCursorPosition(d.get(0),d.val().length)}},inputSelect:function(d){if(d.get(0)){d.focus();d.select()}},setCursorPosition:function(d,e){if(d.setSelectionRange){d.focus();d.setSelectionRange(e,e)}else{if(d.createTextRange){var f=d.createTextRange();f.collapse(true);f.moveEnd("character",e);f.moveStart("character",e);f.select()}}},showIfameMask:function(e,f){var g=W.getRoot(e);while(g.dragMaskList.length>0){g.dragMaskList[0].remove();g.dragMaskList.shift()}if(f){var j=Y("iframe",e);for(var h=0,k=j.length;h<k;h++){var m=j.get(h),d=D.getAbs(m),n=Y("<div id='zTreeMask_"+h+"' class='zTreeMask' style='top:"+d[1]+"px; left:"+d[0]+"px; width:"+m.offsetWidth+"px; height:"+m.offsetHeight+"px;'></div>",e);n.appendTo(Y("body",e));g.dragMaskList.push(n)}}}},R={addEditBtn:function(e,f){if(f.editNameFlag||Y(f,Z.id.EDIT,e).length>0){return}if(!D.apply(e.edit.showRenameBtn,[e.treeId,f],e.edit.showRenameBtn)){return}var g=Y(f,Z.id.A,e),d="<span class='"+Z.className.BUTTON+" edit' id='"+f.tId+Z.id.EDIT+"' title='"+D.apply(e.edit.renameTitle,[e.treeId,f],e.edit.renameTitle)+"' treeNode"+Z.id.EDIT+" style='display:none;'></span>";g.append(d);Y(f,Z.id.EDIT,e).bind("click",function(){if(!D.uCanDo(e)||D.apply(e.callback.beforeEditName,[e.treeId,f],true)==false){return false}T.editNode(e,f);return false}).show()},addRemoveBtn:function(d,e){if(e.editNameFlag||Y(e,Z.id.REMOVE,d).length>0){return}if(!D.apply(d.edit.showRemoveBtn,[d.treeId,e],d.edit.showRemoveBtn)){return}var f=Y(e,Z.id.A,d),g="<span class='"+Z.className.BUTTON+" remove' id='"+e.tId+Z.id.REMOVE+"' title='"+D.apply(d.edit.removeTitle,[d.treeId,e],d.edit.removeTitle)+"' treeNode"+Z.id.REMOVE+" style='display:none;'></span>";f.append(g);Y(e,Z.id.REMOVE,d).bind("click",function(){if(!D.uCanDo(d)||D.apply(d.callback.beforeRemove,[d.treeId,e],true)==false){return false}T.removeNode(d,e);d.treeObj.trigger(Z.event.REMOVE,[d.treeId,e]);return false}).bind("mousedown",function(h){return true}).show()},addHoverDom:function(d,e){if(W.getRoots().showHoverDom){e.isHover=true;if(d.edit.enable){T.addEditBtn(d,e);T.addRemoveBtn(d,e)}D.apply(d.view.addHoverDom,[d.treeId,e])}},cancelCurEditNode:function(e,h,l){var g=W.getRoot(e),d=e.data.key.name,i=g.curEditNode;if(i){var j=g.curEditInput,k=h?h:(l?i[d]:j.val());if(D.apply(e.callback.beforeRename,[e.treeId,i,k,l],true)===false){return false}else{i[d]=k;e.treeObj.trigger(Z.event.RENAME,[e.treeId,i,l])}var f=Y(i,Z.id.A,e);f.removeClass(Z.node.CURSELECTED_EDIT);j.unbind();T.setNodeName(e,i);i.editNameFlag=false;g.curEditNode=null;g.curEditInput=null;T.selectNode(e,i,false)}g.noSelection=true;return true},editNode:function(d,f){var g=W.getRoot(d);T.editNodeBlur=false;if(W.isSelectedNode(d,f)&&g.curEditNode==f&&f.editNameFlag){setTimeout(function(){D.inputFocus(g.curEditInput)},0);return}var h=d.data.key.name;f.editNameFlag=true;T.removeTreeDom(d,f);T.cancelCurEditNode(d);T.selectNode(d,f,false);Y(f,Z.id.SPAN,d).html("<input type=text class='rename' id='"+f.tId+Z.id.INPUT+"' treeNode"+Z.id.INPUT+" >");var e=Y(f,Z.id.INPUT,d);e.attr("value",f[h]);if(d.edit.editNameSelectAll){D.inputSelect(e)}else{D.inputFocus(e)}e.bind("blur",function(i){if(!T.editNodeBlur){T.cancelCurEditNode(d)}}).bind("keydown",function(i){if(i.keyCode=="13"){T.editNodeBlur=true;T.cancelCurEditNode(d)}else{if(i.keyCode=="27"){T.cancelCurEditNode(d,null,true)}}}).bind("click",function(i){return false}).bind("dblclick",function(i){return false});Y(f,Z.id.A,d).addClass(Z.node.CURSELECTED_EDIT);g.curEditInput=e;g.noSelection=false;g.curEditNode=f},moveNode:function(o,Aa,w,d,Ac,q){var r=W.getRoot(o),g=o.data.key.children;if(Aa==w){return}if(o.data.keep.leaf&&Aa&&!Aa.isParent&&d==Z.move.TYPE_INNER){return}var h=(w.parentTId?w.getParentNode():r),Ad=(Aa===null||Aa==r);if(Ad&&Aa===null){Aa=r}if(Ad){d=Z.move.TYPE_INNER}var z=(Aa.parentTId?Aa.getParentNode():r);if(d!=Z.move.TYPE_PREV&&d!=Z.move.TYPE_NEXT){d=Z.move.TYPE_INNER}if(d==Z.move.TYPE_INNER){if(Ad){w.parentTId=null}else{if(!Aa.isParent){Aa.isParent=true;Aa.open=!!Aa.open;T.setNodeLineIcos(o,Aa)}w.parentTId=Aa.tId}}var s,u;if(Ad){s=o.treeObj;u=s}else{if(!q&&d==Z.move.TYPE_INNER){T.expandCollapseNode(o,Aa,true,false)}else{if(!q){T.expandCollapseNode(o,Aa.getParentNode(),true,false)}}s=Y(Aa,o);u=Y(Aa,Z.id.UL,o);if(!!s.get(0)&&!u.get(0)){var t=[];T.makeUlHtml(o,Aa,t,"");s.append(t.join(""))}u=Y(Aa,Z.id.UL,o)}var x=Y(w,o);if(!x.get(0)){x=T.appendNodes(o,w.level,[w],null,false,true).join("")}else{if(!s.get(0)){x.remove()}}if(u.get(0)&&d==Z.move.TYPE_INNER){u.append(x)}else{if(s.get(0)&&d==Z.move.TYPE_PREV){s.before(x)}else{if(s.get(0)&&d==Z.move.TYPE_NEXT){s.after(x)}}}var k,n,e=-1,m=0,v=null,y=null,p=w.level;if(w.isFirstNode){e=0;if(h[g].length>1){v=h[g][1];v.isFirstNode=true}}else{if(w.isLastNode){e=h[g].length-1;v=h[g][e-1];v.isLastNode=true}else{for(k=0,n=h[g].length;k<n;k++){if(h[g][k].tId==w.tId){e=k;break}}}}if(e>=0){h[g].splice(e,1)}if(d!=Z.move.TYPE_INNER){for(k=0,n=z[g].length;k<n;k++){if(z[g][k].tId==Aa.tId){m=k}}}if(d==Z.move.TYPE_INNER){if(!Aa[g]){Aa[g]=new Array()}if(Aa[g].length>0){y=Aa[g][Aa[g].length-1];y.isLastNode=false}Aa[g].splice(Aa[g].length,0,w);w.isLastNode=true;w.isFirstNode=(Aa[g].length==1)}else{if(Aa.isFirstNode&&d==Z.move.TYPE_PREV){z[g].splice(m,0,w);y=Aa;y.isFirstNode=false;w.parentTId=Aa.parentTId;w.isFirstNode=true;w.isLastNode=false}else{if(Aa.isLastNode&&d==Z.move.TYPE_NEXT){z[g].splice(m+1,0,w);y=Aa;y.isLastNode=false;w.parentTId=Aa.parentTId;w.isFirstNode=false;w.isLastNode=true}else{if(d==Z.move.TYPE_PREV){z[g].splice(m,0,w)}else{z[g].splice(m+1,0,w)}w.parentTId=Aa.parentTId;w.isFirstNode=false;w.isLastNode=false}}}W.fixPIdKeyValue(o,w);W.setSonNodeLevel(o,w.getParentNode(),w);T.setNodeLineIcos(o,w);T.repairNodeLevelClass(o,w,p);if(!o.data.keep.parent&&h[g].length<1){h.isParent=false;h.open=false;var j=Y(h,Z.id.UL,o),f=Y(h,Z.id.SWITCH,o),Ab=Y(h,Z.id.ICON,o);T.replaceSwitchClass(h,f,Z.folder.DOCU);T.replaceIcoClass(h,Ab,Z.folder.DOCU);j.css("display","none")}else{if(v){T.setNodeLineIcos(o,v)}}if(y){T.setNodeLineIcos(o,y)}if(!!o.check&&o.check.enable&&T.repairChkClass){T.repairChkClass(o,h);T.repairParentChkClassWithSelf(o,h);if(h!=w.parent){T.repairParentChkClassWithSelf(o,w)}}if(!q){T.expandCollapseParentNode(o,w.getParentNode(),true,Ac)}},removeEditBtn:function(d,e){Y(e,Z.id.EDIT,d).unbind().remove()},removeRemoveBtn:function(d,e){Y(e,Z.id.REMOVE,d).unbind().remove()},removeTreeDom:function(d,e){e.isHover=false;T.removeEditBtn(d,e);T.removeRemoveBtn(d,e);D.apply(d.view.removeHoverDom,[d.treeId,e])},repairNodeLevelClass:function(h,j,g){if(g===j.level){return}var i=Y(j,h),d=Y(j,Z.id.A,h),e=Y(j,Z.id.UL,h),f=Z.className.LEVEL+g,k=Z.className.LEVEL+j.level;i.removeClass(f);i.addClass(k);d.removeClass(f);d.addClass(k);e.removeClass(f);e.addClass(k)},selectNodes:function(e,g){for(var d=0,f=g.length;d<f;d++){T.selectNode(e,g[d],d>0)}}},C={tools:U,view:R,event:M,data:L};X.extend(true,X.fn.zTree.consts,H);X.extend(true,X.fn.zTree._z,C);var P=X.fn.zTree,D=P._z.tools,Z=P.consts,T=P._z.view,W=P._z.data,F=P._z.event,Y=D.$;W.exSetting(I);W.addInitBind(K);W.addInitUnBind(B);W.addInitCache(V);W.addInitNode(J);W.addInitProxy(E);W.addInitRoot(Q);W.addZTreeTools(O);var b=T.cancelPreSelectedNode;T.cancelPreSelectedNode=function(e,f){var g=W.getRoot(e).curSelectedList;for(var d=0,h=g.length;d<h;d++){if(!f||f===g[d]){T.removeTreeDom(e,g[d]);if(f){break}}}if(b){b.apply(T,arguments)}};var A=T.createNodes;T.createNodes=function(e,f,g,d){if(A){A.apply(T,arguments)}if(!g){return}if(T.repairParentChkClassWithSelf){T.repairParentChkClassWithSelf(e,d)}};var a=T.makeNodeUrl;T.makeNodeUrl=function(d,e){return d.edit.enable?null:(a.apply(T,arguments))};var G=T.removeNode;T.removeNode=function(d,e){var f=W.getRoot(d);if(f.curEditNode===e){f.curEditNode=null}if(G){G.apply(T,arguments)}};var S=T.selectNode;T.selectNode=function(e,f,d){var g=W.getRoot(e);if(W.isSelectedNode(e,f)&&g.curEditNode==f&&f.editNameFlag){return false}if(S){S.apply(T,arguments)}T.addHoverDom(e,f);return true};var c=D.uCanDo;D.uCanDo=function(d,f){var g=W.getRoot(d);if(f&&(D.eqs(f.type,"mouseover")||D.eqs(f.type,"mouseout")||D.eqs(f.type,"mousedown")||D.eqs(f.type,"mouseup"))){return true}if(g.curEditNode){T.editNodeBlur=false;g.curEditInput.focus()}return(!g.curEditNode)&&(c?c.apply(T,arguments):true)}})(jQuery);