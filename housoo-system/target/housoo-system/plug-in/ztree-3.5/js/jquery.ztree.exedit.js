(function(X){var H={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},I={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}},Q=function(d){var c=W.getRoot(d);c.curEditNode=null;c.curEditInput=null;c.curHoverNode=null;c.dragFlag=0;c.dragNodeShowBefore=[];c.dragMaskList=new Array();c.showHoverDom=true},V=function(c){},K=function(d){var e=d.treeObj;var f=Y.event;e.bind(f.RENAME,function(h,c,g){D.apply(d.callback.onRename,[h,c,g])});e.bind(f.REMOVE,function(h,c,g){D.apply(d.callback.onRemove,[h,c,g])});e.bind(f.DRAG,function(h,i,g,c){D.apply(d.callback.onDrag,[i,g,c])});e.bind(f.DROP,function(j,l,h,c,g,k,i){D.apply(d.callback.onDrop,[l,h,c,g,k,i])})},B=function(d){var e=d.treeObj;var f=Y.event;e.unbind(f.RENAME);e.unbind(f.REMOVE);e.unbind(f.DRAG);e.unbind(f.DROP)},E=function(g){var n=g.target,i=W.getSetting(g.data.treeId),c=g.relatedTarget,m="",l=null,k="",f="",d=null,j=null,h=null;if(D.eqs(g.type,"mouseover")){h=D.getMDom(i,n,[{tagName:"a",attrName:"treeNode"+Y.id.A}]);if(h){m=h.parentNode.id;k="hoverOverNode"}}else{if(D.eqs(g.type,"mouseout")){h=D.getMDom(i,c,[{tagName:"a",attrName:"treeNode"+Y.id.A}]);if(!h){m="remove";k="hoverOutNode"}}else{if(D.eqs(g.type,"mousedown")){h=D.getMDom(i,n,[{tagName:"a",attrName:"treeNode"+Y.id.A}]);if(h){m=h.parentNode.id;k="mousedownNode"}}}}if(m.length>0){l=W.getNodeCache(i,m);switch(k){case"mousedownNode":d=N.onMousedownNode;break;case"hoverOverNode":d=N.onHoverOverNode;break;case"hoverOutNode":d=N.onHoverOutNode;break}}var o={stop:false,node:l,nodeEventType:k,nodeEventCallback:d,treeEventType:f,treeEventCallback:j};return o},J=function(e,f,g,c,i,d,h){if(!g){return}g.isHover=false;g.editNameFlag=false},O=function(c,d){d.cancelEditName=function(h){var e=W.getRoot(c),g=c.data.key.name,f=e.curEditNode;if(!e.curEditNode){return}T.cancelCurEditNode(c,h?h:f[g])};d.copyNode=function(f,g,e,i){if(!g){return null}if(f&&!f.isParent&&c.data.keep.leaf&&e===Y.move.TYPE_INNER){return null}var j=D.clone(g);if(!f){f=null;e=Y.move.TYPE_INNER}if(e==Y.move.TYPE_INNER){function h(){T.addNodes(c,f,[j],i)}if(D.canAsync(c,f)){T.asyncNode(c,f,i,h)}else{h()}}else{T.addNodes(c,f.parentNode,[j],i);T.moveNode(c,f,j,e,false,i)}return j};d.editName=function(e){if(!e||!e.tId||e!==W.getNodeCache(c,e.tId)){return}if(e.parentTId){T.expandCollapseParentNode(c,e.getParentNode(),true)}T.editNode(c,e)};d.moveNode=function(g,h,e,i){if(!h){return h}if(g&&!g.isParent&&c.data.keep.leaf&&e===Y.move.TYPE_INNER){return null}else{if(g&&((h.parentTId==g.tId&&e==Y.move.TYPE_INNER)||X("#"+h.tId).find("#"+g.tId).length>0)){return null}else{if(!g){g=null}}}function f(){T.moveNode(c,g,h,e,false,i)}if(D.canAsync(c,g)&&e===Y.move.TYPE_INNER){T.asyncNode(c,g,i,f)}else{f()}return h};d.setEditable=function(e){c.edit.enable=e;return this.refresh()}},L={setSonNodeLevel:function(e,c,f){if(!f){return}var h=e.data.key.children;f.level=(c)?c.level+1:0;if(!f[h]){return}for(var d=0,g=f[h].length;d<g;d++){if(f[h][d]){W.setSonNodeLevel(e,f,f[h][d])}}}},M={},N={onHoverOverNode:function(f,d){var c=W.getSetting(f.data.treeId),e=W.getRoot(c);if(e.curHoverNode!=d){N.onHoverOutNode(f)}e.curHoverNode=d;T.addHoverDom(c,d)},onHoverOutNode:function(f,d){var c=W.getSetting(f.data.treeId),e=W.getRoot(c);if(e.curHoverNode&&!W.isSelectedNode(c,e.curHoverNode)){T.removeTreeDom(c,e.curHoverNode);e.curHoverNode=null}},onMousedownNode:function(e,w){var Ab,o,q=W.getSetting(e.data.treeId),u=W.getRoot(q);if(e.button==2||!q.edit.enable||(!q.edit.drag.isCopy&&!q.edit.drag.isMove)){return true}var Aa=e.target,n=W.getRoot(q).curSelectedList,h=[];if(!W.isSelectedNode(q,w)){h=[w]}else{for(Ab=0,o=n.length;Ab<o;Ab++){if(n[Ab].editNameFlag&&D.eqs(Aa.tagName,"input")&&Aa.getAttribute("treeNode"+Y.id.INPUT)!==null){return true}h.push(n[Ab]);if(h[0].parentTId!==n[Ab].parentTId){h=[w];break}}}T.editNodeBlur=true;T.cancelCurEditNode(q,null,true);var v=X(document),Ad,p,g,z=false,k=q,x,t,Ae=null,y=null,f=null,Ac=Y.move.TYPE_INNER,c=e.clientX,s=e.clientY,r=(new Date()).getTime();if(D.uCanDo(q)){v.bind("mousemove",j)}function j(AF){if(u.dragFlag==0&&Math.abs(c-AF.clientX)<q.edit.drag.minMoveSize&&Math.abs(s-AF.clientY)<q.edit.drag.minMoveSize){return true}var AX,AZ,AN,Am,AE,Az=q.data.key.children;X("body").css("cursor","pointer");if(u.dragFlag==0){if(D.apply(q.callback.beforeDrag,[q.treeId,h],true)==false){m(AF);return true}for(AX=0,AZ=h.length;AX<AZ;AX++){if(AX==0){u.dragNodeShowBefore=[]}AN=h[AX];if(AN.isParent&&AN.open){T.expandCollapseNode(q,AN,!AN.open);u.dragNodeShowBefore[AN.tId]=true}else{u.dragNodeShowBefore[AN.tId]=false}}u.dragFlag=1;u.showHoverDom=false;D.showIfameMask(q,true);var Ax=true,AM=-1;if(h.length>1){var Aq=h[0].parentTId?h[0].getParentNode()[Az]:W.getNodes(q);AE=[];for(AX=0,AZ=Aq.length;AX<AZ;AX++){if(u.dragNodeShowBefore[Aq[AX].tId]!==undefined){if(Ax&&AM>-1&&(AM+1)!==AX){Ax=false}AE.push(Aq[AX]);AM=AX}if(h.length===AE.length){h=AE;break}}}if(Ax){x=h[0].getPreNode();t=h[h.length-1].getNextNode()}Ad=X("<ul class='zTreeDragUL'></ul>");for(AX=0,AZ=h.length;AX<AZ;AX++){AN=h[AX];AN.editNameFlag=false;T.selectNode(q,AN,AX>0);T.removeTreeDom(q,AN);Am=X("<li id='"+AN.tId+"_tmp'></li>");Am.append(X("#"+AN.tId+Y.id.A).clone());Am.css("padding","0");Am.children("#"+AN.tId+Y.id.A).removeClass(Y.node.CURSELECTED);Ad.append(Am);if(AX==q.edit.drag.maxShowNodeNum-1){Am=X("<li id='"+AN.tId+"_moretmp'><a>  ...  </a></li>");Ad.append(Am);break}}Ad.attr("id",h[0].tId+Y.id.UL+"_tmp");Ad.addClass(q.treeObj.attr("class"));Ad.appendTo("body");p=X("<span class='tmpzTreeMove_arrow'></span>");p.attr("id","zTreeMove_arrow_tmp");p.appendTo("body");q.treeObj.trigger(Y.event.DRAG,[AF,q.treeId,h])}if(u.dragFlag==1){if(g&&p.attr("id")==AF.target.id&&f&&(AF.clientX+v.scrollLeft()+2)>(X("#"+f+Y.id.A,g).offset().left)){var AR=X("#"+f+Y.id.A,g);AF.target=(AR.length>0)?AR.get(0):AF.target}else{if(g){g.removeClass(Y.node.TMPTARGET_TREE);if(f){X("#"+f+Y.id.A,g).removeClass(Y.node.TMPTARGET_NODE+"_"+Y.move.TYPE_PREV).removeClass(Y.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Y.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}}g=null;f=null;z=false;k=q;var AS=W.getSettings();for(var AT in AS){if(AS[AT].treeId&&AS[AT].edit.enable&&AS[AT].treeId!=q.treeId&&(AF.target.id==AS[AT].treeId||X(AF.target).parents("#"+AS[AT].treeId).length>0)){z=true;k=AS[AT]}}var AQ=v.scrollTop(),As=v.scrollLeft(),AC=k.treeObj.offset(),AO=k.treeObj.get(0).scrollHeight,Ai=k.treeObj.get(0).scrollWidth,AL=(AF.clientY+AQ-AC.top),Av=(k.treeObj.height()+AC.top-AF.clientY-AQ),AI=(AF.clientX+As-AC.left),A2=(k.treeObj.width()+AC.left-AF.clientX-As),Ay=(AL<q.edit.drag.borderMax&&AL>q.edit.drag.borderMin),AV=(Av<q.edit.drag.borderMax&&Av>q.edit.drag.borderMin),AY=(AI<q.edit.drag.borderMax&&AI>q.edit.drag.borderMin),AA=(A2<q.edit.drag.borderMax&&A2>q.edit.drag.borderMin),AD=AL>q.edit.drag.borderMin&&Av>q.edit.drag.borderMin&&AI>q.edit.drag.borderMin&&A2>q.edit.drag.borderMin,AW=(Ay&&k.treeObj.scrollTop()<=0),A3=(AV&&(k.treeObj.scrollTop()+k.treeObj.height()+10)>=AO),Au=(AY&&k.treeObj.scrollLeft()<=0),Aw=(AA&&(k.treeObj.scrollLeft()+k.treeObj.width()+10)>=Ai);if(AF.target.id&&k.treeObj.find("#"+AF.target.id).length>0){var AJ=AF.target;while(AJ&&AJ.tagName&&!D.eqs(AJ.tagName,"li")&&AJ.id!=k.treeId){AJ=AJ.parentNode}var Ao=true;for(AX=0,AZ=h.length;AX<AZ;AX++){AN=h[AX];if(AJ.id===AN.tId){Ao=false;break}else{if(X("#"+AN.tId).find("#"+AJ.id).length>0){Ao=false;break}}}if(Ao){if(AF.target.id&&(AF.target.id==(AJ.id+Y.id.A)||X(AF.target).parents("#"+AJ.id+Y.id.A).length>0)){g=X(AJ);f=AJ.id}}}AN=h[0];if(AD&&(AF.target.id==k.treeId||X(AF.target).parents("#"+k.treeId).length>0)){if(!g&&(AF.target.id==k.treeId||AW||A3||Au||Aw)&&(z||(!z&&AN.parentTId))){g=k.treeObj}if(Ay){k.treeObj.scrollTop(k.treeObj.scrollTop()-10)}else{if(AV){k.treeObj.scrollTop(k.treeObj.scrollTop()+10)}}if(AY){k.treeObj.scrollLeft(k.treeObj.scrollLeft()-10)}else{if(AA){k.treeObj.scrollLeft(k.treeObj.scrollLeft()+10)}}if(g&&g!=k.treeObj&&g.offset().left<k.treeObj.offset().left){k.treeObj.scrollLeft(k.treeObj.scrollLeft()+g.offset().left-k.treeObj.offset().left)}}Ad.css({"top":(AF.clientY+AQ+3)+"px","left":(AF.clientX+As+3)+"px"});var A0=0;var An=0;if(g&&g.attr("id")!=k.treeId){var AP=f==null?null:W.getNodeCache(k,f),Af=(AF.ctrlKey&&q.edit.drag.isMove&&q.edit.drag.isCopy)||(!q.edit.drag.isMove&&q.edit.drag.isCopy),AB=!!(x&&f===x.tId),AK=!!(t&&f===t.tId),AH=(AN.parentTId&&AN.parentTId==f),Ah=(Af||!AK)&&D.apply(k.edit.drag.prev,[k.treeId,h,AP],!!k.edit.drag.prev),Al=(Af||!AB)&&D.apply(k.edit.drag.next,[k.treeId,h,AP],!!k.edit.drag.next),Ak=(Af||!AH)&&!(k.data.keep.leaf&&!AP.isParent)&&D.apply(k.edit.drag.inner,[k.treeId,h,AP],!!k.edit.drag.inner);if(!Ah&&!Al&&!Ak){g=null;f="";Ac=Y.move.TYPE_INNER;p.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var A1=X("#"+f+Y.id.A,g),Ag=AP.isLastNode?null:X("#"+AP.getNextNode().tId+Y.id.A,g.next()),Aj=A1.offset().top,At=A1.offset().left,AG=Ah?(Ak?0.25:(Al?0.5:1)):-1,AU=Al?(Ak?0.75:(Ah?0.5:0)):-1,Ap=(AF.clientY+AQ-Aj)/A1.height();if((AG==1||Ap<=AG&&Ap>=-0.2)&&Ah){A0=1-p.width();An=Aj-p.height()/2;Ac=Y.move.TYPE_PREV}else{if((AU==0||Ap>=AU&&Ap<=1.2)&&Al){A0=1-p.width();An=(Ag==null||(AP.isParent&&AP.open))?(Aj+A1.height()-p.height()/2):(Ag.offset().top-p.height()/2);Ac=Y.move.TYPE_NEXT}else{A0=5-p.width();An=Aj;Ac=Y.move.TYPE_INNER}}p.css({"display":"block","top":An+"px","left":(At+A0)+"px"});A1.addClass(Y.node.TMPTARGET_NODE+"_"+Ac);if(Ae!=f||y!=Ac){r=(new Date()).getTime()}if(AP&&AP.isParent&&Ac==Y.move.TYPE_INNER){var Ar=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==AP.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===AP.tId){Ar=false}}if(Ar){window.zTreeMoveTimer=setTimeout(function(){if(Ac!=Y.move.TYPE_INNER){return}if(AP&&AP.isParent&&!AP.open&&(new Date()).getTime()-r>k.edit.drag.autoOpenTime&&D.apply(k.callback.beforeDragOpen,[k.treeId,AP],true)){T.switchNode(k,AP);if(k.edit.drag.autoExpandTrigger){k.treeObj.trigger(Y.event.EXPAND,[k.treeId,AP])}}},k.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=AP.tId}}}}else{Ac=Y.move.TYPE_INNER;if(g&&D.apply(k.edit.drag.inner,[k.treeId,h,null],!!k.edit.drag.inner)){g.addClass(Y.node.TMPTARGET_TREE)}else{g=null}p.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}Ae=f;y=Ac}return false}v.bind("mouseup",m);function m(Ag){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}Ae=null;y=null;v.unbind("mousemove",j);v.unbind("mouseup",m);v.unbind("selectstart",d);X("body").css("cursor","auto");if(g){g.removeClass(Y.node.TMPTARGET_TREE);if(f){X("#"+f+Y.id.A,g).removeClass(Y.node.TMPTARGET_NODE+"_"+Y.move.TYPE_PREV).removeClass(Y.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Y.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}D.showIfameMask(q,false);u.showHoverDom=true;if(u.dragFlag==0){return}u.dragFlag=0;var Ah,Aj,Am;for(Ah=0,Aj=h.length;Ah<Aj;Ah++){Am=h[Ah];if(Am.isParent&&u.dragNodeShowBefore[Am.tId]&&!Am.open){T.expandCollapseNode(q,Am,!Am.open);delete u.dragNodeShowBefore[Am.tId]}}if(Ad){Ad.remove()}if(p){p.remove()}var Ak=(Ag.ctrlKey&&q.edit.drag.isMove&&q.edit.drag.isCopy)||(!q.edit.drag.isMove&&q.edit.drag.isCopy);if(!Ak&&g&&f&&h[0].parentTId&&f==h[0].parentTId&&Ac==Y.move.TYPE_INNER){g=null}if(g){var Ai=f==null?null:W.getNodeCache(k,f);if(D.apply(q.callback.beforeDrop,[k.treeId,h,Ai,Ac,Ak],true)==false){return}var Al=Ak?D.clone(h):h;function Af(){if(z){if(!Ak){for(var An=0,Ao=h.length;An<Ao;An++){T.removeNode(q,h[An])}}if(Ac==Y.move.TYPE_INNER){T.addNodes(k,Ai,Al)}else{T.addNodes(k,Ai.getParentNode(),Al);if(Ac==Y.move.TYPE_PREV){for(An=0,Ao=Al.length;An<Ao;An++){T.moveNode(k,Ai,Al[An],Ac,false)}}else{for(An=-1,Ao=Al.length-1;An<Ao;Ao--){T.moveNode(k,Ai,Al[Ao],Ac,false)}}}}else{if(Ak&&Ac==Y.move.TYPE_INNER){T.addNodes(k,Ai,Al)}else{if(Ak){T.addNodes(k,Ai.getParentNode(),Al)}if(Ac!=Y.move.TYPE_NEXT){for(An=0,Ao=Al.length;An<Ao;An++){T.moveNode(k,Ai,Al[An],Ac,false)}}else{for(An=-1,Ao=Al.length-1;An<Ao;Ao--){T.moveNode(k,Ai,Al[Ao],Ac,false)}}}}for(An=0,Ao=Al.length;An<Ao;An++){T.selectNode(k,Al[An],An>0)}X("#"+Al[0].tId).focus().blur();q.treeObj.trigger(Y.event.DROP,[Ag,k.treeId,Al,Ai,Ac,Ak])}if(Ac==Y.move.TYPE_INNER&&D.canAsync(k,Ai)){T.asyncNode(k,Ai,false,Af)}else{Af()}}else{for(Ah=0,Aj=h.length;Ah<Aj;Ah++){T.selectNode(k,h[Ah],Ah>0)}q.treeObj.trigger(Y.event.DROP,[Ag,q.treeId,h,null,null,null])}}v.bind("selectstart",d);function d(){return false}if(e.preventDefault){e.preventDefault()}return true}},U={getAbs:function(c){var d=c.getBoundingClientRect();return[d.left,d.top]},inputFocus:function(c){if(c.get(0)){c.focus();D.setCursorPosition(c.get(0),c.val().length)}},inputSelect:function(c){if(c.get(0)){c.focus();c.select()}},setCursorPosition:function(c,d){if(c.setSelectionRange){c.focus();c.setSelectionRange(d,d)}else{if(c.createTextRange){var e=c.createTextRange();e.collapse(true);e.moveEnd("character",d);e.moveStart("character",d);e.select()}}},showIfameMask:function(d,e){var f=W.getRoot(d);while(f.dragMaskList.length>0){f.dragMaskList[0].remove();f.dragMaskList.shift()}if(e){var h=X("iframe");for(var g=0,j=h.length;g<j;g++){var k=h.get(g),c=D.getAbs(k),m=X("<div id='zTreeMask_"+g+"' class='zTreeMask' style='top:"+c[1]+"px; left:"+c[0]+"px; width:"+k.offsetWidth+"px; height:"+k.offsetHeight+"px;'></div>");m.appendTo("body");f.dragMaskList.push(m)}}}},R={addEditBtn:function(d,e){if(e.editNameFlag||X("#"+e.tId+Y.id.EDIT).length>0){return}if(!D.apply(d.edit.showRenameBtn,[d.treeId,e],d.edit.showRenameBtn)){return}var f=X("#"+e.tId+Y.id.A),c="<span class='button edit' id='"+e.tId+Y.id.EDIT+"' title='"+D.apply(d.edit.renameTitle,[d.treeId,e],d.edit.renameTitle)+"' treeNode"+Y.id.EDIT+" style='display:none;'></span>";f.append(c);X("#"+e.tId+Y.id.EDIT).bind("click",function(){if(!D.uCanDo(d)||D.apply(d.callback.beforeEditName,[d.treeId,e],true)==false){return false}T.editNode(d,e);return false}).show()},addRemoveBtn:function(c,d){if(d.editNameFlag||X("#"+d.tId+Y.id.REMOVE).length>0){return}if(!D.apply(c.edit.showRemoveBtn,[c.treeId,d],c.edit.showRemoveBtn)){return}var e=X("#"+d.tId+Y.id.A),f="<span class='button remove' id='"+d.tId+Y.id.REMOVE+"' title='"+D.apply(c.edit.removeTitle,[c.treeId,d],c.edit.removeTitle)+"' treeNode"+Y.id.REMOVE+" style='display:none;'></span>";e.append(f);X("#"+d.tId+Y.id.REMOVE).bind("click",function(){if(!D.uCanDo(c)||D.apply(c.callback.beforeRemove,[c.treeId,d],true)==false){return false}T.removeNode(c,d);c.treeObj.trigger(Y.event.REMOVE,[c.treeId,d]);return false}).bind("mousedown",function(g){return true}).show()},addHoverDom:function(c,d){if(W.getRoot(c).showHoverDom){d.isHover=true;if(c.edit.enable){T.addEditBtn(c,d);T.addRemoveBtn(c,d)}D.apply(c.view.addHoverDom,[c.treeId,d])}},cancelCurEditNode:function(d,e){var g=W.getRoot(d),c=d.data.key.name,i=g.curEditNode;if(i){var j=g.curEditInput;var h=e?e:j.val();if(!e&&D.apply(d.callback.beforeRename,[d.treeId,i,h],true)===false){return false}else{i[c]=h?h:j.val();if(!e){d.treeObj.trigger(Y.event.RENAME,[d.treeId,i])}}var f=X("#"+i.tId+Y.id.A);f.removeClass(Y.node.CURSELECTED_EDIT);j.unbind();T.setNodeName(d,i);i.editNameFlag=false;g.curEditNode=null;g.curEditInput=null;T.selectNode(d,i,false)}g.noSelection=true;return true},editNode:function(c,e){var f=W.getRoot(c);T.editNodeBlur=false;if(W.isSelectedNode(c,e)&&f.curEditNode==e&&e.editNameFlag){setTimeout(function(){D.inputFocus(f.curEditInput)},0);return}var g=c.data.key.name;e.editNameFlag=true;T.removeTreeDom(c,e);T.cancelCurEditNode(c);T.selectNode(c,e,false);X("#"+e.tId+Y.id.SPAN).html("<input type=text class='rename' id='"+e.tId+Y.id.INPUT+"' treeNode"+Y.id.INPUT+" >");var d=X("#"+e.tId+Y.id.INPUT);d.attr("value",e[g]);if(c.edit.editNameSelectAll){D.inputSelect(d)}else{D.inputFocus(d)}d.bind("blur",function(h){if(!T.editNodeBlur){T.cancelCurEditNode(c)}}).bind("keydown",function(h){if(h.keyCode=="13"){T.editNodeBlur=true;T.cancelCurEditNode(c,null,true)}else{if(h.keyCode=="27"){T.cancelCurEditNode(c,e[g])}}}).bind("click",function(h){return false}).bind("dblclick",function(h){return false});X("#"+e.tId+Y.id.A).addClass(Y.node.CURSELECTED_EDIT);f.curEditInput=d;f.noSelection=false;f.curEditNode=e},moveNode:function(n,z,v,c,Ab,p){var q=W.getRoot(n),f=n.data.key.children;if(z==v){return}if(n.data.keep.leaf&&z&&!z.isParent&&c==Y.move.TYPE_INNER){return}var g=(v.parentTId?v.getParentNode():q),Ac=(z===null||z==q);if(Ac&&z===null){z=q}if(Ac){c=Y.move.TYPE_INNER}var y=(z.parentTId?z.getParentNode():q);if(c!=Y.move.TYPE_PREV&&c!=Y.move.TYPE_NEXT){c=Y.move.TYPE_INNER}if(c==Y.move.TYPE_INNER){if(Ac){v.parentTId=null}else{if(!z.isParent){z.isParent=true;z.open=!!z.open;T.setNodeLineIcos(n,z)}v.parentTId=z.tId}}var r,t;if(Ac){r=n.treeObj;t=r}else{if(!p&&c==Y.move.TYPE_INNER){T.expandCollapseNode(n,z,true,false)}else{if(!p){T.expandCollapseNode(n,z.getParentNode(),true,false)}}r=X("#"+z.tId);t=X("#"+z.tId+Y.id.UL);if(!!r.get(0)&&!t.get(0)){var s=[];T.makeUlHtml(n,z,s,"");r.append(s.join(""))}t=X("#"+z.tId+Y.id.UL)}var w=X("#"+v.tId);if(!w.get(0)){w=T.appendNodes(n,v.level,[v],null,false,true).join("")}else{if(!r.get(0)){w.remove()}}if(t.get(0)&&c==Y.move.TYPE_INNER){t.append(w)}else{if(r.get(0)&&c==Y.move.TYPE_PREV){r.before(w)}else{if(r.get(0)&&c==Y.move.TYPE_NEXT){r.after(w)}}}var j,m,d=-1,k=0,u=null,x=null,o=v.level;if(v.isFirstNode){d=0;if(g[f].length>1){u=g[f][1];u.isFirstNode=true}}else{if(v.isLastNode){d=g[f].length-1;u=g[f][d-1];u.isLastNode=true}else{for(j=0,m=g[f].length;j<m;j++){if(g[f][j].tId==v.tId){d=j;break}}}}if(d>=0){g[f].splice(d,1)}if(c!=Y.move.TYPE_INNER){for(j=0,m=y[f].length;j<m;j++){if(y[f][j].tId==z.tId){k=j}}}if(c==Y.move.TYPE_INNER){if(!z[f]){z[f]=new Array()}if(z[f].length>0){x=z[f][z[f].length-1];x.isLastNode=false}z[f].splice(z[f].length,0,v);v.isLastNode=true;v.isFirstNode=(z[f].length==1)}else{if(z.isFirstNode&&c==Y.move.TYPE_PREV){y[f].splice(k,0,v);x=z;x.isFirstNode=false;v.parentTId=z.parentTId;v.isFirstNode=true;v.isLastNode=false}else{if(z.isLastNode&&c==Y.move.TYPE_NEXT){y[f].splice(k+1,0,v);x=z;x.isLastNode=false;v.parentTId=z.parentTId;v.isFirstNode=false;v.isLastNode=true}else{if(c==Y.move.TYPE_PREV){y[f].splice(k,0,v)}else{y[f].splice(k+1,0,v)}v.parentTId=z.parentTId;v.isFirstNode=false;v.isLastNode=false}}}W.fixPIdKeyValue(n,v);W.setSonNodeLevel(n,v.getParentNode(),v);T.setNodeLineIcos(n,v);T.repairNodeLevelClass(n,v,o);if(!n.data.keep.parent&&g[f].length<1){g.isParent=false;g.open=false;var h=X("#"+g.tId+Y.id.UL),e=X("#"+g.tId+Y.id.SWITCH),Aa=X("#"+g.tId+Y.id.ICON);T.replaceSwitchClass(g,e,Y.folder.DOCU);T.replaceIcoClass(g,Aa,Y.folder.DOCU);h.css("display","none")}else{if(u){T.setNodeLineIcos(n,u)}}if(x){T.setNodeLineIcos(n,x)}if(!!n.check&&n.check.enable&&T.repairChkClass){T.repairChkClass(n,g);T.repairParentChkClassWithSelf(n,g);if(g!=v.parent){T.repairParentChkClassWithSelf(n,v)}}if(!p){T.expandCollapseParentNode(n,v.getParentNode(),true,Ab)}},removeEditBtn:function(c){X("#"+c.tId+Y.id.EDIT).unbind().remove()},removeRemoveBtn:function(c){X("#"+c.tId+Y.id.REMOVE).unbind().remove()},removeTreeDom:function(c,d){d.isHover=false;T.removeEditBtn(d);T.removeRemoveBtn(d);D.apply(c.view.removeHoverDom,[c.treeId,d])},repairNodeLevelClass:function(g,i,f){if(f===i.level){return}var h=X("#"+i.tId),c=X("#"+i.tId+Y.id.A),d=X("#"+i.tId+Y.id.UL),e="level"+f,j="level"+i.level;h.removeClass(e);h.addClass(j);c.removeClass(e);c.addClass(j);d.removeClass(e);d.addClass(j)}},C={tools:U,view:R,event:M,data:L};X.extend(true,X.fn.zTree.consts,H);X.extend(true,X.fn.zTree._z,C);var P=X.fn.zTree,D=P._z.tools,Y=P.consts,T=P._z.view,W=P._z.data,F=P._z.event;W.exSetting(I);W.addInitBind(K);W.addInitUnBind(B);W.addInitCache(V);W.addInitNode(J);W.addInitProxy(E);W.addInitRoot(Q);W.addZTreeTools(O);var a=T.cancelPreSelectedNode;T.cancelPreSelectedNode=function(d,e){var f=W.getRoot(d).curSelectedList;for(var c=0,g=f.length;c<g;c++){if(!e||e===f[c]){T.removeTreeDom(d,f[c]);if(e){break}}}if(a){a.apply(T,arguments)}};var A=T.createNodes;T.createNodes=function(d,e,f,c){if(A){A.apply(T,arguments)}if(!f){return}if(T.repairParentChkClassWithSelf){T.repairParentChkClassWithSelf(d,c)}};var Z=T.makeNodeUrl;T.makeNodeUrl=function(c,d){return c.edit.enable?null:(Z.apply(T,arguments))};var G=T.removeNode;T.removeNode=function(c,d){var e=W.getRoot(c);if(e.curEditNode===d){e.curEditNode=null}if(G){G.apply(T,arguments)}};var S=T.selectNode;T.selectNode=function(d,e,c){var f=W.getRoot(d);if(W.isSelectedNode(d,e)&&f.curEditNode==e&&e.editNameFlag){return false}if(S){S.apply(T,arguments)}T.addHoverDom(d,e);return true};var b=D.uCanDo;D.uCanDo=function(c,d){var f=W.getRoot(c);if(d&&(D.eqs(d.type,"mouseover")||D.eqs(d.type,"mouseout")||D.eqs(d.type,"mousedown")||D.eqs(d.type,"mouseup"))){return true}return(!f.curEditNode)&&(b?b.apply(T,arguments):true)}})(jQuery);