(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}r[setting.data.key.children]=[];r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[];r.zId=0;r._ver=(new Date()).getTime()},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])});o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR).unbind(c.REMOVE)},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":if(!node.isParent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var r=data.getRoot(setting),childKey=setting.data.key.children;n.level=level;n.tId=setting.treeId+"_"+(++r.zId);n.parentTId=parentNode?parentNode.tId:null;n.open=(typeof n.open=="string")?tools.eqs(n.open,"true"):!!n.open;if(n[childKey]&&n[childKey].length>0){n.isParent=true;n.zAsync=true}else{n.isParent=(typeof n.isParent=="string")?tools.eqs(n.isParent,"true"):!!n.isParent;n.open=(n.isParent&&!setting.async.enable)?n.open:false;n.zAsync=!n.isParent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1)},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy,isFirst){if(!!isFirst){_init.proxys.splice(0,0,initProxy)}else{_init.proxys.push(initProxy)}},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,nodes){var childKey=setting.data.key.children;if(!parentNode[childKey]){parentNode[childKey]=[]}if(parentNode[childKey].length>0){parentNode[childKey][parentNode[childKey].length-1].isLastNode=false;view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])}parentNode.isParent=true;parentNode[childKey]=parentNode[childKey].concat(nodes)},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNextNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length-1;i<=l;i++){if(p[childKey][i]===node){return(i==l?null:p[childKey][i+1])}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}var childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){return nodes[i]}var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n?n:null},getNodeName:function(setting,node){var nameKey=setting.data.key.name;return""+node[nameKey]},getNodeTitle:function(setting,node){var t=setting.data.key.title===""?setting.data.key.name:setting.data.key.title;return""+node[t]},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){result.push(nodes[i])}result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++){if(typeof nodes[i][key]=="string"&&nodes[i][key].toLowerCase().indexOf(value)>-1){result.push(nodes[i])}result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes){return(isSingle?null:[])}var childKey=setting.data.key.children,result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i],invokeParam],false)){if(isSingle){return nodes[i]}result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle,invokeParam);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length;i<l;i++){if(p[childKey][i]===node){return(i==0?null:p[childKey][i-1])}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getRoots:function(){return roots},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){arguments.callee(setting,node[childKey][i])}}data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){r.push(nodes[i]);if(nodes[i][childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey]))}}}else{r.push(nodes);if(nodes[childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[childKey]))}}return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap=[];for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){if(tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]){if(!tmpMap[sNodes[i][parentKey]][childKey]){tmpMap[sNodes[i][parentKey]][childKey]=[]}tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++){_init.unbind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;if(!setting.view.txtSelectedEnable){o.bind("selectstart",function(e){var node;var n=e.originalEvent.srcElement.nodeName.toLowerCase();return(n==="input"||n==="textarea")}).css({"-moz-user-select":"-moz-none"})}o.bind("click",eventParam,event.proxy);o.bind("dblclick",eventParam,event.proxy);o.bind("mouseover",eventParam,event.proxy);o.bind("mouseout",eventParam,event.proxy);o.bind("mousedown",eventParam,event.proxy);o.bind("mouseup",eventParam,event.proxy);o.bind("contextmenu",eventParam,event.proxy)},unbindTree:function(setting){var o=setting.treeObj;o.unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}return r}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=((setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey))&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node])}return true},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node])}return true},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node])}return(typeof setting.callback.onRightClick)!="function"}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return(setting.async.enable&&node&&node.isParent&&!(node.zAsync||(node[childKey]&&node[childKey].length>0)))},clone:function(obj){if(obj===null){return null}var o=tools.isArray(obj)?[]:{};for(var i in obj){o[i]=(obj[i] instanceof Date)?new Date(obj[i].getTime()):(typeof obj[i]==="object"?arguments.callee(obj[i]):obj[i])}return o},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},$:function(node,exp,setting){if(!!exp&&typeof exp!="string"){setting=exp;exp=""}if(typeof node=="string"){return $(node,setting?setting.treeObj.get(0).ownerDocument:null)}else{return $("#"+node.tId+exp,setting?setting.treeObj:null)}},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},getNodeMainDom:function(target){return($(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0))},isChildOrSelf:function(dom,parentId){return($(dom).closest("#"+parentId).length>0)},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,newNodes,isSilent){if(setting.data.keep.leaf&&parentNode&&!parentNode.isParent){return}if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({"display":"none"})}data.addNodesData(setting,parentNode,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),newNodes);view.createNodes(setting,0,newNodes,null)}},appendNodes:function(setting,level,nodes,parentNode,initFlag,openFlag){if(!nodes){return[]}var html=[],childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(initFlag){var tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=tmpPNode[childKey],isFirstNode=((tmpPChild.length==nodes.length)&&(i==0)),isLastNode=(i==(nodes.length-1));data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var childHtml=[];if(node[childKey]&&node[childKey].length>0){childHtml=view.appendNodes(setting,level+1,node[childKey],node,initFlag,openFlag&&node.open)}if(openFlag){view.makeDOMNodeMainBefore(html,setting,node);view.makeDOMNodeLine(html,setting,node);data.getBeforeA(setting,node,html);view.makeDOMNodeNameBefore(html,setting,node);data.getInnerBeforeA(setting,node,html);view.makeDOMNodeIcon(html,setting,node);data.getInnerAfterA(setting,node,html);view.makeDOMNodeNameAfter(html,setting,node);data.getAfterA(setting,node,html);if(node.isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}view.makeDOMNodeMainAfter(html,setting,node);data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$$(node,setting)}var ulObj=$$(node,consts.id.UL,setting);if(ulObj.get(0)){ulObj.remove()}var childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));nObj.append(html.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({"style":"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1]}}else{for(var p in setting.async.otherParam){tmpParam[p]=setting.async.otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=data.getRoot(setting)._ver){return}if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node){var list=data.getRoot(setting).curSelectedList;for(var i=0,j=list.length-1;j>=i;j--){if(!node||node===list[j]){$$(list[j],consts.id.A,setting).removeClass(consts.node.CURSELECTED);if(node){data.removeSelectedNode(setting,node);break}}}if(!node){data.getRoot(setting).curSelectedList=[]}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode){if(!nodes||nodes.length==0){return}var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$$(parentNode[childKey][0],setting).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,true,openFlag);if(!parentNode){setting.treeObj.append(zTreeHtml.join(""))}else{var ulObj=$$(parentNode,consts.id.UL,setting);if(ulObj.get(0)){ulObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},destroy:function(setting){if(!setting){return}data.initCache(setting);data.initRoot(setting);event.unbindTree(setting);event.unbindEvent(setting);setting.treeObj.empty();delete settings[setting.treeId]},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children;if(!node){tools.apply(callback,[]);return}if(root.expandTriggerFlag){var _callback=callback;callback=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};root.expandTriggerFlag=false}if(!node.open&&node.isParent&&((!$$(node,consts.id.UL,setting).get(0))||(node[childKey]&&node[childKey].length>0&&!$$(node[childKey][0],setting).get(0)))){view.appendParentULDom(setting,node);view.createNodeCallback(setting)}if(node.open==expandFlag){tools.apply(callback,[]);return}var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);if(node.isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(node[childKey]&&node[childKey].length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(node[childKey]&&node[childKey].length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return}if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=(node)?node[childKey]:root[childKey],selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.getNodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"'>",name,"</span>")},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>")},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>")},makeDOMNodeNameBefore:function(html,setting,node){var title=data.getNodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,"' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title){html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">")},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(node.isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return consts.className.BUTTON+" "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=(node.isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node.icon;if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(node.isParent){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return}var childKey=setting.data.key.children,nodes=node[childKey];if(!nodes){return}for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[childKey];if(!setting.data.keep.parent){node.isParent=false;node.open=false;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$$(node,consts.id.UL,setting).remove()}else{$$(node,consts.id.UL,setting).empty()}},setFirstNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][0].isFirstNode=true}},setLastNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][childLength-1].isLastNode=true}},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};if(!data.getNodeCache(setting,node.tId)){return}$$(node,setting).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}}view.setFirstNode(setting,parentNode);view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=parentNode[childKey].length;if(!setting.data.keep.parent&&childLength==0){parentNode.isParent=false;parentNode.open=false;tmp_ulObj=$$(parentNode,consts.id.UL,setting);tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting);tmp_icoObj=$$(parentNode,consts.id.ICON,setting);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&childLength>0){var newLast=parentNode[childKey][childLength-1];tmp_ulObj=$$(newLast,consts.id.UL,setting);tmp_switchObj=$$(newLast,consts.id.SWITCH,setting);tmp_icoObj=$$(newLast,consts.id.ICON,setting);if(parentNode==root){if(parentNode[childKey].length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$$(parentNode[childKey][0],consts.id.SWITCH,setting);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting)}$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node)},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeLineIcos:function(setting,node){if(!node){return}var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(node.isParent){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var title=data.getNodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);nObj.empty();if(setting.view.nameIsHTML){nObj.html(data.getNodeName(setting,node))}else{nObj.text(data.getNodeName(setting,node))}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)){var aObj=$$(node,consts.id.A,setting);aObj.attr("title",!title?"":title)}},setNodeTarget:function(setting,node){var aObj=$$(node,consts.id.A,setting);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return}}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},destroy:function(treeId){if(!!treeId&&treeId.length>0){view.destroy(data.getSetting(treeId))}else{for(var s in settings){view.destroy(settings[s])}}},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if(typeof document.body.style.maxHeight==="undefined"){setting.view.expandSpeed=""}data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){root[childKey]=data.transformTozTreeFormat(setting,zNodes)}else{root[childKey]=zNodes}data.initCache(setting);event.unbindTree(setting);event.bindTree(setting);event.unbindEvent(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,newNodes,isSilent){if(!newNodes){return null}if(!parentNode){parentNode=null}if(parentNode&&!parentNode.isParent&&setting.data.keep.leaf){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node)},destroy:function(){view.destroy(setting)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!node.isParent){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(!tools.canAsync(setting,node)&&sonSign){view.expandCollapseSonNode(setting,node,expandFlag,true,function(){if(focus!==false){try{$$(node,setting).focus().blur()}catch(e){}}})}else{node.open=!expandFlag;view.switchNode(this.setting,node);if(focus!==false){try{$$(node,setting).focus().blur()}catch(e){}}}return expandFlag},getNodes:function(){return data.getNodes(setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),filter,isSingle,invokeParam)},getNodeIndex:function(node){if(!node){return null}var childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(!this.setting.async.enable){return}var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(setting)}if(reloadType=="refresh"){var childKey=this.setting.data.key.children;for(var i=0,l=parentNode[childKey]?parentNode[childKey].length:0;i<l;i++){data.removeNodeCache(setting,parentNode[childKey][i])}data.removeSelectedNode(setting);parentNode[childKey]=[];if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=root[setting.data.key.children];data.initRoot(setting);root[setting.data.key.children]=nodes;data.initCache(setting);view.createNodes(setting,0,root[setting.data.key.children])},removeChildNodes:function(node){if(!node){return null}var childKey=setting.data.key.children,nodes=node[childKey];view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return}callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return}view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag){if(!node){return}if(tools.uCanDo(setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true,false,function(){try{$$(node,setting).focus().blur()}catch(e){}})}else{try{$$(node,setting).focus().blur()}catch(e){}}view.selectNode(setting,node,addFlag)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return}var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){view.setNodeName(setting,node);view.setNodeTarget(setting,node);view.setNodeUrl(setting,node);view.setNodeLineIcos(setting,node);view.setNodeFontCss(setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);if(root[childKey]&&root[childKey].length>0){view.createNodes(setting,0,root[childKey])}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);(function(Y){var H={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},I={check:{enable:false,autoCheckTrigger:false,chkStyle:H.checkbox.STYLE,nocheckInherit:false,chkDisabledInherit:false,radioType:H.radio.TYPE_LEVEL,chkboxType:{"Y":"ps","N":"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},R=function(c){var b=X.getRoot(c);b.radioCheckedList=[]},W=function(b){},L=function(b){var d=b.treeObj,e=a.event;d.bind(e.CHECK,function(g,h,c,f){g.srcEvent=h;D.apply(b.callback.onCheck,[g,c,f])})},B=function(b){var d=b.treeObj,e=a.event;d.unbind(e.CHECK)},E=function(b){var k=b.target,f=X.getSetting(b.data.treeId),j="",i=null,h="",d="",c=null,g=null;if(D.eqs(b.type,"mouseover")){if(f.check.enable&&D.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+a.id.CHECK)!==null){j=D.getNodeMainDom(k).id;h="mouseoverCheck"}}else{if(D.eqs(b.type,"mouseout")){if(f.check.enable&&D.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+a.id.CHECK)!==null){j=D.getNodeMainDom(k).id;h="mouseoutCheck"}}else{if(D.eqs(b.type,"click")){if(f.check.enable&&D.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+a.id.CHECK)!==null){j=D.getNodeMainDom(k).id;h="checkNode"}}}}if(j.length>0){i=X.getNodeCache(f,j);switch(h){case"checkNode":c=O.onCheckNode;break;case"mouseoverCheck":c=O.onMouseoverCheck;break;case"mouseoutCheck":c=O.onMouseoutCheck;break}}var l={stop:h==="checkNode",node:i,nodeEventType:h,nodeEventCallback:c,treeEventType:d,treeEventCallback:g};return l},J=function(d,e,g,f,i,j,h){if(!g){return}var c=d.data.key.checked;if(typeof g[c]=="string"){g[c]=D.eqs(g[c],"true")}g[c]=!!g[c];g.checkedOld=g[c];if(typeof g.nocheck=="string"){g.nocheck=D.eqs(g.nocheck,"true")}g.nocheck=!!g.nocheck||(d.check.nocheckInherit&&f&&!!f.nocheck);if(typeof g.chkDisabled=="string"){g.chkDisabled=D.eqs(g.chkDisabled,"true")}g.chkDisabled=!!g.chkDisabled||(d.check.chkDisabledInherit&&f&&!!f.chkDisabled);if(typeof g.halfCheck=="string"){g.halfCheck=D.eqs(g.halfCheck,"true")}g.halfCheck=!!g.halfCheck;g.check_Child_State=-1;g.check_Focus=false;g.getCheckStatus=function(){return X.getCheckStatus(d,g)};if(d.check.chkStyle==a.radio.STYLE&&d.check.radioType==a.radio.TYPE_ALL&&g[c]){var b=X.getRoot(d);b.radioCheckedList.push(g)}},K=function(c,e,b){var d=c.data.key.checked;if(c.check.enable){X.makeChkFlag(c,e);b.push("<span ID='",e.tId,a.id.CHECK,"' class='",U.makeChkClass(c,e),"' treeNode",a.id.CHECK,(e.nocheck===true?" style='display:none;'":""),"></span>")}},P=function(b,c){c.checkNode=function(h,i,j,f){var g=this.setting.data.key.checked;if(h.chkDisabled===true){return}if(i!==true&&i!==false){i=!h[g]}f=!!f;if(h[g]===i&&!j){return}else{if(f&&D.apply(this.setting.callback.beforeCheck,[this.setting.treeId,h],true)==false){return}}if(D.uCanDo(this.setting)&&this.setting.check.enable&&h.nocheck!==true){h[g]=i;var e=Z(h,a.id.CHECK,this.setting);if(j||this.setting.check.chkStyle===a.radio.STYLE){U.checkNodeRelation(this.setting,h)}U.setChkClass(this.setting,e,h);U.repairParentChkClassWithSelf(this.setting,h);if(f){this.setting.treeObj.trigger(a.event.CHECK,[null,this.setting.treeId,h])}}};c.checkAllNodes=function(e){U.repairAllChk(this.setting,!!e)};c.getCheckedNodes=function(e){var f=this.setting.data.key.children;e=(e!==false);return X.getTreeCheckedNodes(this.setting,X.getRoot(this.setting)[f],e)};c.getChangeCheckedNodes=function(){var e=this.setting.data.key.children;return X.getTreeChangeCheckedNodes(this.setting,X.getRoot(this.setting)[e])};c.setChkDisabled=function(g,h,e,f){h=!!h;e=!!e;f=!!f;U.repairSonChkDisabled(this.setting,g,h,f);U.repairParentChkDisabled(this.setting,g.getParentNode(),h,e)};var d=c.updateNode;c.updateNode=function(g,h){if(d){d.apply(c,arguments)}if(!g||!this.setting.check.enable){return}var f=Z(g,this.setting);if(f.get(0)&&D.uCanDo(this.setting)){var e=Z(g,a.id.CHECK,this.setting);if(h==true||this.setting.check.chkStyle===a.radio.STYLE){U.checkNodeRelation(this.setting,g)}U.setChkClass(this.setting,e,g);U.repairParentChkClassWithSelf(this.setting,g)}}},M={getRadioCheckedList:function(c){var d=X.getRoot(c).radioCheckedList;for(var b=0,e=d.length;b<e;b++){if(!X.getNodeCache(c,d[b].tId)){d.splice(b,1);b--;e--}}return d},getCheckStatus:function(c,e){if(!c.check.enable||e.nocheck||e.chkDisabled){return null}var d=c.data.key.checked,b={checked:e[d],half:e.halfCheck?e.halfCheck:(c.check.chkStyle==a.radio.STYLE?(e.check_Child_State===2):(e[d]?(e.check_Child_State>-1&&e.check_Child_State<2):(e.check_Child_State>0)))};return b},getTreeCheckedNodes:function(c,h,k,e){if(!h){return[]}var g=c.data.key.children,b=c.data.key.checked,f=(k&&c.check.chkStyle==a.radio.STYLE&&c.check.radioType==a.radio.TYPE_ALL);e=!e?[]:e;for(var d=0,j=h.length;d<j;d++){if(h[d].nocheck!==true&&h[d].chkDisabled!==true&&h[d][b]==k){e.push(h[d]);if(f){break}}X.getTreeCheckedNodes(c,h[d][g],k,e);if(f&&e.length>0){break}}return e},getTreeChangeCheckedNodes:function(c,f,g){if(!f){return[]}var h=c.data.key.children,d=c.data.key.checked;g=!g?[]:g;for(var b=0,e=f.length;b<e;b++){if(f[b].nocheck!==true&&f[b].chkDisabled!==true&&f[b][d]!=f[b].checkedOld){g.push(f[b])}X.getTreeChangeCheckedNodes(c,f[b][h],g)}return g},makeChkFlag:function(e,g){if(!g){return}var j=e.data.key.children,c=e.data.key.checked,f=-1;if(g[j]){for(var k=0,h=g[j].length;k<h;k++){var d=g[j][k];var b=-1;if(e.check.chkStyle==a.radio.STYLE){if(d.nocheck===true||d.chkDisabled===true){b=d.check_Child_State}else{if(d.halfCheck===true){b=2}else{if(d[c]){b=2}else{b=d.check_Child_State>0?2:0}}}if(b==2){f=2;break}else{if(b==0){f=0}}}else{if(e.check.chkStyle==a.checkbox.STYLE){if(d.nocheck===true||d.chkDisabled===true){b=d.check_Child_State}else{if(d.halfCheck===true){b=1}else{if(d[c]){b=(d.check_Child_State===-1||d.check_Child_State===2)?2:1}else{b=(d.check_Child_State>0)?1:0}}}if(b===1){f=1;break}else{if(b===2&&f>-1&&k>0&&b!==f){f=1;break}else{if(f===2&&b>-1&&b<2){f=1;break}else{if(b>-1){f=b}}}}}}}}g.check_Child_State=f}},N={},O={onCheckNode:function(f,e){if(e.chkDisabled===true){return false}var c=X.getSetting(f.data.treeId),d=c.data.key.checked;if(D.apply(c.callback.beforeCheck,[c.treeId,e],true)==false){return true}e[d]=!e[d];U.checkNodeRelation(c,e);var b=Z(e,a.id.CHECK,c);U.setChkClass(c,b,e);U.repairParentChkClassWithSelf(c,e);c.treeObj.trigger(a.event.CHECK,[f,c.treeId,e]);return true},onMouseoverCheck:function(e,d){if(d.chkDisabled===true){return false}var b=X.getSetting(e.data.treeId),c=Z(d,a.id.CHECK,b);d.check_Focus=true;U.setChkClass(b,c,d);return true},onMouseoutCheck:function(e,d){if(d.chkDisabled===true){return false}var b=X.getSetting(e.data.treeId),c=Z(d,a.id.CHECK,b);d.check_Focus=false;U.setChkClass(b,c,d);return true}},V={},T={checkNodeRelation:function(f,h){var d,g,j,m=f.data.key.children,e=f.data.key.checked,b=a.radio;if(f.check.chkStyle==b.STYLE){var k=X.getRadioCheckedList(f);if(h[e]){if(f.check.radioType==b.TYPE_ALL){for(g=k.length-1;g>=0;g--){d=k[g];if(d[e]&&d!=h){d[e]=false;k.splice(g,1);U.setChkClass(f,Z(d,a.id.CHECK,f),d);if(d.parentTId!=h.parentTId){U.repairParentChkClassWithSelf(f,d)}}}k.push(h)}else{var c=(h.parentTId)?h.getParentNode():X.getRoot(f);for(g=0,j=c[m].length;g<j;g++){d=c[m][g];if(d[e]&&d!=h){d[e]=false;U.setChkClass(f,Z(d,a.id.CHECK,f),d)}}}}else{if(f.check.radioType==b.TYPE_ALL){for(g=0,j=k.length;g<j;g++){if(h==k[g]){k.splice(g,1);break}}}}}else{if(h[e]&&(!h[m]||h[m].length==0||f.check.chkboxType.Y.indexOf("s")>-1)){U.setSonNodeCheckBox(f,h,true)}if(!h[e]&&(!h[m]||h[m].length==0||f.check.chkboxType.N.indexOf("s")>-1)){U.setSonNodeCheckBox(f,h,false)}if(h[e]&&f.check.chkboxType.Y.indexOf("p")>-1){U.setParentNodeCheckBox(f,h,true)}if(!h[e]&&f.check.chkboxType.N.indexOf("p")>-1){U.setParentNodeCheckBox(f,h,false)}}},makeChkClass:function(e,g){var f=e.data.key.checked,i=a.checkbox,d=a.radio,h="";if(g.chkDisabled===true){h=i.DISABLED}else{if(g.halfCheck){h=i.PART}else{if(e.check.chkStyle==d.STYLE){h=(g.check_Child_State<1)?i.FULL:i.PART}else{h=g[f]?((g.check_Child_State===2||g.check_Child_State===-1)?i.FULL:i.PART):((g.check_Child_State<1)?i.FULL:i.PART)}}}var b=e.check.chkStyle+"_"+(g[f]?i.TRUE:i.FALSE)+"_"+h;b=(g.check_Focus&&g.chkDisabled!==true)?b+"_"+i.FOCUS:b;return a.className.BUTTON+" "+i.DEFAULT+" "+b},repairAllChk:function(b,j){if(b.check.enable&&b.check.chkStyle===a.checkbox.STYLE){var c=b.data.key.checked,h=b.data.key.children,d=X.getRoot(b);for(var e=0,g=d[h].length;e<g;e++){var f=d[h][e];if(f.nocheck!==true&&f.chkDisabled!==true){f[c]=j}U.setSonNodeCheckBox(b,f,j)}}},repairChkClass:function(b,d){if(!d){return}X.makeChkFlag(b,d);if(d.nocheck!==true){var c=Z(d,a.id.CHECK,b);U.setChkClass(b,c,d)}},repairParentChkClass:function(b,d){if(!d||!d.parentTId){return}var c=d.getParentNode();U.repairChkClass(b,c);U.repairParentChkClass(b,c)},repairParentChkClassWithSelf:function(b,c){if(!c){return}var d=b.data.key.children;if(c[d]&&c[d].length>0){U.repairParentChkClass(b,c[d][0])}else{U.repairParentChkClass(b,c)}},repairSonChkDisabled:function(b,e,c,j){if(!e){return}var g=b.data.key.children;if(e.chkDisabled!=c){e.chkDisabled=c}U.repairChkClass(b,e);if(e[g]&&j){for(var d=0,f=e[g].length;d<f;d++){var h=e[g][d];U.repairSonChkDisabled(b,h,c,j)}}},repairParentChkDisabled:function(b,c,e,d){if(!c){return}if(c.chkDisabled!=e&&d){c.chkDisabled=e}U.repairChkClass(b,c);U.repairParentChkDisabled(b,c.getParentNode(),e,d)},setChkClass:function(c,d,b){if(!d){return}if(b.nocheck===true){d.hide()}else{d.show()}d.attr("class",U.makeChkClass(c,b))},setParentNodeCheckBox:function(d,g,e,b){var j=d.data.key.children,c=d.data.key.checked,f=Z(g,a.id.CHECK,d);if(!b){b=g}X.makeChkFlag(d,g);if(g.nocheck!==true&&g.chkDisabled!==true){g[c]=e;U.setChkClass(d,f,g);if(d.check.autoCheckTrigger&&g!=b){d.treeObj.trigger(a.event.CHECK,[null,d.treeId,g])}}if(g.parentTId){var n=true;if(!e){var m=g.getParentNode()[j];for(var h=0,k=m.length;h<k;h++){if((m[h].nocheck!==true&&m[h].chkDisabled!==true&&m[h][c])||((m[h].nocheck===true||m[h].chkDisabled===true)&&m[h].check_Child_State>0)){n=false;break}}}if(n){U.setParentNodeCheckBox(d,g.getParentNode(),e,b)}}},setSonNodeCheckBox:function(e,h,f,c){if(!h){return}var k=e.data.key.children,d=e.data.key.checked,g=Z(h,a.id.CHECK,e);if(!c){c=h}var b=false;if(h[k]){for(var j=0,m=h[k].length;j<m&&h.chkDisabled!==true;j++){var n=h[k][j];U.setSonNodeCheckBox(e,n,f,c);if(n.chkDisabled===true){b=true}}}if(h!=X.getRoot(e)&&h.chkDisabled!==true){if(b&&h.nocheck!==true){X.makeChkFlag(e,h)}if(h.nocheck!==true&&h.chkDisabled!==true){h[d]=f;if(!b){h.check_Child_State=(h[k]&&h[k].length>0)?(f?2:0):-1}}else{h.check_Child_State=-1}U.setChkClass(e,g,h);if(e.check.autoCheckTrigger&&h!=c&&h.nocheck!==true&&h.chkDisabled!==true){e.treeObj.trigger(a.event.CHECK,[null,e.treeId,h])}}}},C={tools:V,view:T,event:N,data:M};Y.extend(true,Y.fn.zTree.consts,H);Y.extend(true,Y.fn.zTree._z,C);var Q=Y.fn.zTree,D=Q._z.tools,a=Q.consts,U=Q._z.view,X=Q._z.data,F=Q._z.event,Z=D.$;X.exSetting(I);X.addInitBind(L);X.addInitUnBind(B);X.addInitCache(W);X.addInitNode(J);X.addInitProxy(E,true);X.addInitRoot(R);X.addBeforeA(K);X.addZTreeTools(P);var A=U.createNodes;U.createNodes=function(c,d,e,b){if(A){A.apply(U,arguments)}if(!e){return}U.repairParentChkClassWithSelf(c,b)};var G=U.removeNode;U.removeNode=function(c,d){var b=d.getParentNode();if(G){G.apply(U,arguments)}if(!d||!b){return}U.repairChkClass(c,b);U.repairParentChkClass(c,b)};var S=U.appendNodes;U.appendNodes=function(c,d,g,b,h,f){var e="";if(S){e=S.apply(U,arguments)}if(b){X.makeChkFlag(c,b)}return e}})(jQuery);(function(X){var H={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},I={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},Q=function(f){var e=W.getRoot(f),d=W.getRoots();e.curEditNode=null;e.curEditInput=null;e.curHoverNode=null;e.dragFlag=0;e.dragNodeShowBefore=[];e.dragMaskList=new Array();d.showHoverDom=true},V=function(d){},K=function(d){var e=d.treeObj;var f=Z.event;e.bind(f.RENAME,function(j,h,i,g){D.apply(d.callback.onRename,[j,h,i,g])});e.bind(f.DRAG,function(i,j,h,g){D.apply(d.callback.onDrag,[j,h,g])});e.bind(f.DRAGMOVE,function(i,j,h,g){D.apply(d.callback.onDragMove,[j,h,g])});e.bind(f.DROP,function(k,m,i,g,h,l,j){D.apply(d.callback.onDrop,[m,i,g,h,l,j])})},B=function(d){var e=d.treeObj;var f=Z.event;e.unbind(f.RENAME);e.unbind(f.DRAG);e.unbind(f.DRAGMOVE);e.unbind(f.DROP)},E=function(h){var o=h.target,j=W.getSetting(h.data.treeId),d=h.relatedTarget,n="",m=null,l="",g="",f=null,k=null,i=null;if(D.eqs(h.type,"mouseover")){i=D.getMDom(j,o,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(i){n=D.getNodeMainDom(i).id;l="hoverOverNode"}}else{if(D.eqs(h.type,"mouseout")){i=D.getMDom(j,d,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(!i){n="remove";l="hoverOutNode"}}else{if(D.eqs(h.type,"mousedown")){i=D.getMDom(j,o,[{tagName:"a",attrName:"treeNode"+Z.id.A}]);if(i){n=D.getNodeMainDom(i).id;l="mousedownNode"}}}}if(n.length>0){m=W.getNodeCache(j,n);switch(l){case"mousedownNode":f=N.onMousedownNode;break;case"hoverOverNode":f=N.onHoverOverNode;break;case"hoverOutNode":f=N.onHoverOutNode;break}}var p={stop:false,node:m,nodeEventType:l,nodeEventCallback:f,treeEventType:g,treeEventCallback:k};return p},J=function(f,g,h,d,j,e,i){if(!h){return}h.isHover=false;h.editNameFlag=false},O=function(d,e){e.cancelEditName=function(g){var f=W.getRoot(this.setting);if(!f.curEditNode){return}T.cancelCurEditNode(this.setting,g?g:null,true)};e.copyNode=function(h,i,f,k){if(!i){return null}if(h&&!h.isParent&&this.setting.data.keep.leaf&&f===Z.move.TYPE_INNER){return null}var g=this,l=D.clone(i);if(!h){h=null;f=Z.move.TYPE_INNER}if(f==Z.move.TYPE_INNER){function j(){T.addNodes(g.setting,h,[l],k)}if(D.canAsync(this.setting,h)){T.asyncNode(this.setting,h,k,j)}else{j()}}else{T.addNodes(this.setting,h.parentNode,[l],k);T.moveNode(this.setting,h,l,f,false,k)}return l};e.editName=function(f){if(!f||!f.tId||f!==W.getNodeCache(this.setting,f.tId)){return}if(f.parentTId){T.expandCollapseParentNode(this.setting,f.getParentNode(),true)}T.editNode(this.setting,f)};e.moveNode=function(i,j,f,k){if(!j){return j}if(i&&!i.isParent&&this.setting.data.keep.leaf&&f===Z.move.TYPE_INNER){return null}else{if(i&&((j.parentTId==i.tId&&f==Z.move.TYPE_INNER)||Y(j,this.setting).find("#"+i.tId).length>0)){return null}else{if(!i){i=null}}}var g=this;function h(){T.moveNode(g.setting,i,j,f,false,k)}if(D.canAsync(this.setting,i)&&f===Z.move.TYPE_INNER){T.asyncNode(this.setting,i,k,h)}else{h()}return j};e.setEditable=function(f){this.setting.edit.enable=f;return this.refresh()}},L={setSonNodeLevel:function(f,d,g){if(!g){return}var j=f.data.key.children;g.level=(d)?d.level+1:0;if(!g[j]){return}for(var e=0,h=g[j].length;e<h;e++){if(g[j][e]){W.setSonNodeLevel(f,g,g[j][e])}}}},M={},N={onHoverOverNode:function(g,e){var d=W.getSetting(g.data.treeId),f=W.getRoot(d);if(f.curHoverNode!=e){N.onHoverOutNode(g)}f.curHoverNode=e;T.addHoverDom(d,e)},onHoverOutNode:function(g,e){var d=W.getSetting(g.data.treeId),f=W.getRoot(d);if(f.curHoverNode&&!W.isSelectedNode(d,f.curHoverNode)){T.removeTreeDom(d,f.curHoverNode);f.curHoverNode=null}},onMousedownNode:function(Ad,y){var n,q,Ab=W.getSetting(Ad.data.treeId),w=W.getRoot(Ab),r=W.getRoots();if(Ad.button==2||!Ab.edit.enable||(!Ab.edit.drag.isCopy&&!Ab.edit.drag.isMove)){return true}var Ae=Ad.target,j=W.getRoot(Ab).curSelectedList,k=[];if(!W.isSelectedNode(Ab,y)){k=[y]}else{for(n=0,q=j.length;n<q;n++){if(j[n].editNameFlag&&D.eqs(Ae.tagName,"input")&&Ae.getAttribute("treeNode"+Z.id.INPUT)!==null){return true}k.push(j[n]);if(k[0].parentTId!==j[n].parentTId){k=[y];break}}}T.editNodeBlur=true;T.cancelCurEditNode(Ab);var x=X(Ab.treeObj.get(0).ownerDocument),s=X(Ab.treeObj.get(0).ownerDocument.body),Ah,Af,g,Ac=false,d=Ab,Aa=Ab,z,v,Ai=null,p=null,h=null,Ag=Z.move.TYPE_INNER,e=Ad.clientX,u=Ad.clientY,t=(new Date()).getTime();if(D.uCanDo(Ab)){x.bind("mousemove",m)}function m(AJ){if(w.dragFlag==0&&Math.abs(e-AJ.clientX)<Ab.edit.drag.minMoveSize&&Math.abs(u-AJ.clientY)<Ab.edit.drag.minMoveSize){return true}var A1,A3,AR,Aq,AI,AD=Ab.data.key.children;s.css("cursor","pointer");if(w.dragFlag==0){if(D.apply(Ab.callback.beforeDrag,[Ab.treeId,k],true)==false){o(AJ);return true}for(A1=0,A3=k.length;A1<A3;A1++){if(A1==0){w.dragNodeShowBefore=[]}AR=k[A1];if(AR.isParent&&AR.open){T.expandCollapseNode(Ab,AR,!AR.open);w.dragNodeShowBefore[AR.tId]=true}else{w.dragNodeShowBefore[AR.tId]=false}}w.dragFlag=1;r.showHoverDom=false;D.showIfameMask(Ab,true);var AB=true,AQ=-1;if(k.length>1){var Au=k[0].parentTId?k[0].getParentNode()[AD]:W.getNodes(Ab);AI=[];for(A1=0,A3=Au.length;A1<A3;A1++){if(w.dragNodeShowBefore[Au[A1].tId]!==undefined){if(AB&&AQ>-1&&(AQ+1)!==A1){AB=false}AI.push(Au[A1]);AQ=A1}if(k.length===AI.length){k=AI;break}}}if(AB){z=k[0].getPreNode();v=k[k.length-1].getNextNode()}Ah=Y("<ul class='zTreeDragUL'></ul>",Ab);for(A1=0,A3=k.length;A1<A3;A1++){AR=k[A1];AR.editNameFlag=false;T.selectNode(Ab,AR,A1>0);T.removeTreeDom(Ab,AR);if(A1>Ab.edit.drag.maxShowNodeNum-1){continue}Aq=Y("<li id='"+AR.tId+"_tmp'></li>",Ab);Aq.append(Y(AR,Z.id.A,Ab).clone());Aq.css("padding","0");Aq.children("#"+AR.tId+Z.id.A).removeClass(Z.node.CURSELECTED);Ah.append(Aq);if(A1==Ab.edit.drag.maxShowNodeNum-1){Aq=Y("<li id='"+AR.tId+"_moretmp'><a>  ...  </a></li>",Ab);Ah.append(Aq)}}Ah.attr("id",k[0].tId+Z.id.UL+"_tmp");Ah.addClass(Ab.treeObj.attr("class"));Ah.appendTo(s);Af=Y("<span class='tmpzTreeMove_arrow'></span>",Ab);Af.attr("id","zTreeMove_arrow_tmp");Af.appendTo(s);Ab.treeObj.trigger(Z.event.DRAG,[AJ,Ab.treeId,k])}if(w.dragFlag==1){if(g&&Af.attr("id")==AJ.target.id&&h&&(AJ.clientX+x.scrollLeft()+2)>(X("#"+h+Z.id.A,g).offset().left)){var AV=X("#"+h+Z.id.A,g);AJ.target=(AV.length>0)?AV.get(0):AJ.target}else{if(g){g.removeClass(Z.node.TMPTARGET_TREE);if(h){X("#"+h+Z.id.A,g).removeClass(Z.node.TMPTARGET_NODE+"_"+Z.move.TYPE_PREV).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}}g=null;h=null;Ac=false;d=Ab;var AW=W.getSettings();for(var AX in AW){if(AW[AX].treeId&&AW[AX].edit.enable&&AW[AX].treeId!=Ab.treeId&&(AJ.target.id==AW[AX].treeId||X(AJ.target).parents("#"+AW[AX].treeId).length>0)){Ac=true;d=AW[AX]}}var AU=x.scrollTop(),Aw=x.scrollLeft(),AG=d.treeObj.offset(),AS=d.treeObj.get(0).scrollHeight,Am=d.treeObj.get(0).scrollWidth,AP=(AJ.clientY+AU-AG.top),Az=(d.treeObj.height()+AG.top-AJ.clientY-AU),AM=(AJ.clientX+Aw-AG.left),A6=(d.treeObj.width()+AG.left-AJ.clientX-Aw),AC=(AP<Ab.edit.drag.borderMax&&AP>Ab.edit.drag.borderMin),AZ=(Az<Ab.edit.drag.borderMax&&Az>Ab.edit.drag.borderMin),A2=(AM<Ab.edit.drag.borderMax&&AM>Ab.edit.drag.borderMin),AE=(A6<Ab.edit.drag.borderMax&&A6>Ab.edit.drag.borderMin),AH=AP>Ab.edit.drag.borderMin&&Az>Ab.edit.drag.borderMin&&AM>Ab.edit.drag.borderMin&&A6>Ab.edit.drag.borderMin,A0=(AC&&d.treeObj.scrollTop()<=0),A7=(AZ&&(d.treeObj.scrollTop()+d.treeObj.height()+10)>=AS),Ay=(A2&&d.treeObj.scrollLeft()<=0),AA=(AE&&(d.treeObj.scrollLeft()+d.treeObj.width()+10)>=Am);if(AJ.target&&D.isChildOrSelf(AJ.target,d.treeId)){var AN=AJ.target;while(AN&&AN.tagName&&!D.eqs(AN.tagName,"li")&&AN.id!=d.treeId){AN=AN.parentNode}var As=true;for(A1=0,A3=k.length;A1<A3;A1++){AR=k[A1];if(AN.id===AR.tId){As=false;break}else{if(Y(AR,Ab).find("#"+AN.id).length>0){As=false;break}}}if(As&&AJ.target&&D.isChildOrSelf(AJ.target,AN.id+Z.id.A)){g=X(AN);h=AN.id}}AR=k[0];if(AH&&D.isChildOrSelf(AJ.target,d.treeId)){if(!g&&(AJ.target.id==d.treeId||A0||A7||Ay||AA)&&(Ac||(!Ac&&AR.parentTId))){g=d.treeObj}if(AC){d.treeObj.scrollTop(d.treeObj.scrollTop()-10)}else{if(AZ){d.treeObj.scrollTop(d.treeObj.scrollTop()+10)}}if(A2){d.treeObj.scrollLeft(d.treeObj.scrollLeft()-10)}else{if(AE){d.treeObj.scrollLeft(d.treeObj.scrollLeft()+10)}}if(g&&g!=d.treeObj&&g.offset().left<d.treeObj.offset().left){d.treeObj.scrollLeft(d.treeObj.scrollLeft()+g.offset().left-d.treeObj.offset().left)}}Ah.css({"top":(AJ.clientY+AU+3)+"px","left":(AJ.clientX+Aw+3)+"px"});var A4=0;var Ar=0;if(g&&g.attr("id")!=d.treeId){var AT=h==null?null:W.getNodeCache(d,h),Aj=((AJ.ctrlKey||AJ.metaKey)&&Ab.edit.drag.isMove&&Ab.edit.drag.isCopy)||(!Ab.edit.drag.isMove&&Ab.edit.drag.isCopy),AF=!!(z&&h===z.tId),AO=!!(v&&h===v.tId),AL=(AR.parentTId&&AR.parentTId==h),Al=(Aj||!AO)&&D.apply(d.edit.drag.prev,[d.treeId,k,AT],!!d.edit.drag.prev),Ap=(Aj||!AF)&&D.apply(d.edit.drag.next,[d.treeId,k,AT],!!d.edit.drag.next),Ao=(Aj||!AL)&&!(d.data.keep.leaf&&!AT.isParent)&&D.apply(d.edit.drag.inner,[d.treeId,k,AT],!!d.edit.drag.inner);if(!Al&&!Ap&&!Ao){g=null;h="";Ag=Z.move.TYPE_INNER;Af.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var A5=X("#"+h+Z.id.A,g),Ak=AT.isLastNode?null:X("#"+AT.getNextNode().tId+Z.id.A,g.next()),An=A5.offset().top,Ax=A5.offset().left,AK=Al?(Ao?0.25:(Ap?0.5:1)):-1,AY=Ap?(Ao?0.75:(Al?0.5:0)):-1,At=(AJ.clientY+AU-An)/A5.height();if((AK==1||At<=AK&&At>=-0.2)&&Al){A4=1-Af.width();Ar=An-Af.height()/2;Ag=Z.move.TYPE_PREV}else{if((AY==0||At>=AY&&At<=1.2)&&Ap){A4=1-Af.width();Ar=(Ak==null||(AT.isParent&&AT.open))?(An+A5.height()-Af.height()/2):(Ak.offset().top-Af.height()/2);Ag=Z.move.TYPE_NEXT}else{A4=5-Af.width();Ar=An;Ag=Z.move.TYPE_INNER}}Af.css({"display":"block","top":Ar+"px","left":(Ax+A4)+"px"});A5.addClass(Z.node.TMPTARGET_NODE+"_"+Ag);if(Ai!=h||p!=Ag){t=(new Date()).getTime()}if(AT&&AT.isParent&&Ag==Z.move.TYPE_INNER){var Av=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==AT.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===AT.tId){Av=false}}if(Av){window.zTreeMoveTimer=setTimeout(function(){if(Ag!=Z.move.TYPE_INNER){return}if(AT&&AT.isParent&&!AT.open&&(new Date()).getTime()-t>d.edit.drag.autoOpenTime&&D.apply(d.callback.beforeDragOpen,[d.treeId,AT],true)){T.switchNode(d,AT);if(d.edit.drag.autoExpandTrigger){d.treeObj.trigger(Z.event.EXPAND,[d.treeId,AT])}}},d.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=AT.tId}}}}else{Ag=Z.move.TYPE_INNER;if(g&&D.apply(d.edit.drag.inner,[d.treeId,k,null],!!d.edit.drag.inner)){g.addClass(Z.node.TMPTARGET_TREE)}else{g=null}Af.css({"display":"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}Ai=h;p=Ag;Ab.treeObj.trigger(Z.event.DRAGMOVE,[AJ,Ab.treeId,k])}return false}x.bind("mouseup",o);function o(Ak){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}Ai=null;p=null;x.unbind("mousemove",m);x.unbind("mouseup",o);x.unbind("selectstart",f);s.css("cursor","auto");if(g){g.removeClass(Z.node.TMPTARGET_TREE);if(h){X("#"+h+Z.id.A,g).removeClass(Z.node.TMPTARGET_NODE+"_"+Z.move.TYPE_PREV).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_NEXT).removeClass(Z.node.TMPTARGET_NODE+"_"+H.move.TYPE_INNER)}}D.showIfameMask(Ab,false);r.showHoverDom=true;if(w.dragFlag==0){return}w.dragFlag=0;var Al,An,Aq;for(Al=0,An=k.length;Al<An;Al++){Aq=k[Al];if(Aq.isParent&&w.dragNodeShowBefore[Aq.tId]&&!Aq.open){T.expandCollapseNode(Ab,Aq,!Aq.open);delete w.dragNodeShowBefore[Aq.tId]}}if(Ah){Ah.remove()}if(Af){Af.remove()}var Ao=((Ak.ctrlKey||Ak.metaKey)&&Ab.edit.drag.isMove&&Ab.edit.drag.isCopy)||(!Ab.edit.drag.isMove&&Ab.edit.drag.isCopy);if(!Ao&&g&&h&&k[0].parentTId&&h==k[0].parentTId&&Ag==Z.move.TYPE_INNER){g=null}if(g){var Am=h==null?null:W.getNodeCache(d,h);if(D.apply(Ab.callback.beforeDrop,[d.treeId,k,Am,Ag,Ao],true)==false){T.selectNodes(Aa,k);return}var Ap=Ao?D.clone(k):k;function Aj(){if(Ac){if(!Ao){for(var Ar=0,As=k.length;Ar<As;Ar++){T.removeNode(Ab,k[Ar])}}if(Ag==Z.move.TYPE_INNER){T.addNodes(d,Am,Ap)}else{T.addNodes(d,Am.getParentNode(),Ap);if(Ag==Z.move.TYPE_PREV){for(Ar=0,As=Ap.length;Ar<As;Ar++){T.moveNode(d,Am,Ap[Ar],Ag,false)}}else{for(Ar=-1,As=Ap.length-1;Ar<As;As--){T.moveNode(d,Am,Ap[As],Ag,false)}}}}else{if(Ao&&Ag==Z.move.TYPE_INNER){T.addNodes(d,Am,Ap)}else{if(Ao){T.addNodes(d,Am.getParentNode(),Ap)}if(Ag!=Z.move.TYPE_NEXT){for(Ar=0,As=Ap.length;Ar<As;Ar++){T.moveNode(d,Am,Ap[Ar],Ag,false)}}else{for(Ar=-1,As=Ap.length-1;Ar<As;As--){T.moveNode(d,Am,Ap[As],Ag,false)}}}}T.selectNodes(d,Ap);Y(Ap[0],Ab).focus().blur();Ab.treeObj.trigger(Z.event.DROP,[Ak,d.treeId,Ap,Am,Ag,Ao])}if(Ag==Z.move.TYPE_INNER&&D.canAsync(d,Am)){T.asyncNode(d,Am,false,Aj)}else{Aj()}}else{T.selectNodes(Aa,k);Ab.treeObj.trigger(Z.event.DROP,[Ak,Ab.treeId,k,null,null,null])}}x.bind("selectstart",f);function f(){return false}if(Ad.preventDefault){Ad.preventDefault()}return true}},U={getAbs:function(d){var f=d.getBoundingClientRect(),e=document.body.scrollTop+document.documentElement.scrollTop,g=document.body.scrollLeft+document.documentElement.scrollLeft;return[f.left+g,f.top+e]},inputFocus:function(d){if(d.get(0)){d.focus();D.setCursorPosition(d.get(0),d.val().length)}},inputSelect:function(d){if(d.get(0)){d.focus();d.select()}},setCursorPosition:function(d,e){if(d.setSelectionRange){d.focus();d.setSelectionRange(e,e)}else{if(d.createTextRange){var f=d.createTextRange();f.collapse(true);f.moveEnd("character",e);f.moveStart("character",e);f.select()}}},showIfameMask:function(e,f){var g=W.getRoot(e);while(g.dragMaskList.length>0){g.dragMaskList[0].remove();g.dragMaskList.shift()}if(f){var j=Y("iframe",e);for(var h=0,k=j.length;h<k;h++){var m=j.get(h),d=D.getAbs(m),n=Y("<div id='zTreeMask_"+h+"' class='zTreeMask' style='top:"+d[1]+"px; left:"+d[0]+"px; width:"+m.offsetWidth+"px; height:"+m.offsetHeight+"px;'></div>",e);n.appendTo(Y("body",e));g.dragMaskList.push(n)}}}},R={addEditBtn:function(e,f){if(f.editNameFlag||Y(f,Z.id.EDIT,e).length>0){return}if(!D.apply(e.edit.showRenameBtn,[e.treeId,f],e.edit.showRenameBtn)){return}var g=Y(f,Z.id.A,e),d="<span class='"+Z.className.BUTTON+" edit' id='"+f.tId+Z.id.EDIT+"' title='"+D.apply(e.edit.renameTitle,[e.treeId,f],e.edit.renameTitle)+"' treeNode"+Z.id.EDIT+" style='display:none;'></span>";g.append(d);Y(f,Z.id.EDIT,e).bind("click",function(){if(!D.uCanDo(e)||D.apply(e.callback.beforeEditName,[e.treeId,f],true)==false){return false}T.editNode(e,f);return false}).show()},addRemoveBtn:function(d,e){if(e.editNameFlag||Y(e,Z.id.REMOVE,d).length>0){return}if(!D.apply(d.edit.showRemoveBtn,[d.treeId,e],d.edit.showRemoveBtn)){return}var f=Y(e,Z.id.A,d),g="<span class='"+Z.className.BUTTON+" remove' id='"+e.tId+Z.id.REMOVE+"' title='"+D.apply(d.edit.removeTitle,[d.treeId,e],d.edit.removeTitle)+"' treeNode"+Z.id.REMOVE+" style='display:none;'></span>";f.append(g);Y(e,Z.id.REMOVE,d).bind("click",function(){if(!D.uCanDo(d)||D.apply(d.callback.beforeRemove,[d.treeId,e],true)==false){return false}T.removeNode(d,e);d.treeObj.trigger(Z.event.REMOVE,[d.treeId,e]);return false}).bind("mousedown",function(h){return true}).show()},addHoverDom:function(d,e){if(W.getRoots().showHoverDom){e.isHover=true;if(d.edit.enable){T.addEditBtn(d,e);T.addRemoveBtn(d,e)}D.apply(d.view.addHoverDom,[d.treeId,e])}},cancelCurEditNode:function(e,h,l){var g=W.getRoot(e),d=e.data.key.name,i=g.curEditNode;if(i){var j=g.curEditInput,k=h?h:(l?i[d]:j.val());if(D.apply(e.callback.beforeRename,[e.treeId,i,k,l],true)===false){return false}else{i[d]=k;e.treeObj.trigger(Z.event.RENAME,[e.treeId,i,l])}var f=Y(i,Z.id.A,e);f.removeClass(Z.node.CURSELECTED_EDIT);j.unbind();T.setNodeName(e,i);i.editNameFlag=false;g.curEditNode=null;g.curEditInput=null;T.selectNode(e,i,false)}g.noSelection=true;return true},editNode:function(d,f){var g=W.getRoot(d);T.editNodeBlur=false;if(W.isSelectedNode(d,f)&&g.curEditNode==f&&f.editNameFlag){setTimeout(function(){D.inputFocus(g.curEditInput)},0);return}var h=d.data.key.name;f.editNameFlag=true;T.removeTreeDom(d,f);T.cancelCurEditNode(d);T.selectNode(d,f,false);Y(f,Z.id.SPAN,d).html("<input type=text class='rename' id='"+f.tId+Z.id.INPUT+"' treeNode"+Z.id.INPUT+" >");var e=Y(f,Z.id.INPUT,d);e.attr("value",f[h]);if(d.edit.editNameSelectAll){D.inputSelect(e)}else{D.inputFocus(e)}e.bind("blur",function(i){if(!T.editNodeBlur){T.cancelCurEditNode(d)}}).bind("keydown",function(i){if(i.keyCode=="13"){T.editNodeBlur=true;T.cancelCurEditNode(d)}else{if(i.keyCode=="27"){T.cancelCurEditNode(d,null,true)}}}).bind("click",function(i){return false}).bind("dblclick",function(i){return false});Y(f,Z.id.A,d).addClass(Z.node.CURSELECTED_EDIT);g.curEditInput=e;g.noSelection=false;g.curEditNode=f},moveNode:function(o,Aa,w,d,Ac,q){var r=W.getRoot(o),g=o.data.key.children;if(Aa==w){return}if(o.data.keep.leaf&&Aa&&!Aa.isParent&&d==Z.move.TYPE_INNER){return}var h=(w.parentTId?w.getParentNode():r),Ad=(Aa===null||Aa==r);if(Ad&&Aa===null){Aa=r}if(Ad){d=Z.move.TYPE_INNER}var z=(Aa.parentTId?Aa.getParentNode():r);if(d!=Z.move.TYPE_PREV&&d!=Z.move.TYPE_NEXT){d=Z.move.TYPE_INNER}if(d==Z.move.TYPE_INNER){if(Ad){w.parentTId=null}else{if(!Aa.isParent){Aa.isParent=true;Aa.open=!!Aa.open;T.setNodeLineIcos(o,Aa)}w.parentTId=Aa.tId}}var s,u;if(Ad){s=o.treeObj;u=s}else{if(!q&&d==Z.move.TYPE_INNER){T.expandCollapseNode(o,Aa,true,false)}else{if(!q){T.expandCollapseNode(o,Aa.getParentNode(),true,false)}}s=Y(Aa,o);u=Y(Aa,Z.id.UL,o);if(!!s.get(0)&&!u.get(0)){var t=[];T.makeUlHtml(o,Aa,t,"");s.append(t.join(""))}u=Y(Aa,Z.id.UL,o)}var x=Y(w,o);if(!x.get(0)){x=T.appendNodes(o,w.level,[w],null,false,true).join("")}else{if(!s.get(0)){x.remove()}}if(u.get(0)&&d==Z.move.TYPE_INNER){u.append(x)}else{if(s.get(0)&&d==Z.move.TYPE_PREV){s.before(x)}else{if(s.get(0)&&d==Z.move.TYPE_NEXT){s.after(x)}}}var k,n,e=-1,m=0,v=null,y=null,p=w.level;if(w.isFirstNode){e=0;if(h[g].length>1){v=h[g][1];v.isFirstNode=true}}else{if(w.isLastNode){e=h[g].length-1;v=h[g][e-1];v.isLastNode=true}else{for(k=0,n=h[g].length;k<n;k++){if(h[g][k].tId==w.tId){e=k;break}}}}if(e>=0){h[g].splice(e,1)}if(d!=Z.move.TYPE_INNER){for(k=0,n=z[g].length;k<n;k++){if(z[g][k].tId==Aa.tId){m=k}}}if(d==Z.move.TYPE_INNER){if(!Aa[g]){Aa[g]=new Array()}if(Aa[g].length>0){y=Aa[g][Aa[g].length-1];y.isLastNode=false}Aa[g].splice(Aa[g].length,0,w);w.isLastNode=true;w.isFirstNode=(Aa[g].length==1)}else{if(Aa.isFirstNode&&d==Z.move.TYPE_PREV){z[g].splice(m,0,w);y=Aa;y.isFirstNode=false;w.parentTId=Aa.parentTId;w.isFirstNode=true;w.isLastNode=false}else{if(Aa.isLastNode&&d==Z.move.TYPE_NEXT){z[g].splice(m+1,0,w);y=Aa;y.isLastNode=false;w.parentTId=Aa.parentTId;w.isFirstNode=false;w.isLastNode=true}else{if(d==Z.move.TYPE_PREV){z[g].splice(m,0,w)}else{z[g].splice(m+1,0,w)}w.parentTId=Aa.parentTId;w.isFirstNode=false;w.isLastNode=false}}}W.fixPIdKeyValue(o,w);W.setSonNodeLevel(o,w.getParentNode(),w);T.setNodeLineIcos(o,w);T.repairNodeLevelClass(o,w,p);if(!o.data.keep.parent&&h[g].length<1){h.isParent=false;h.open=false;var j=Y(h,Z.id.UL,o),f=Y(h,Z.id.SWITCH,o),Ab=Y(h,Z.id.ICON,o);T.replaceSwitchClass(h,f,Z.folder.DOCU);T.replaceIcoClass(h,Ab,Z.folder.DOCU);j.css("display","none")}else{if(v){T.setNodeLineIcos(o,v)}}if(y){T.setNodeLineIcos(o,y)}if(!!o.check&&o.check.enable&&T.repairChkClass){T.repairChkClass(o,h);T.repairParentChkClassWithSelf(o,h);if(h!=w.parent){T.repairParentChkClassWithSelf(o,w)}}if(!q){T.expandCollapseParentNode(o,w.getParentNode(),true,Ac)}},removeEditBtn:function(d,e){Y(e,Z.id.EDIT,d).unbind().remove()},removeRemoveBtn:function(d,e){Y(e,Z.id.REMOVE,d).unbind().remove()},removeTreeDom:function(d,e){e.isHover=false;T.removeEditBtn(d,e);T.removeRemoveBtn(d,e);D.apply(d.view.removeHoverDom,[d.treeId,e])},repairNodeLevelClass:function(h,j,g){if(g===j.level){return}var i=Y(j,h),d=Y(j,Z.id.A,h),e=Y(j,Z.id.UL,h),f=Z.className.LEVEL+g,k=Z.className.LEVEL+j.level;i.removeClass(f);i.addClass(k);d.removeClass(f);d.addClass(k);e.removeClass(f);e.addClass(k)},selectNodes:function(e,g){for(var d=0,f=g.length;d<f;d++){T.selectNode(e,g[d],d>0)}}},C={tools:U,view:R,event:M,data:L};X.extend(true,X.fn.zTree.consts,H);X.extend(true,X.fn.zTree._z,C);var P=X.fn.zTree,D=P._z.tools,Z=P.consts,T=P._z.view,W=P._z.data,F=P._z.event,Y=D.$;W.exSetting(I);W.addInitBind(K);W.addInitUnBind(B);W.addInitCache(V);W.addInitNode(J);W.addInitProxy(E);W.addInitRoot(Q);W.addZTreeTools(O);var b=T.cancelPreSelectedNode;T.cancelPreSelectedNode=function(e,f){var g=W.getRoot(e).curSelectedList;for(var d=0,h=g.length;d<h;d++){if(!f||f===g[d]){T.removeTreeDom(e,g[d]);if(f){break}}}if(b){b.apply(T,arguments)}};var A=T.createNodes;T.createNodes=function(e,f,g,d){if(A){A.apply(T,arguments)}if(!g){return}if(T.repairParentChkClassWithSelf){T.repairParentChkClassWithSelf(e,d)}};var a=T.makeNodeUrl;T.makeNodeUrl=function(d,e){return d.edit.enable?null:(a.apply(T,arguments))};var G=T.removeNode;T.removeNode=function(d,e){var f=W.getRoot(d);if(f.curEditNode===e){f.curEditNode=null}if(G){G.apply(T,arguments)}};var S=T.selectNode;T.selectNode=function(e,f,d){var g=W.getRoot(e);if(W.isSelectedNode(e,f)&&g.curEditNode==f&&f.editNameFlag){return false}if(S){S.apply(T,arguments)}T.addHoverDom(e,f);return true};var c=D.uCanDo;D.uCanDo=function(d,f){var g=W.getRoot(d);if(f&&(D.eqs(f.type,"mouseover")||D.eqs(f.type,"mouseout")||D.eqs(f.type,"mousedown")||D.eqs(f.type,"mouseup"))){return true}if(g.curEditNode){T.editNodeBlur=false;g.curEditInput.focus()}return(!g.curEditNode)&&(c?c.apply(T,arguments):true)}})(jQuery);