/* Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(A){A.fn.extend({slimScroll:function(C){var D={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var B=A.extend(D,C);this.each(function(){var Z,S,V,N,L,O,Y,K,W="<div></div>",U=30,F=false;var M=A(this);if(M.parent().hasClass(B.wrapperClass)){var P=M.scrollTop();H=M.parent().find("."+B.barClass);G=M.parent().find("."+B.railClass);T();if(A.isPlainObject(C)){if("height" in C&&C.height=="auto"){M.parent().css("height","auto");M.css("height","auto");var a=M.parent().parent().height();M.parent().css("height",a);M.css("height",a)}if("scrollTo" in C){P=parseInt(B.scrollTo)}else{if("scrollBy" in C){P+=parseInt(B.scrollBy)}else{if("destroy" in C){H.remove();G.remove();M.unwrap();return}}}I(P,false,true)}return}else{if(A.isPlainObject(C)){if("destroy" in C){return}}}B.height=(B.height=="auto")?M.parent().height():B.height;var E=A(W).addClass(B.wrapperClass).css({position:"relative",overflow:"hidden",width:B.width,height:B.height});M.css({overflow:"hidden",width:B.width,height:B.height});var G=A(W).addClass(B.railClass).css({width:B.size,height:"100%",position:"absolute",top:0,display:(B.alwaysVisible&&B.railVisible)?"block":"none","border-radius":B.railBorderRadius,background:B.railColor,opacity:B.railOpacity,zIndex:90});var H=A(W).addClass(B.barClass).css({background:B.color,width:B.size,position:"absolute",top:0,opacity:B.opacity,display:B.alwaysVisible?"block":"none","border-radius":B.borderRadius,BorderRadius:B.borderRadius,MozBorderRadius:B.borderRadius,WebkitBorderRadius:B.borderRadius,zIndex:99});var R=(B.position=="right")?{right:B.distance}:{left:B.distance};G.css(R);H.css(R);M.wrap(E);M.parent().append(H);M.parent().append(G);if(B.railDraggable){H.bind("mousedown",function(c){var d=A(document);V=true;t=parseFloat(H.css("top"));pageY=c.pageY;d.bind("mousemove.slimscroll",function(f){currTop=t+f.pageY-pageY;H.css("top",currTop);I(0,H.position().top,false)});d.bind("mouseup.slimscroll",function(f){V=false;Q();d.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(c){c.stopPropagation();c.preventDefault();return false})}G.hover(function(){X()},function(){Q()});H.hover(function(){S=true},function(){S=false});M.hover(function(){Z=true;X();Q()},function(){Z=false;Q()});M.bind("touchstart",function(c,d){if(c.originalEvent.touches.length){L=c.originalEvent.touches[0].pageY}});M.bind("touchmove",function(c){if(!F){c.originalEvent.preventDefault()}if(c.originalEvent.touches.length){var d=(L-c.originalEvent.touches[0].pageY)/B.touchScrollStep;I(d,true);L=c.originalEvent.touches[0].pageY}});T();if(B.start==="bottom"){H.css({top:M.outerHeight()-H.outerHeight()});I(0,true)}else{if(B.start!=="top"){I(A(B.start).position().top,null,true);if(!B.alwaysVisible){H.hide()}}}b();function J(d){if(!Z){return}var d=d||window.event;var c=0;if(d.wheelDelta){c=-d.wheelDelta/120}if(d.detail){c=d.detail/3}var f=d.target||d.srcTarget||d.srcElement;if(A(f).closest("."+B.wrapperClass).is(M.parent())){I(c,true)}if(d.preventDefault&&!F){d.preventDefault()}if(!F){d.returnValue=false}}function I(g,e,h){F=false;var c=g;var d=M.outerHeight()-H.outerHeight();if(e){c=parseInt(H.css("top"))+g*parseInt(B.wheelStep)/100*H.outerHeight();c=Math.min(Math.max(c,0),d);c=(g>0)?Math.ceil(c):Math.floor(c);H.css({top:c+"px"})}Y=parseInt(H.css("top"))/(M.outerHeight()-H.outerHeight());c=Y*(M[0].scrollHeight-M.outerHeight());if(h){c=g;var f=c/M[0].scrollHeight*M.outerHeight();f=Math.min(Math.max(f,0),d);H.css({top:f+"px"})}M.scrollTop(c);M.trigger("slimscrolling",~~c);X();Q()}function b(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",J,false);this.addEventListener("mousewheel",J,false)}else{document.attachEvent("onmousewheel",J)}}function T(){O=Math.max((M.outerHeight()/M[0].scrollHeight)*M.outerHeight(),U);H.css({height:O+"px"});var c=O==M.outerHeight()?"none":"block";H.css({display:c})}function X(){T();clearTimeout(N);if(Y==~~Y){F=B.allowPageScroll;if(K!=Y){var c=(~~Y==0)?"top":"bottom";M.trigger("slimscroll",c)}}else{F=false}K=Y;if(O>=M.outerHeight()){F=true;return}H.stop(true,true).fadeIn("fast");if(B.railVisible){G.stop(true,true).fadeIn("fast")}}function Q(){if(!B.alwaysVisible){N=setTimeout(function(){if(!(B.disableFadeOut&&Z)&&!S&&!V){H.fadeOut("slow");G.fadeOut("slow")}},1000)}}});return this}});A.fn.extend({slimscroll:A.fn.slimScroll})})(jQuery);