/* WebUploader 0.1.5 */
(function(I,E){var H={},F=function(M,K){var O,N,L;if(typeof M==="string"){return J(M)}else{O=[];for(N=M.length,L=0;L<N;L++){O.push(J(M[L]))}return K.apply(null,O)}},A=function(M,L,K){if(arguments.length===2){K=L;L=null}F(L||[],function(){D(M,K,arguments)})},D=function(O,K,N){var M={exports:K},L;if(typeof K==="function"){N.length||(N=[F,M.exports,M]);L=K.apply(null,N);L!==undefined&&(M.exports=L)}H[O]=M.exports},J=function(L){var K=H[L]||I[L];if(!K){throw new Error("`"+L+"` is undefined")}return K},C=function(M){var L,N,K,O,P,Q;Q=function(R){return R&&(R.charAt(0).toUpperCase()+R.substr(1))};for(L in H){N=M;if(!H.hasOwnProperty(L)){continue}K=L.split("/");P=Q(K.pop());while((O=Q(K.shift()))){N[O]=N[O]||{};N=N[O]}N[P]=H[L]}return M},B=function(K){I.__dollar=K;return C(E(I,A,F))},G;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=B()}else{if(typeof define==="function"&&define.amd){define(["jquery"],B)}else{G=I.WebUploader;I.WebUploader=B();I.WebUploader.noConflict=function(){I.WebUploader=G}}}})(window,function(A,C,B){C("dollar-third",[],function(){var D=A.__dollar||A.jQuery||A.Zepto;if(!D){throw new Error("jQuery or Zepto not found!")}return D});C("dollar",["dollar-third"],function(D){return D});C("promise-third",["dollar"],function(D){return{Deferred:D.Deferred,when:D.when,isPromise:function(E){return E&&typeof E.then==="function"}}});C("promise",["promise-third"],function(D){return D});C("base",["dollar","promise"],function(J,H){var I=function(){},E=Function.call;function D(K){return function(){return E.apply(K,arguments)}}function G(L,K){return function(){return L.apply(K,arguments)}}function F(K){var L;if(Object.create){return Object.create(K)}else{L=function(){};L.prototype=K;return new L()}}return{version:"0.1.5",$:J,Deferred:H.Deferred,isPromise:H.isPromise,when:H.when,browser:(function(O){var P={},R=O.match(/WebKit\/([\d.]+)/),L=O.match(/Chrome\/([\d.]+)/)||O.match(/CriOS\/([\d.]+)/),M=O.match(/MSIE\s([\d\.]+)/)||O.match(/(?:trident)(?:.*rv:([\w.]+))?/i),N=O.match(/Firefox\/([\d.]+)/),K=O.match(/Safari\/([\d.]+)/),Q=O.match(/OPR\/([\d.]+)/);R&&(P.webkit=parseFloat(R[1]));L&&(P.chrome=parseFloat(L[1]));M&&(P.ie=parseFloat(M[1]));N&&(P.firefox=parseFloat(N[1]));K&&(P.safari=parseFloat(K[1]));Q&&(P.opera=parseFloat(Q[1]));return P})(navigator.userAgent),os:(function(N){var L={},M=N.match(/(?:Android);?[\s\/]+([\d.]+)?/),K=N.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);M&&(L.android=parseFloat(M[1]));K&&(L.ios=parseFloat(K[1].replace(/_/g,".")));return L})(navigator.userAgent),inherits:function(N,M,L){var K;if(typeof M==="function"){K=M;M=null}else{if(M&&M.hasOwnProperty("constructor")){K=M.constructor}else{K=function(){return N.apply(this,arguments)}}}J.extend(true,K,N,L||{});K.__super__=N.prototype;K.prototype=F(N.prototype);M&&J.extend(true,K.prototype,M);return K},noop:I,bindFn:G,log:(function(){if(A.console){return G(console.log,console)}return I})(),nextTick:(function(){return function(K){setTimeout(K,1)}})(),slice:D([].slice),guid:(function(){var K=0;return function(N){var L=(+new Date()).toString(32),M=0;for(;M<5;M++){L+=Math.floor(Math.random()*65535).toString(32)}return(N||"wu_")+L+(K++).toString(32)}})(),formatSize:function(K,M,N){var L;N=N||["B","K","M","G","TB"];while((L=N.shift())&&K>1024){K=K/1024}return(L==="B"?K:K.toFixed(M||2))+L}}});C("mediator",["base"],function(K){var J=K.$,D=[].slice,G=/\s+/,I;function F(O,N,L,M){return J.grep(O,function(P){return P&&(!N||P.e===N)&&(!L||P.cb===L||P.cb._cb===L)&&(!M||P.ctx===M)})}function H(N,L,M){J.each((N||"").split(G),function(P,O){M(O,L)})}function E(P,Q){var M=false,L=-1,O=P.length,N;while(++L<O){N=P[L];if(N.cb.apply(N.ctx2,Q)===false){M=true;break}}return !M}I={on:function(N,L,M){var O=this,P;if(!L){return this}P=this._events||(this._events=[]);H(N,L,function(S,Q){var R={e:S};R.cb=Q;R.ctx=M;R.ctx2=M||O;R.id=P.length;P.push(R)});return this},once:function(N,L,M){var O=this;if(!L){return O}H(N,L,function(Q,P){var R=function(){O.off(Q,R);return P.apply(M||O,arguments)};R._cb=P;O.on(Q,R,M)});return O},off:function(M,L,O){var N=this._events;if(!N){return this}if(!M&&!L&&!O){this._events=[];return this}H(M,L,function(Q,P){J.each(F(N,Q,P,O),function(){delete N[this.id]})});return this},trigger:function(L){var O,N,M;if(!this._events||!L){return this}O=D.call(arguments,1);N=F(this._events,L);M=F(this._events,"all");return E(N,O)&&E(M,arguments)}};return J.extend({installTo:function(L){return J.extend(L,I)}},I)});C("uploader",["base","mediator"],function(E,F){var G=E.$;function D(H){this.options=G.extend(true,{},D.options,H);this._init(this.options)}D.options={};F.installTo(D.prototype);G.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(H,I){D.prototype[H]=function(){return this.request(I,arguments)}});G.extend(D.prototype,{state:"pending",_init:function(H){var I=this;I.request("init",H,function(){I.state="ready";I.trigger("ready")})},option:function(H,J){var I=this.options;if(arguments.length>1){if(G.isPlainObject(J)&&G.isPlainObject(I[H])){G.extend(I[H],J)}else{I[H]=J}}else{return H?I[H]:I}},getStats:function(){var H=this.request("get-stats");return H?{successNum:H.numOfSuccess,progressNum:H.numOfProgress,cancelNum:H.numOfCancel,invalidNum:H.numOfInvalid,uploadFailNum:H.numOfUploadFailed,queueNum:H.numOfQueue,interruptNum:H.numofInterrupt}:{}},trigger:function(H){var K=[].slice.call(arguments,1),I=this.options,J="on"+H.substring(0,1).toUpperCase()+H.substring(1);if(F.trigger.apply(this,arguments)===false||G.isFunction(I[J])&&I[J].apply(this,K)===false||G.isFunction(this[J])&&this[J].apply(this,K)===false||F.trigger.apply(F,[this,H].concat(K))===false){return false}return true},destroy:function(){this.request("destroy",arguments);this.off()},request:E.noop});E.create=D.create=function(H){return new D(H)};E.Uploader=D;return D});C("runtime/runtime",["base","mediator"],function(G,H){var I=G.$,F={},E=function(K){for(var J in K){if(K.hasOwnProperty(J)){return J}}return null};function D(J){this.options=I.extend({container:document.body},J);this.uid=G.guid("rt_")}I.extend(D.prototype,{getContainer:function(){var J=this.options,L,K;if(this._container){return this._container}L=I(J.container||document.body);K=I(document.createElement("div"));K.attr("id","rt_"+this.uid);K.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});L.append(K);L.addClass("webuploader-container");this._container=K;this._parent=L;return K},init:G.noop,exec:G.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}});D.orders="html5,flash";D.addRuntime=function(J,K){F[J]=K};D.hasRuntime=function(J){return !!(J?F[J]:E(F))};D.create=function(K,M){var J,L;M=M||D.orders;I.each(M.split(/\s*,\s*/g),function(){if(F[this]){J=this;return false}});J=J||E(F);if(!J){throw new Error("Runtime Error")}L=new F[J](K);return L};H.installTo(D.prototype);return D});C("runtime/client",["base","mediator","runtime/runtime"],function(G,H,E){var D;D=(function(){var I={};return{add:function(J){I[J.uid]=J},get:function(J,L){var K;if(J){return I[J]}for(K in I){if(L&&I[K].__standalone){continue}return I[K]}return null},remove:function(J){delete I[J.uid]}}})();function F(J,I){var K=G.Deferred(),L;this.uid=G.guid("client_");this.runtimeReady=function(M){return K.done(M)};this.connectRuntime=function(N,M){if(L){throw new Error("already connected!")}K.done(M);if(typeof N==="string"&&D.get(N)){L=D.get(N)}L=L||D.get(null,I);if(!L){L=E.create(N,N.runtimeOrder);L.__promise=K.promise();L.once("ready",K.resolve);L.init();D.add(L);L.__client=1}else{G.$.extend(L.options,N);L.__promise.then(K.resolve);L.__client++}I&&(L.__standalone=I);return L};this.getRuntime=function(){return L};this.disconnectRuntime=function(){if(!L){return}L.__client--;if(L.__client<=0){D.remove(L);delete L.__promise;L.destroy()}L=null};this.exec=function(){if(!L){return}var M=G.slice(arguments);J&&M.unshift(J);return L.exec.apply(this,M)};this.getRuid=function(){return L&&L.uid};this.destroy=(function(M){return function(){M&&M.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}H.installTo(F.prototype);return F});C("lib/dnd",["base","mediator","runtime/client"],function(F,G,E){var H=F.$;function D(I){I=this.options=H.extend({},D.options,I);I.container=H(I.container);if(!I.container.length){return}E.call(this,"DragAndDrop")}D.options={accept:null,disableGlobalDnd:false};F.inherits(E,{constructor:D,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})}});G.installTo(D.prototype);return D});C("widgets/widget",["base","uploader"],function(L,E){var J=L.$,F=E.prototype._init,K=E.prototype.destroy,H={},G=[];function D(O){if(!O){return false}var N=O.length,M=J.type(O);if(O.nodeType===1&&N){return true}return M==="array"||M!=="function"&&M!=="string"&&(N===0||typeof N==="number"&&N>0&&(N-1) in O)}function I(M){this.owner=M;this.options=M.options}J.extend(I.prototype,{init:L.noop,invoke:function(N,O){var M=this.responseMap;if(!M||!(N in M)||!(M[N] in this)||!J.isFunction(this[M[N]])){return H}return this[M[N]].apply(this,O)},request:function(){return this.owner.request.apply(this.owner,arguments)}});J.extend(E.prototype,{_init:function(){var M=this,N=M._widgets=[],O=M.options.disableWidgets||"";J.each(G,function(Q,P){(!O||!~O.indexOf(P._name))&&N.push(new P(M))});return F.apply(M,arguments)},request:function(X,N,O){var R=0,V=this._widgets,M=V&&V.length,W=[],Q=[],T,P,U,S;N=D(N)?N:[N];for(;R<M;R++){T=V[R];P=T.invoke(X,N);if(P!==H){if(L.isPromise(P)){Q.push(P)}else{W.push(P)}}}if(O||Q.length){U=L.when.apply(L,Q);S=U.pipe?"pipe":"then";return U[S](function(){var Y=L.Deferred(),Z=arguments;if(Z.length===1){Z=Z[0]}setTimeout(function(){Y.resolve(Z)},1);return Y.promise()})[O?S:"done"](O||L.noop)}else{return W[0]}},destroy:function(){K.apply(this,arguments);this._widgets=null}});E.register=I.register=function(P,M){var N={init:"init",destroy:"destroy",name:"anonymous"},O;if(arguments.length===1){M=P;J.each(M,function(Q){if(Q[0]==="_"||Q==="name"){Q==="name"&&(N.name=M.name);return}N[Q.replace(/[A-Z]/g,"-$&").toLowerCase()]=Q})}else{N=J.extend(N,P)}M.responseMap=N;O=L.inherits(I,M);O._name=N.name;G.push(O);return O};E.unRegister=I.unRegister=function(N){if(!N||N==="anonymous"){return}for(var M=G.length;M--;){if(G[M]._name===N){G.splice(M,1)}}};return I});C("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(F,E,D){var G=F.$;E.options.dnd="";return E.register({name:"dnd",init:function(I){if(!I.dnd||this.request("predict-runtime-type")!=="html5"){return}var K=this,L=F.Deferred(),J=G.extend({},{disableGlobalDnd:I.disableGlobalDnd,container:I.dnd,accept:I.accept}),H;this.dnd=H=new D(J);H.once("ready",L.resolve);H.on("drop",function(M){K.request("add-file",[M])});H.on("accept",function(M){return K.owner.trigger("dndAccept",M)});H.init();return L.promise()},destroy:function(){this.dnd&&this.dnd.destroy()}})});C("lib/filepaste",["base","mediator","runtime/client"],function(E,G,D){var H=E.$;function F(I){I=this.options=H.extend({},I);I.container=H(I.container||document.body);D.call(this,"FilePaste")}E.inherits(D,{constructor:F,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})}});G.installTo(F.prototype);return F});C("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(E,D,F){var G=E.$;return D.register({name:"paste",init:function(H){if(!H.paste||this.request("predict-runtime-type")!=="html5"){return}var J=this,K=E.Deferred(),I=G.extend({},{container:H.paste,accept:H.accept}),L;this.paste=L=new F(I);L.once("ready",K.resolve);L.on("paste",function(M){J.owner.request("add-file",[M])});L.init();return K.promise()},destroy:function(){this.paste&&this.paste.destroy()}})});C("lib/blob",["base","runtime/client"],function(E,F){function D(G,H){var I=this;I.source=H;I.ruid=G;this.size=H.size||0;if(!H.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)){this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext)}else{this.type=H.type||"application/octet-stream"}F.call(I,"Blob");this.uid=H.uid||this.uid;if(G){I.connectRuntime(G)}}E.inherits(F,{constructor:D,slice:function(H,G){return this.exec("slice",H,G)},getSource:function(){return this.source}});return D});C("lib/file",["base","lib/blob"],function(F,D){var E=1,G=/\.([^.]+)$/;function H(J,K){var I;this.name=K.name||("untitled"+E++);I=G.exec(K.name)?RegExp.$1.toLowerCase():"";if(!I&&K.type){I=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(K.type)?RegExp.$1.toLowerCase():"";this.name+="."+I}this.ext=I;this.lastModifiedDate=K.lastModifiedDate||(new Date()).toLocaleString();D.apply(this,arguments)}return F.inherits(D,H)});C("lib/filepicker",["base","runtime/client","lib/file"],function(F,G,H){var D=F.$;function E(I){I=this.options=D.extend({},E.options,I);I.container=D(I.id);if(!I.container.length){throw new Error("按钮指定错误")}I.innerHTML=I.innerHTML||I.label||I.container.html()||"";I.button=D(I.button||document.createElement("div"));I.button.html(I.innerHTML);I.container.html(I.button);G.call(this,"FilePicker",true)}E.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};F.inherits(G,{constructor:E,init:function(){var K=this,J=K.options,I=J.button;I.addClass("webuploader-pick");K.on("all",function(L){var M;switch(L){case"mouseenter":I.addClass("webuploader-pick-hover");break;case"mouseleave":I.removeClass("webuploader-pick-hover");break;case"change":M=K.exec("getFiles");K.trigger("select",D.map(M,function(N){N=new H(K.getRuid(),N);N._refer=J.container;return N}),J.container);break}});K.connectRuntime(J,function(){K.refresh();K.exec("init",J);K.trigger("ready")});this._resizeHandler=F.bindFn(this.refresh,this);D(A).on("resize",this._resizeHandler)},refresh:function(){var I=this.getRuntime().getContainer(),J=this.options.button,M=J.outerWidth?J.outerWidth():J.width(),L=J.outerHeight?J.outerHeight():J.height(),K=J.offset();M&&L&&I.css({bottom:"auto",right:"auto",width:M+"px",height:L+"px"}).offset(K)},enable:function(){var I=this.options.button;I.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var I=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});I.addClass("webuploader-pick-disable")},destroy:function(){var I=this.options.button;D(A).off("resize",this._resizeHandler);I.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}});return E});C("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(F,D,E){var G=F.$;G.extend(D.options,{pick:null,accept:null});return D.register({name:"picker",init:function(H){this.pickers=[];return H.pick&&this.addBtn(H.pick)},refresh:function(){G.each(this.pickers,function(){this.refresh()})},addBtn:function(H){var J=this,I=J.options,L=I.accept,K=[];if(!H){return}G.isPlainObject(H)||(H={id:H});G(H.id).each(function(){var N,O,M;M=F.Deferred();N=G.extend({},H,{accept:G.isPlainObject(L)?[L]:L,swf:I.swf,runtimeOrder:I.runtimeOrder,id:this});O=new E(N);O.once("ready",M.resolve);O.on("select",function(P){J.owner.request("add-file",[P])});O.init();J.pickers.push(O);K.push(M.promise())});return F.when.apply(F,K)},disable:function(){G.each(this.pickers,function(){this.disable()})},enable:function(){G.each(this.pickers,function(){this.enable()})},destroy:function(){G.each(this.pickers,function(){this.destroy()});this.pickers=null}})});C("lib/image",["base","runtime/client","lib/blob"],function(F,G,D){var H=F.$;function E(I){this.options=H.extend({},E.options,I);G.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}E.options={quality:90,crop:false,preserveHeaders:false,allowMagnify:false};F.inherits(G,{constructor:E,info:function(I){if(I){this._info=I;return this}return this._info},meta:function(I){if(I){this._meta=I;return this}return this._meta},loadFromBlob:function(J){var K=this,I=J.getRuid();this.connectRuntime(I,function(){K.exec("init",K.options);K.exec("loadFromBlob",J)})},resize:function(){var I=F.slice(arguments);return this.exec.apply(this,["resize"].concat(I))},crop:function(){var I=F.slice(arguments);return this.exec.apply(this,["crop"].concat(I))},getAsDataUrl:function(I){return this.exec("getAsDataUrl",I)},getAsBlob:function(I){var J=this.exec("getAsBlob",I);return new D(this.getRuid(),J)}});return E});C("widgets/image",["base","uploader","lib/image","widgets/widget"],function(G,E,F){var H=G.$,D;D=(function(L){var J=0,K=[],I=function(){var M;while(K.length&&J<L){M=K.shift();J+=M[0];M[1]()}};return function(N,M,O){K.push([M,O]);N.once("destroy",function(){J-=M;setTimeout(I,1)});setTimeout(I,1)}})(5*1024*1024);H.extend(E.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return E.register({name:"image",makeThumb:function(N,I,M,J){var K,L;N=this.request("get-file",N);if(!N.type.match(/^image/)){I(true);return}K=H.extend({},this.options.thumb);if(H.isPlainObject(M)){K=H.extend(K,M);M=null}M=M||K.width;J=J||K.height;L=new F(K);L.once("load",function(){N._info=N._info||L.info();N._meta=N._meta||L.meta();if(M<=1&&M>0){M=N._info.width*M}if(J<=1&&J>0){J=N._info.height*J}L.resize(M,J)});L.once("complete",function(){I(false,L.getAsDataUrl(K.type));L.destroy()});L.once("error",function(O){I(O||true);L.destroy()});D(L,N.source.size,function(){N._info&&L.info(N._info);N._meta&&L.meta(N._meta);L.loadFromBlob(N.source)})},beforeSendFile:function(N){var I=this.options.compress||this.options.resize,M=I&&I.compressSize||0,J=I&&I.noCompressIfLarger||false,L,K;N=this.request("get-file",N);if(!I||!~"image/jpeg,image/jpg".indexOf(N.type)||N.size<M||N._compressed){return}I=H.extend({},I);K=G.Deferred();L=new F(I);K.always(function(){L.destroy();L=null});L.once("error",K.reject);L.once("load",function(){var P=I.width,O=I.height;N._info=N._info||L.info();N._meta=N._meta||L.meta();if(P<=1&&P>0){P=N._info.width*P}if(O<=1&&O>0){O=N._info.height*O}L.resize(P,O)});L.once("complete",function(){var Q,O;try{Q=L.getAsBlob(I.type);O=N.size;if(!J||Q.size<O){N.source=Q;N.size=Q.size;N.trigger("resize",Q.size,O)}N._compressed=true;K.resolve()}catch(P){K.resolve()}});N._info&&L.info(N._info);N._meta&&L.meta(N._meta);L.loadFromBlob(N.source);return K.promise()}})});C("file",["base","mediator"],function(L,H){var I=L.$,D="WU_FILE_",F=0,K=/\.([^.]+)$/,G={};function J(){return D+F++}function E(M){this.name=M.name||"Untitled";this.size=M.size||0;this.type=M.type||"application/octet-stream";this.lastModifiedDate=M.lastModifiedDate||(new Date()*1);this.id=J();this.ext=K.exec(this.name)?RegExp.$1:"";this.statusText="";G[this.id]=E.Status.INITED;this.source=M;this.loaded=0;this.on("error",function(N){this.setStatus(E.Status.ERROR,N)})}I.extend(E.prototype,{setStatus:function(N,O){var M=G[this.id];typeof O!=="undefined"&&(this.statusText=O);if(N!==M){G[this.id]=N;this.trigger("statuschange",N,M)}},getStatus:function(){return G[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete G[this.id]}});H.installTo(E.prototype);E.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return E});C("queue",["base","mediator","file"],function(G,H,F){var I=G.$,E=F.Status;function D(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}I.extend(D.prototype,{append:function(J){this._queue.push(J);this._fileAdded(J);return this},prepend:function(J){this._queue.unshift(J);this._fileAdded(J);return this},getFile:function(J){if(typeof J!=="string"){return J}return this._map[J]},fetch:function(K){var L=this._queue.length,J,M;K=K||E.QUEUED;for(J=0;J<L;J++){M=this._queue[J];if(K===M.getStatus()){return M}}return null},sort:function(J){if(typeof J==="function"){this._queue.sort(J)}},getFiles:function(){var K=[].slice.call(arguments,0),L=[],J=0,M=this._queue.length,N;for(;J<M;J++){N=this._queue[J];if(K.length&&!~I.inArray(N.getStatus(),K)){continue}L.push(N)}return L},removeFile:function(L){var J=this,K=this._map[L.id];if(K){delete this._map[L.id];L.destroy();this.stats.numofDeleted++}},_fileAdded:function(L){var J=this,K=this._map[L.id];if(!K){this._map[L.id]=L;L.on("statuschange",function(M,N){J._onFileStatusChange(M,N)})}},_onFileStatusChange:function(K,L){var J=this.stats;switch(L){case E.PROGRESS:J.numOfProgress--;break;case E.QUEUED:J.numOfQueue--;break;case E.ERROR:J.numOfUploadFailed--;break;case E.INVALID:J.numOfInvalid--;break;case E.INTERRUPT:J.numofInterrupt--;break}switch(K){case E.QUEUED:J.numOfQueue++;break;case E.PROGRESS:J.numOfProgress++;break;case E.ERROR:J.numOfUploadFailed++;break;case E.COMPLETE:J.numOfSuccess++;break;case E.CANCELLED:J.numOfCancel++;break;case E.INVALID:J.numOfInvalid++;break;case E.INTERRUPT:J.numofInterrupt++;break}}});H.installTo(D.prototype);return D});C("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(L,E,G,D,H,F){var J=L.$,K=/\.\w+$/,I=D.Status;return E.register({name:"queue",init:function(Q){var S=this,R,T,P,U,O,N,M;if(J.isPlainObject(Q.accept)){Q.accept=[Q.accept]}if(Q.accept){O=[];for(P=0,T=Q.accept.length;P<T;P++){U=Q.accept[P].extensions;U&&O.push(U)}if(O.length){N="\\."+O.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}S.accept=new RegExp(N,"i")}S.queue=new G();S.stats=S.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}R=L.Deferred();this.placeholder=M=new F("Placeholder");M.connectRuntime({runtimeOrder:"html5"},function(){S._ruid=M.getRuid();R.resolve()});return R.promise()},_wrapFile:function(M){if(!(M instanceof D)){if(!(M instanceof H)){if(!this._ruid){throw new Error("Can't add external files.")}M=new H(this._ruid,M)}M=new D(M)}return M},acceptFile:function(N){var M=!N||!N.size||this.accept&&K.exec(N.name)&&!this.accept.test(N.name);return !M},_addFile:function(N){var M=this;N=M._wrapFile(N);if(!M.owner.trigger("beforeFileQueued",N)){return}if(!M.acceptFile(N)){M.owner.trigger("error","Q_TYPE_DENIED",N);return}M.queue.append(N);M.owner.trigger("fileQueued",N);return N},getFile:function(M){return this.queue.getFile(M)},addFile:function(N){var M=this;if(!N.length){N=[N]}N=J.map(N,function(O){return M._addFile(O)});M.owner.trigger("filesQueued",N);if(M.options.auto){setTimeout(function(){M.request("start-upload")},20)}},getStats:function(){return this.stats},removeFile:function(O,M){var N=this;O=O.id?O:N.queue.getFile(O);this.request("cancel-file",O);if(M){this.queue.removeFile(O)}},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(R,O){var M=this,Q,N,P;if(R){R=R.id?R:M.queue.getFile(R);R.setStatus(I.QUEUED);O||M.request("start-upload");return}Q=M.queue.getFiles(I.ERROR);N=0;P=Q.length;for(;N<P;N++){R=Q[N];R.setStatus(I.QUEUED)}M.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new G();this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})});C("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(D,E){D.support=function(){return E.hasRuntime.apply(E,arguments)};return D.register({name:"runtime",init:function(){if(!this.predictRuntimeType()){throw Error("Runtime Error")}},predictRuntimeType:function(){var I=this.options.runtimeOrder||E.orders,F=this.type,G,H;if(!F){I=I.split(/\s*,\s*/g);for(G=0,H=I.length;G<H;G++){if(E.hasRuntime(I[G])){this.type=F=I[G];break}}}return F}})});C("lib/transport",["base","runtime/client","mediator"],function(F,G,D){var H=F.$;function E(I){var J=this;I=J.options=H.extend(true,{},E.options,I||{});G.call(this,"Transport");this._blob=null;this._formData=I.formData||{};this._headers=I.headers||{};this.on("progress",this._timeout);this.on("load error",function(){J.trigger("progress",1);clearTimeout(J._timer)})}E.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};H.extend(E.prototype,{appendBlob:function(I,K,L){var M=this,J=M.options;if(M.getRuid()){M.disconnectRuntime()}M.connectRuntime(K.ruid,function(){M.exec("init")});M._blob=K;J.fileVal=I||J.fileVal;J.filename=L||J.filename},append:function(I,J){if(typeof I==="object"){H.extend(this._formData,I)}else{this._formData[I]=J}},setRequestHeader:function(I,J){if(typeof I==="object"){H.extend(this._headers,I)}else{this._headers[I]=J}},send:function(I){this.exec("send",I);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var I=this,J=I.options.timeout;if(!J){return}clearTimeout(I._timer);I._timer=setTimeout(function(){I.abort();I.trigger("error","timeout")},J)}});D.installTo(E.prototype);return E});C("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(K,E,D,J){var I=K.$,G=K.isPromise,H=D.Status;I.extend(E.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:{}});function F(P,R){var O=[],U=P.source,Q=U.size,S=R?Math.ceil(Q/R):1,M=0,N=0,L,T;T={file:P,has:function(){return !!O.length},shift:function(){return O.shift()},unshift:function(V){O.unshift(V)}};while(N<S){L=Math.min(R,Q-M);O.push({file:P,start:M,end:R?(M+L):Q,total:Q,chunks:S,chunk:N++,cuted:T});M+=L}P.blocks=O.concat();P.remaning=O.length;return T}E.register({name:"upload",init:function(){var M=this.owner,L=this;this.runing=false;this.progress=false;M.on("startUpload",function(){L.progress=true}).on("uploadFinished",function(){L.progress=false});this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this.__tick=K.bindFn(this._tick,this);M.on("uploadComplete",function(N){N.blocks&&I.each(N.blocks,function(P,O){O.transport&&(O.transport.abort(),O.transport.destroy());delete O.transport});delete N.blocks;delete N.remaning})},reset:function(){this.request("stop-upload",true);this.runing=false;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=false;this._promise=null},startUpload:function(N){var L=this;I.each(L.request("get-files",H.INVALID),function(){L.request("remove-file",this)});if(N){N=N.id?N:L.request("get-file",N);if(N.getStatus()===H.INTERRUPT){I.each(L.pool,function(P,O){if(O.file!==N){return}O.transport&&O.transport.send()});N.setStatus(H.QUEUED)}else{if(N.getStatus()===H.PROGRESS){return}else{N.setStatus(H.QUEUED)}}}else{I.each(L.request("get-files",[H.INITED]),function(){this.setStatus(H.QUEUED)})}if(L.runing){return}L.runing=true;var M=[];I.each(L.pool,function(Q,O){var P=O.file;if(P.getStatus()===H.INTERRUPT){M.push(P);L._trigged=false;O.transport&&O.transport.send()}});var N;while((N=M.shift())){N.setStatus(H.PROGRESS)}N||I.each(L.request("get-files",H.INTERRUPT),function(){this.setStatus(H.PROGRESS)});L._trigged=false;K.nextTick(L.__tick);L.owner.trigger("startUpload")},stopUpload:function(N,M){var L=this;if(N===true){M=N;N=null}if(L.runing===false){return}if(N){N=N.id?N:L.request("get-file",N);if(N.getStatus()!==H.PROGRESS&&N.getStatus()!==H.QUEUED){return}N.setStatus(H.INTERRUPT);I.each(L.pool,function(P,O){if(O.file!==N){return}O.transport&&O.transport.abort();L._putback(O);L._popBlock(O)});return K.nextTick(L.__tick)}L.runing=false;if(this._promise&&this._promise.file){this._promise.file.setStatus(H.INTERRUPT)}M&&I.each(L.pool,function(P,O){O.transport&&O.transport.abort();O.file.setStatus(H.INTERRUPT)});L.owner.trigger("stopUpload")},cancelFile:function(L){L=L.id?L:this.request("get-file",L);L.blocks&&I.each(L.blocks,function(O,N){var M=N.transport;if(M){M.abort();M.destroy();delete N.transport}});L.setStatus(H.CANCELLED);this.owner.trigger("fileDequeued",L)},isInProgress:function(){return !!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(M,L){M=M.id?M:this.request("get-file",M);M.setStatus(L||H.COMPLETE);M.skipped=true;M.blocks&&I.each(M.blocks,function(P,O){var N=O.transport;if(N){N.abort();N.destroy();delete O.transport}});this.owner.trigger("uploadSkip",M)},_tick:function(){var N=this,L=N.options,M,O;if(N._promise){return N._promise.always(N.__tick)}if(N.pool.length<L.threads&&(O=N._nextBlock())){N._trigged=false;M=function(P){N._promise=null;P&&P.file&&N._startSend(P);K.nextTick(N.__tick)};N._promise=G(O)?O.always(M):M(O)}else{if(!N.remaning&&!N._getStats().numOfQueue&&!N._getStats().numofInterrupt){N.runing=false;N._trigged||K.nextTick(function(){N.owner.trigger("uploadFinished")});N._trigged=true}}},_putback:function(M){var L;M.cuted.unshift(M);L=this.stack.indexOf(M.cuted);if(!~L){this.stack.unshift(M.cuted)}},_getStack:function(){var M=0,L;while((L=this.stack[M++])){if(L.has()&&L.file.getStatus()===H.PROGRESS){return L}else{if(!L.has()||L.file.getStatus()!==H.PROGRESS&&L.file.getStatus()!==H.INTERRUPT){this.stack.splice(--M,1)}}}return null},_nextBlock:function(){var Q=this,N=Q.options,L,P,M,O;if((L=this._getStack())){if(N.prepareNextFile&&!Q.pending.length){Q._prepareNextFile()}return L.shift()}else{if(Q.runing){if(!Q.pending.length&&Q._getStats().numOfQueue){Q._prepareNextFile()}P=Q.pending.shift();M=function(R){if(!R){return null}L=F(R,N.chunked?N.chunkSize:0);Q.stack.push(L);return L.shift()};if(G(P)){O=P.file;P=P[P.pipe?"pipe":"then"](M);P.file=O;return P}return M(P)}}},_prepareNextFile:function(){var M=this,N=M.request("fetch-file"),L=M.pending,O;if(N){O=M.request("before-send-file",N,function(){if(N.getStatus()===H.PROGRESS||N.getStatus()===H.INTERRUPT){return N}return M._finishFile(N)});M.owner.trigger("uploadStart",N);N.setStatus(H.PROGRESS);O.file=N;O.done(function(){var P=I.inArray(O,L);~P&&L.splice(P,1,N)});O.fail(function(P){N.setStatus(H.ERROR,P);M.owner.trigger("uploadError",N,P);M.owner.trigger("uploadComplete",N)});L.push(O)}},_popBlock:function(M){var L=I.inArray(M,this.pool);this.pool.splice(L,1);M.file.remaning--;this.remaning--},_startSend:function(O){var M=this,N=O.file,L;if(N.getStatus()!==H.PROGRESS){if(N.getStatus()===H.INTERRUPT){M._putback(O)}return}M.pool.push(O);M.remaning++;O.blob=O.chunks===1?N.source:N.source.slice(O.start,O.end);L=M.request("before-send",O,function(){if(N.getStatus()===H.PROGRESS){M._doSend(O)}else{M._popBlock(O);K.nextTick(M.__tick)}});L.fail(function(){if(N.remaning===1){M._finishFile(N).always(function(){O.percentage=1;M._popBlock(O);M.owner.trigger("uploadComplete",N);K.nextTick(M.__tick)})}else{O.percentage=1;M.updateFileProgress(N);M._popBlock(O);K.nextTick(M.__tick)}})},_doSend:function(Q){var S=this,M=S.owner,R=S.options,O=Q.file,T=new J(R),L=I.extend({},R.formData),P=I.extend({},R.headers),N,U;Q.transport=T;T.on("destroy",function(){delete Q.transport;S._popBlock(Q);K.nextTick(S.__tick)});T.on("progress",function(V){Q.percentage=V;S.updateFileProgress(O)});N=function(V){var W;U=T.getResponseAsJson()||{};U._raw=T.getResponse();W=function(X){V=X};if(!M.trigger("uploadAccept",Q,U,W)){V=V||"server"}return V};T.on("error",function(V,W){Q.retried=Q.retried||0;if(Q.chunks>1&&~"http,abort".indexOf(V)&&Q.retried<R.chunkRetry){Q.retried++;T.send()}else{if(!W&&V==="server"){V=N(V)}O.setStatus(H.ERROR,V);M.trigger("uploadError",O,V);M.trigger("uploadComplete",O)}});T.on("load",function(){var V;if((V=N())){T.trigger("error",V,true);return}if(O.remaning===1){S._finishFile(O,U)}else{T.destroy()}});L=I.extend(L,{id:O.id,name:O.name,type:O.type,lastModifiedDate:O.lastModifiedDate,size:O.size});Q.chunks>1&&I.extend(L,{chunks:Q.chunks,chunk:Q.chunk});M.trigger("uploadBeforeSend",Q,L,P);T.appendBlob(R.fileVal,Q.blob,O.name);T.append(L);T.setRequestHeader(P);T.send()},_finishFile:function(O,M,N){var L=this.owner;return L.request("after-send-file",arguments,function(){O.setStatus(H.COMPLETE);L.trigger("uploadSuccess",O,M,N)}).fail(function(P){if(O.getStatus()===H.PROGRESS){O.setStatus(H.ERROR,P)}L.trigger("uploadError",O,P)}).always(function(){L.trigger("uploadComplete",O)})},updateFileProgress:function(M){var N=0,L=0;if(!M.blocks){return}I.each(M.blocks,function(P,O){L+=(O.percentage||0)*(O.end-O.start)});N=L/M.size;this.owner.trigger("uploadProgress",M,N||0)}})});C("widgets/validator",["base","uploader","file","widgets/widget"],function(G,E,F){var I=G.$,D={},H;H={addValidator:function(J,K){D[J]=K},removeValidator:function(J){delete D[J]}};E.register({name:"validator",init:function(){var J=this;G.nextTick(function(){I.each(D,function(){this.call(J.owner)})})}});H.addValidator("fileNumLimit",function(){var L=this,K=L.options,J=0,N=parseInt(K.fileNumLimit,10),M=true;if(!N){return}L.on("beforeFileQueued",function(O){if(J>=N&&M){M=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",N,O);setTimeout(function(){M=true},1)}return J>=N?false:true});L.on("fileQueued",function(){J++});L.on("fileDequeued",function(){J--});L.on("reset",function(){J=0})});H.addValidator("fileSizeLimit",function(){var L=this,K=L.options,J=0,N=parseInt(K.fileSizeLimit,10),M=true;if(!N){return}L.on("beforeFileQueued",function(P){var O=J+P.size>N;if(O&&M){M=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",N,P);setTimeout(function(){M=true},1)}return O?false:true});L.on("fileQueued",function(O){J+=O.size});L.on("fileDequeued",function(O){J-=O.size});L.on("reset",function(){J=0})});H.addValidator("fileSingleSizeLimit",function(){var K=this,J=K.options,L=J.fileSingleSizeLimit;if(!L){return}K.on("beforeFileQueued",function(M){if(M.size>L){M.setStatus(F.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",L,M);return false}})});H.addValidator("duplicate",function(){var M=this,J=M.options,L={};if(J.duplicate){return}function K(Q){var P=0,O=0,R=Q.length,N;for(;O<R;O++){N=Q.charCodeAt(O);P=N+(P<<6)+(P<<16)-P}return P}M.on("beforeFileQueued",function(O){var N=O.__hash||(O.__hash=K(O.name+O.size+O.lastModifiedDate));if(L[N]){this.trigger("error","F_DUPLICATE",O);return false}});M.on("fileQueued",function(O){var N=O.__hash;N&&(L[N]=true)});M.on("fileDequeued",function(O){var N=O.__hash;N&&(delete L[N])});M.on("reset",function(){L={}})});return H});C("lib/md5",["runtime/client","mediator"],function(F,E){function D(){F.call(this,"Md5")}E.installTo(D.prototype);D.prototype.loadFromBlob=function(G){var H=this;if(H.getRuid()){H.disconnectRuntime()}H.connectRuntime(G.ruid,function(){H.exec("init");H.exec("loadFromBlob",G)})};D.prototype.getResult=function(){return this.exec("getResult")};return D});C("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(G,E,F,D){return E.register({name:"md5",md5File:function(L,M,K){var I=new F(),J=G.Deferred(),H=(L instanceof D)?L:this.request("get-file",L).source;I.on("progress load",function(N){N=N||{};J.notify(N.total?N.loaded/N.total:1)});I.on("complete",function(){J.resolve(I.getResult())});I.on("error",function(N){J.reject(N)});if(arguments.length>1){M=M||0;K=K||0;M<0&&(M=H.size+M);K<0&&(K=H.size+K);K=Math.min(K,H.size);H=H.slice(M,K)}I.loadFromBlob(H);return J.promise()}})});C("runtime/compbase",[],function(){function D(F,E){this.owner=F;this.options=F.options;this.getRuntime=function(){return E};this.getRuid=function(){return E.uid};this.trigger=function(){return F.trigger.apply(F,arguments)}}return D});C("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(G,E,F){var D="html5",I={};function H(){var J={},K=this,L=this.destroy;E.apply(K,arguments);K.type=D;K.exec=function(R,N){var Q=this,O=Q.uid,P=G.slice(arguments,2),M;if(I[R]){M=J[O]=J[O]||new I[R](Q,K);if(M[N]){return M[N].apply(M,P)}}};K.destroy=function(){return L&&L.apply(this,arguments)}}G.inherits(E,{constructor:H,init:function(){var J=this;setTimeout(function(){J.trigger("ready")},1)}});H.register=function(K,J){var L=I[K]=G.inherits(F,J);return L};if(A.Blob&&A.FileReader&&A.DataView){E.addRuntime(D,H)}return H});C("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(D,E){return D.register("Blob",{slice:function(H,G){var F=this.owner.source,I=F.slice||F.webkitSlice||F.mozSlice;F=I.call(F,H,G);return new E(this.getRuid(),F)}})});C("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(G,D,H){var E=G.$,F="webuploader-dnd-";return D.register("DragAndDrop",{init:function(){var I=this.elem=this.options.container;this.dragEnterHandler=G.bindFn(this._dragEnterHandler,this);this.dragOverHandler=G.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=G.bindFn(this._dragLeaveHandler,this);this.dropHandler=G.bindFn(this._dropHandler,this);this.dndOver=false;I.on("dragenter",this.dragEnterHandler);I.on("dragover",this.dragOverHandler);I.on("dragleave",this.dragLeaveHandler);I.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){E(document).on("dragover",this.dragOverHandler);E(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(I){var J=this,L=J._denied||false,K;I=I.originalEvent||I;if(!J.dndOver){J.dndOver=true;K=I.dataTransfer.items;if(K&&K.length){J._denied=L=!J.trigger("accept",K)}J.elem.addClass(F+"over");J.elem[L?"addClass":"removeClass"](F+"denied")}I.dataTransfer.dropEffect=L?"none":"copy";return false},_dragOverHandler:function(J){var I=this.elem.parent().get(0);if(I&&!E.contains(I,J.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,J);return false},_dragLeaveHandler:function(){var J=this,I;I=function(){J.dndOver=false;J.elem.removeClass(F+"over "+F+"denied")};clearTimeout(J._leaveTimer);J._leaveTimer=setTimeout(I,100);return false},_dropHandler:function(K){var L=this,J=L.getRuid(),I=L.elem.parent().get(0),M,O;if(I&&!E.contains(I,K.currentTarget)){return false}K=K.originalEvent||K;M=K.dataTransfer;try{O=M.getData("text/html")}catch(N){}if(O){return}L._getTansferFiles(M,function(P){L.trigger("drop",E.map(P,function(Q){return new H(J,Q)}))});L.dndOver=false;L.elem.removeClass(F+"over");return false},_getTansferFiles:function(I,L){var P=[],M=[],R,K,O,S,N,Q,J;R=I.items;K=I.files;J=!!(R&&R[0].webkitGetAsEntry);for(N=0,Q=K.length;N<Q;N++){O=K[N];S=R&&R[N];if(J&&S.webkitGetAsEntry().isDirectory){M.push(this._traverseDirectoryTree(S.webkitGetAsEntry(),P))}else{P.push(O)}}G.when.apply(G,M).done(function(){if(!P.length){return}L(P)})},_traverseDirectoryTree:function(J,L){var K=G.Deferred(),I=this;if(J.isFile){J.file(function(M){L.push(M);K.resolve()})}else{if(J.isDirectory){J.createReader().readEntries(function(Q){var P=Q.length,M=[],O=[],N;for(N=0;N<P;N++){M.push(I._traverseDirectoryTree(Q[N],O))}G.when.apply(G,M).then(function(){L.push.apply(L,O);K.resolve()},K.reject)})}}return K.promise()},destroy:function(){var I=this.elem;if(!I){return}I.off("dragenter",this.dragEnterHandler);I.off("dragover",this.dragOverHandler);I.off("dragleave",this.dragLeaveHandler);I.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){E(document).off("dragover",this.dragOverHandler);E(document).off("drop",this.dropHandler)}}})});C("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(E,D,F){return D.register("FilePaste",{init:function(){var H=this.options,J=this.elem=H.container,M=".*",L,G,K,I;if(H.accept){L=[];for(G=0,K=H.accept.length;G<K;G++){I=H.accept[G].mimeTypes;I&&L.push(I)}if(L.length){M=L.join(",");M=M.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=M=new RegExp(M,"i");this.hander=E.bindFn(this._pasteHander,this);J.on("paste",this.hander)},_pasteHander:function(G){var H=[],J=this.getRuid(),L,N,M,I,K;G=G.originalEvent||G;L=G.clipboardData.items;for(I=0,K=L.length;I<K;I++){N=L[I];if(N.kind!=="file"||!(M=N.getAsFile())){continue}H.push(new F(J,M))}if(H.length){G.preventDefault();G.stopPropagation();this.trigger("paste",H)}},destroy:function(){this.elem.off("paste",this.hander)}})});C("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(E,D){var F=E.$;return D.register("FilePicker",{init:function(){var N=this.getRuntime().getContainer(),G=this,I=G.owner,L=G.options,K=this.label=F(document.createElement("label")),P=this.input=F(document.createElement("input")),O,M,H,J;P.attr("type","file");P.attr("name",L.name);P.addClass("webuploader-element-invisible");K.on("click",function(){P.trigger("click")});K.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(L.multiple){P.attr("multiple","multiple")}if(L.accept&&L.accept.length>0){O=[];for(M=0,H=L.accept.length;M<H;M++){O.push(L.accept[M].mimeTypes)}P.attr("accept",O.join(","))}N.append(P);N.append(K);J=function(Q){I.trigger(Q.type)};P.on("change",function(Q){var S=arguments.callee,R;G.files=Q.target.files;R=this.cloneNode(true);R.value=null;this.parentNode.replaceChild(R,this);P.off();P=F(R).on("change",S).on("mouseenter mouseleave",J);I.trigger("change")});K.on("mouseenter mouseleave",J)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})});C("runtime/html5/util",["base"],function(G){var F=A.createObjectURL&&A||A.URL&&URL.revokeObjectURL&&URL||A.webkitURL,E=G.noop,D=E;if(F){E=function(){return F.createObjectURL.apply(F,arguments)};D=function(){return F.revokeObjectURL.apply(F,arguments)}}return{createObjectURL:E,revokeObjectURL:D,dataURL2Blob:function(H){var M,L,J,I,N,K;K=H.split(",");if(~K[0].indexOf("base64")){M=atob(K[1])}else{M=decodeURIComponent(K[1])}J=new ArrayBuffer(M.length);L=new Uint8Array(J);for(I=0;I<M.length;I++){L[I]=M.charCodeAt(I)}N=K[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(J,N)},dataURL2ArrayBuffer:function(H){var L,K,I,J;J=H.split(",");if(~J[0].indexOf("base64")){L=atob(J[1])}else{L=decodeURIComponent(J[1])}K=new Uint8Array(L.length);for(I=0;I<L.length;I++){K[I]=L.charCodeAt(I)}return K.buffer},arrayBufferToBlob:function(J,H){var I=A.BlobBuilder||A.WebKitBlobBuilder,K;if(I){K=new I();K.append(J);return K.getBlob(H)}return new Blob([J],H?{type:H}:{})},canvasToDataUrl:function(I,H,J){return I.toDataURL(H,J/100)},parseMeta:function(I,H){H(false,{})},updateImageHead:function(H){return H}}});C("runtime/html5/imagemeta",["runtime/html5/util"],function(D){var E;E={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(G,F){var H=this,I=new FileReader();I.onload=function(){F(false,H._parse(this.result));I=I.onload=I.onerror=null};I.onerror=function(J){F(J.message);I=I.onload=I.onerror=null};G=G.slice(0,H.maxMetaDataSize);I.readAsArrayBuffer(G.getSource())},_parse:function(N,K){if(N.byteLength<6){return}var F=new DataView(N),H=2,L=F.byteLength-4,G=H,P={},M,O,I,J;if(F.getUint16(0)===65496){while(H<L){M=F.getUint16(H);if(M>=65504&&M<=65519||M===65534){O=F.getUint16(H+2)+2;if(H+O>F.byteLength){break}I=E.parsers[M];if(!K&&I){for(J=0;J<I.length;J+=1){I[J].call(E,F,H,O,P)}}H+=O;G=H}else{break}}if(G>6){if(N.slice){P.imageHead=N.slice(2,G)}else{P.imageHead=new Uint8Array(N).subarray(2,G)}}}return P},updateImageHead:function(G,I){var K=this._parse(G,true),H,J,F;F=2;if(K.imageHead){F=2+K.imageHead.byteLength}if(G.slice){J=G.slice(F)}else{J=new Uint8Array(G).subarray(F)}H=new Uint8Array(I.byteLength+2+J.byteLength);H[0]=255;H[1]=216;H.set(new Uint8Array(I),2);H.set(new Uint8Array(J),I.byteLength+2);return H.buffer}};D.parseMeta=function(){return E.parse.apply(E,arguments)};D.updateImageHead=function(){return E.updateImageHead.apply(E,arguments)};return E});C("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(E,D){var F={};F.ExifMap=function(){return this};F.ExifMap.prototype.map={"Orientation":274};F.ExifMap.prototype.get=function(G){return this[G]||this[this.map[G]]};F.exifTagTypes={1:{getValue:function(G,H){return G.getUint8(H)},size:1},2:{getValue:function(G,H){return String.fromCharCode(G.getUint8(H))},size:1,ascii:true},3:{getValue:function(G,H,I){return G.getUint16(H,I)},size:2},4:{getValue:function(G,H,I){return G.getUint32(H,I)},size:4},5:{getValue:function(G,H,I){return G.getUint32(H,I)/G.getUint32(H+4,I)},size:8},9:{getValue:function(G,H,I){return G.getInt32(H,I)},size:4},10:{getValue:function(G,H,I){return G.getInt32(H,I)/G.getInt32(H+4,I)},size:8}};F.exifTagTypes[7]=F.exifTagTypes[1];F.getExifValue=function(S,L,I,Q,K,O){var G=F.exifTagTypes[Q],R,H,M,N,J,P;if(!G){E.log("Invalid Exif data: Invalid tag type.");return}R=G.size*K;H=R>4?L+S.getUint32(I+8,O):(I+8);if(H+R>S.byteLength){E.log("Invalid Exif data: Invalid data offset.");return}if(K===1){return G.getValue(S,H,O)}M=[];for(N=0;N<K;N+=1){M[N]=G.getValue(S,H+N*G.size,O)}if(G.ascii){J="";for(N=0;N<M.length;N+=1){P=M[N];if(P==="\u0000"){break}J+=P}return J}return M};F.parseExifTag=function(I,J,H,K,L){var G=I.getUint16(H,K);L.exif[G]=F.getExifValue(I,J,H,I.getUint16(H+2,K),I.getUint32(H+4,K),K)};F.parseExifTags=function(M,J,H,L,G){var N,I,K;if(H+6>M.byteLength){E.log("Invalid Exif data: Invalid directory offset.");return}N=M.getUint16(H,L);I=H+2+12*N;if(I+4>M.byteLength){E.log("Invalid Exif data: Invalid directory size.");return}for(K=0;K<N;K+=1){this.parseExifTag(M,J,H+2+12*K,L,G)}return M.getUint32(I,L)};F.parseExifData=function(J,G,H,M){var K=G+10,L,I;if(J.getUint32(G+4)!==1165519206){return}if(K+8>J.byteLength){E.log("Invalid Exif data: Invalid segment size.");return}if(J.getUint16(G+8)!==0){E.log("Invalid Exif data: Missing byte alignment offset.");return}switch(J.getUint16(K)){case 18761:L=true;break;case 19789:L=false;break;default:E.log("Invalid Exif data: Invalid byte alignment marker.");return}if(J.getUint16(K+2,L)!==42){E.log("Invalid Exif data: Missing TIFF marker.");return}I=J.getUint32(K+4,L);M.exif=new F.ExifMap();I=F.parseExifTags(J,K,K+I,L,M)};D.parsers[65505].push(F.parseExifData);return F});C("runtime/html5/jpegencoder",[],function(D,G,E){function F(O){var Ad=this;var V=Math.round;var p=Math.floor;var J=new Array(64);var b=new Array(64);var l=new Array(64);var a=new Array(64);var W;var Ae;var I;var z;var s=new Array(65535);var c=new Array(65535);var g=new Array(64);var f=new Array(64);var N=[];var x=0;var Ab=7;var Aa=new Array(64);var Z=new Array(64);var M=new Array(64);var j=new Array(256);var R=new Array(2048);var n;var Af=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var o=[0,1,2,3,4,5,6,7,8,9,10,11];var T=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var t=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var w=[0,1,2,3,4,5,6,7,8,9,10,11];var h=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var S=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Ag(Ai){var Ah=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var An=0;An<64;An++){var Aj=p((Ah[An]*Ai+50)/100);if(Aj<1){Aj=1}else{if(Aj>255){Aj=255}}J[Af[An]]=Aj}var Aq=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var Al=0;Al<64;Al++){var Ak=p((Aq[Al]*Ai+50)/100);if(Ak<1){Ak=1}else{if(Ak>255){Ak=255}}b[Af[Al]]=Ak}var Ap=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var Am=0;for(var Ao=0;Ao<8;Ao++){for(var Ar=0;Ar<8;Ar++){l[Am]=(1/(J[Af[Am]]*Ap[Ao]*Ap[Ar]*8));a[Am]=(1/(b[Af[Am]]*Ap[Ao]*Ap[Ar]*8));Am++}}}function i(Ak,Al){var An=0;var Aj=0;var Am=new Array();for(var Ah=1;Ah<=16;Ah++){for(var Ai=1;Ai<=Ak[Ah];Ai++){Am[Al[Aj]]=[];Am[Al[Aj]][0]=An;Am[Al[Aj]][1]=Ah;Aj++;An++}An*=2}return Am}function H(){W=i(Q,o);Ae=i(t,w);I=i(T,Y);z=i(h,S)}function m(){var Aj=1;var Ah=2;for(var Al=1;Al<=15;Al++){for(var Ai=Aj;Ai<Ah;Ai++){c[32767+Ai]=Al;s[32767+Ai]=[];s[32767+Ai][1]=Al;s[32767+Ai][0]=Ai}for(var Ak=-(Ah-1);Ak<=-Aj;Ak++){c[32767+Ak]=Al;s[32767+Ak]=[];s[32767+Ak][1]=Al;s[32767+Ak][0]=Ah-1+Ak}Aj<<=1;Ah<<=1}}function Ac(){for(var Ah=0;Ah<256;Ah++){R[Ah]=19595*Ah;R[(Ah+256)>>0]=38470*Ah;R[(Ah+512)>>0]=7471*Ah+32768;R[(Ah+768)>>0]=-11059*Ah;R[(Ah+1024)>>0]=-21709*Ah;R[(Ah+1280)>>0]=32768*Ah+8421375;R[(Ah+1536)>>0]=-27439*Ah;R[(Ah+1792)>>0]=-5329*Ah}}function U(Ai){var Aj=Ai[0];var Ah=Ai[1]-1;while(Ah>=0){if(Aj&(1<<Ah)){x|=(1<<Ab)}Ah--;Ab--;if(Ab<0){if(x==255){K(255);K(0)}else{K(x)}Ab=7;x=0}}}function K(Ah){N.push(j[Ah])}function P(Ah){K((Ah>>8)&255);K((Ah)&255)}function r(A1,AM){var AT,AN,Ay,Ar,A6,AV,AI,AA;var A3=0;var A2;var AC=8;var Al=64;for(A2=0;A2<AC;++A2){AT=A1[A3];AN=A1[A3+1];Ay=A1[A3+2];Ar=A1[A3+3];A6=A1[A3+4];AV=A1[A3+5];AI=A1[A3+6];AA=A1[A3+7];var Ak=AT+AA;var AP=AT-AA;var Aq=AN+AI;var Ao=AN-AI;var Aw=Ay+AV;var Aj=Ay-AV;var AO=Ar+A6;var AW=Ar-A6;var AF=Ak+AO;var AE=Ak-AO;var AG=Aq+Aw;var AB=Aq-Aw;A1[A3]=AF+AG;A1[A3+4]=AF-AG;var Ax=(AB+AE)*0.707106781;A1[A3+2]=AE+Ax;A1[A3+6]=AE-Ax;AF=AW+Aj;AG=Aj+Ao;AB=Ao+AP;var AH=(AF-AB)*0.382683433;var AD=0.5411961*AF+AH;var AQ=1.306562965*AB+AH;var A4=AG*0.707106781;var AJ=AP+A4;var AK=AP-A4;A1[A3+5]=AK+AD;A1[A3+3]=AK-AD;A1[A3+1]=AJ+AQ;A1[A3+7]=AJ-AQ;A3+=8}A3=0;for(A2=0;A2<AC;++A2){AT=A1[A3];AN=A1[A3+8];Ay=A1[A3+16];Ar=A1[A3+24];A6=A1[A3+32];AV=A1[A3+40];AI=A1[A3+48];AA=A1[A3+56];var A0=AT+AA;var Ai=AT-AA;var An=AN+AI;var AZ=AN-AI;var As=Ay+AV;var Av=Ay-AV;var A7=Ar+A6;var AX=Ar-A6;var A5=A0+A7;var Am=A0-A7;var AR=An+As;var Az=An-As;A1[A3]=A5+AR;A1[A3+32]=A5-AR;var Ah=(Az+Am)*0.707106781;A1[A3+16]=Am+Ah;A1[A3+48]=Am-Ah;A5=AX+Av;AR=Av+AZ;Az=AZ+Ai;var AY=(A5-Az)*0.382683433;var AS=0.5411961*A5+AY;var Ap=1.306562965*Az+AY;var AU=AR*0.707106781;var At=Ai+AU;var AL=Ai-AU;A1[A3+40]=AL+AS;A1[A3+24]=AL-AS;A1[A3+8]=At+Ap;A1[A3+56]=At-Ap;A3++}var Au;for(A2=0;A2<Al;++A2){Au=A1[A2]*AM[A2];g[A2]=(Au>0)?((Au+0.5)|0):((Au-0.5)|0)}return g}function d(){P(65504);P(16);K(74);K(70);K(73);K(70);K(0);K(1);K(1);K(0);P(1);P(1);K(0);K(0)}function u(Ai,Ah){P(65472);P(17);K(8);P(Ah);P(Ai);K(3);K(1);K(17);K(0);K(2);K(17);K(1);K(3);K(17);K(1)}function v(){P(65499);P(132);K(0);for(var Ah=0;Ah<64;Ah++){K(J[Ah])}K(1);for(var Ai=0;Ai<64;Ai++){K(b[Ai])}}function q(){P(65476);P(418);K(0);for(var Ak=0;Ak<16;Ak++){K(Q[Ak+1])}for(var Ai=0;Ai<=11;Ai++){K(o[Ai])}K(16);for(var Aj=0;Aj<16;Aj++){K(T[Aj+1])}for(var An=0;An<=161;An++){K(Y[An])}K(1);for(var Ao=0;Ao<16;Ao++){K(t[Ao+1])}for(var Al=0;Al<=11;Al++){K(w[Al])}K(17);for(var Am=0;Am<16;Am++){K(h[Am+1])}for(var Ah=0;Ah<=161;Ah++){K(S[Ah])}}function L(){P(65498);P(12);K(3);K(1);K(0);K(2);K(17);K(3);K(17);K(0);K(63);K(0)}function e(Ar,Am,Aq,Ao,AA){var At=AA[0];var Ah=AA[240];var Az;var Aw=16;var Ak=63;var An=64;var Ap=r(Ar,Am);for(var Al=0;Al<An;++Al){f[Af[Al]]=Ap[Al]}var Av=f[0]-Aq;Aq=f[0];if(Av==0){U(Ao[0])}else{Az=32767+Av;U(Ao[c[Az]]);U(s[Az])}var Au=63;for(;(Au>0)&&(f[Au]==0);Au--){}if(Au==0){U(At);return Aq}var Ay=1;var Ai;while(Ay<=Au){var Aj=Ay;for(;(f[Ay]==0)&&(Ay<=Au);++Ay){}var As=Ay-Aj;if(As>=Aw){Ai=As>>4;for(var Ax=1;Ax<=Ai;++Ax){U(Ah)}As=As&15}Az=32767+f[Ay];U(AA[(As<<4)+c[Az]]);U(s[Az]);Ay++}if(Au!=Ak){U(At)}return Aq}function X(){var Ah=String.fromCharCode;for(var Ai=0;Ai<256;Ai++){j[Ai]=Ah(Ai)}}this.encode=function(AA,Ax){if(Ax){y(Ax)}N=new Array();x=0;Ab=7;P(65496);d();v();u(AA.width,AA.height);q();L();var Ai=0;var Al=0;var Aj=0;x=0;Ab=7;this.encode.displayName="_encode_";var Av=AA.data;var At=AA.width;var Aw=AA.height;var Ap=At*4;var An=At*3;var Ay,Az=0;var Ah,Aq,Ao;var AC,Au,AB,Ar,Ak;while(Az<Aw){Ay=0;while(Ay<Ap){AC=Ap*Az+Ay;Au=AC;AB=-1;Ar=0;for(Ak=0;Ak<64;Ak++){Ar=Ak>>3;AB=(Ak&7)*4;Au=AC+(Ar*Ap)+AB;if(Az+Ar>=Aw){Au-=(Ap*(Az+1+Ar-Aw))}if(Ay+AB>=Ap){Au-=((Ay+AB)-Ap+4)}Ah=Av[Au++];Aq=Av[Au++];Ao=Av[Au++];Aa[Ak]=((R[Ah]+R[(Aq+256)>>0]+R[(Ao+512)>>0])>>16)-128;Z[Ak]=((R[(Ah+768)>>0]+R[(Aq+1024)>>0]+R[(Ao+1280)>>0])>>16)-128;M[Ak]=((R[(Ah+1280)>>0]+R[(Aq+1536)>>0]+R[(Ao+1792)>>0])>>16)-128}Ai=e(Aa,l,Ai,W,I);Al=e(Z,a,Al,Ae,z);Aj=e(M,a,Aj,Ae,z);Ay+=32}Az+=8}if(Ab>=0){var As=[];As[1]=Ab+1;As[0]=(1<<(Ab+1))-1;U(As)}P(65497);var Am="data:image/jpeg;base64,"+btoa(N.join(""));N=[];return Am};function y(Ai){if(Ai<=0){Ai=1}if(Ai>100){Ai=100}if(n==Ai){return}var Ah=0;if(Ai<50){Ah=Math.floor(5000/Ai)}else{Ah=Math.floor(200-Ai*2)}Ag(Ah);n=Ai}function k(){if(!O){O=50}X();H();m();Ac();y(O)}k()}F.encode=function(J,I){var H=new F(I);return H.encode(J)};return F});C("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(D,H,F){var G=D.canvasToDataUrl,E;D.canvasToDataUrl=function(J,P,I){var M,K,L,O,N;if(!F.os.android){return G.apply(null,arguments)}if(P==="image/jpeg"&&typeof E==="undefined"){O=G.apply(null,arguments);N=O.split(",");if(~N[0].indexOf("base64")){O=atob(N[1])}else{O=decodeURIComponent(N[1])}O=O.substring(0,2);E=O.charCodeAt(0)===255&&O.charCodeAt(1)===216}if(P==="image/jpeg"&&!E){K=J.width;L=J.height;M=J.getContext("2d");return H.encode(M.getImageData(0,0,K,L),I)}return G.apply(null,arguments)}});C("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(G,D,E){var F="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return D.register("Image",{modified:false,init:function(){var H=this,I=new Image();I.onload=function(){H._info={type:H.type,width:this.width,height:this.height};if(!H._metas&&"image/jpeg"===H.type){E.parseMeta(H._blob,function(K,J){H._metas=J;H.owner.trigger("load")})}else{H.owner.trigger("load")}};I.onerror=function(){H.owner.trigger("error")};H._img=I},loadFromBlob:function(H){var I=this,J=I._img;I._blob=H;I.type=H.type;J.src=E.createObjectURL(H.getSource());I.owner.once("load",function(){E.revokeObjectURL(J.src)})},resize:function(J,H){var I=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,I,J,H);this._blob=null;this.modified=true;this.owner.trigger("complete","resize")},crop:function(Q,R,K,M,H){var I=this._canvas||(this._canvas=document.createElement("canvas")),N=this.options,L=this._img,O=L.naturalWidth,J=L.naturalHeight,P=this.getOrientation();H=H||1;I.width=K;I.height=M;N.preserveHeaders||this._rotate2Orientaion(I,P);this._renderImageToCanvas(I,L,-Q,-R,O*H,J*H);this._blob=null;this.modified=true;this.owner.trigger("complete","crop")},getAsBlob:function(H){var J=this._blob,I=this.options,K;H=H||this.type;if(this.modified||this.type!==H){K=this._canvas;if(H==="image/jpeg"){J=E.canvasToDataUrl(K,H,I.quality);if(I.preserveHeaders&&this._metas&&this._metas.imageHead){J=E.dataURL2ArrayBuffer(J);J=E.updateImageHead(J,this._metas.imageHead);J=E.arrayBufferToBlob(J,H);return J}}else{J=E.canvasToDataUrl(K,H)}J=E.dataURL2Blob(J)}return J},getAsDataUrl:function(H){var I=this.options;H=H||this.type;if(H==="image/jpeg"){return E.canvasToDataUrl(this._canvas,H,I.quality)}else{return this._canvas.toDataURL(H)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(H){if(H){this._info=H;return this}return this._info},meta:function(H){if(H){this._meta=H;return this}return this._meta},destroy:function(){var H=this._canvas;this._img.onload=null;if(H){H.getContext("2d").clearRect(0,0,H.width,H.height);H.width=H.height=0;this._canvas=null}this._img.src=F;this._img=this._blob=null},_resize:function(I,S,P,T){var N=this.options,Q=I.width,H=I.height,M=this.getOrientation(),J,L,O,K,R;if(~[5,6,7,8].indexOf(M)){P^=T;T^=P;P^=T}J=Math[N.crop?"max":"min"](P/Q,T/H);N.allowMagnify||(J=Math.min(1,J));L=Q*J;O=H*J;if(N.crop){S.width=P;S.height=T}else{S.width=L;S.height=O}K=(S.width-L)/2;R=(S.height-O)/2;N.preserveHeaders||this._rotate2Orientaion(S,M);this._renderImageToCanvas(S,I,K,R,L,O)},_rotate2Orientaion:function(J,H){var K=J.width,I=J.height,L=J.getContext("2d");switch(H){case 5:case 6:case 7:case 8:J.width=I;J.height=K;break}switch(H){case 2:L.translate(K,0);L.scale(-1,1);break;case 3:L.translate(K,I);L.rotate(Math.PI);break;case 4:L.translate(0,I);L.scale(1,-1);break;case 5:L.rotate(0.5*Math.PI);L.scale(1,-1);break;case 6:L.rotate(0.5*Math.PI);L.translate(0,-I);break;case 7:L.rotate(0.5*Math.PI);L.translate(K,-I);L.scale(-1,1);break;case 8:L.rotate(-0.5*Math.PI);L.translate(-K,0);break}},_renderImageToCanvas:(function(){if(!G.os.ios){return function(J){var L=G.slice(arguments,1),K=J.getContext("2d");K.drawImage.apply(K,L)}}function I(K,P,L){var J=document.createElement("canvas"),O=J.getContext("2d"),R=0,Q=L,S=L,M,N,T;J.width=1;J.height=L;O.drawImage(K,0,0);M=O.getImageData(0,0,1,L).data;while(S>R){N=M[(S-1)*4+3];if(N===0){Q=S}else{R=S}S=(Q+R)>>1}T=(S/L);return(T===0)?1:T}if(G.os.ios>=7){return function(J,K,P,Q,M,N){var O=K.naturalWidth,L=K.naturalHeight,R=I(K,O,L);return J.getContext("2d").drawImage(K,0,0,O*R,L*R,P,Q,M,N)}}function H(M){var N=M.naturalWidth,J=M.naturalHeight,K,L;if(N*J>1024*1024){K=document.createElement("canvas");K.width=K.height=1;L=K.getContext("2d");L.drawImage(M,-N+1,0);return L.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(J,e,a,b,T,c){var R=e.naturalWidth,M=e.naturalHeight,N=J.getContext("2d"),Z=H(e),P=this.type==="image/jpeg",O=1024,L=0,W=0,V,U,Q,X,S,Y,K;if(Z){R/=2;M/=2}N.save();V=document.createElement("canvas");V.width=V.height=O;U=V.getContext("2d");Q=P?I(e,R,M):1;X=Math.ceil(O*T/R);S=Math.ceil(O*c/M/Q);while(L<M){Y=0;K=0;while(Y<R){U.clearRect(0,0,O,O);U.drawImage(e,-Y,-L);N.drawImage(V,0,0,O,O,a+K,b+W,X,S);Y+=O;K+=X}L+=O;W+=S}N.restore();V=U=null}})()})});C("runtime/html5/transport",["base","runtime/html5/runtime"],function(E,D){var F=E.noop,G=E.$;return D.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var H=this.owner,K=this.options,I=this._initAjax(),O=H._blob,L=K.server,N,M,J;if(K.sendAsBinary){L+=(/\?/.test(L)?"&":"?")+G.param(H._formData);M=O.getSource()}else{N=new FormData();G.each(H._formData,function(Q,P){N.append(Q,P)});N.append(K.fileVal,O.getSource(),K.filename||H._formData.name||"")}if(K.withCredentials&&"withCredentials" in I){I.open(K.method,L,true);I.withCredentials=true}else{I.open(K.method,L)}this._setRequestHeader(I,K.headers);if(M){I.overrideMimeType&&I.overrideMimeType("application/octet-stream");if(E.os.android){J=new FileReader();J.onload=function(){I.send(this.result);J=J.onload=null};J.readAsArrayBuffer(M)}else{I.send(M)}}else{I.send(N)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var H=this._xhr;if(H){H.upload.onprogress=F;H.onreadystatechange=F;H.abort();this._xhr=H=null}},destroy:function(){this.abort()},_initAjax:function(){var I=this,J=new XMLHttpRequest(),H=this.options;if(H.withCredentials&&!("withCredentials" in J)&&typeof XDomainRequest!=="undefined"){J=new XDomainRequest()}J.upload.onprogress=function(K){var L=0;if(K.lengthComputable){L=K.loaded/K.total}return I.trigger("progress",L)};J.onreadystatechange=function(){if(J.readyState!==4){return}J.upload.onprogress=F;J.onreadystatechange=F;I._xhr=null;I._status=J.status;if(J.status>=200&&J.status<300){I._response=J.responseText;return I.trigger("load")}else{if(J.status>=500&&J.status<600){I._response=J.responseText;return I.trigger("error","server")}}return I.trigger("error",I._status?"http":"abort")};I._xhr=J;return J},_setRequestHeader:function(I,H){G.each(H,function(J,K){I.setRequestHeader(J,K)})},_parseJson:function(J){var H;try{H=JSON.parse(J)}catch(I){H={}}return H}})});C("runtime/html5/md5",["runtime/html5/runtime"],function(F){var R=function(V,U){return(V+U)&4294967295},O=function(V,Z,W,X,U,Y){Z=R(R(Z,V),R(X,Y));return R((Z<<U)|(Z>>>(32-U)),W)},Q=function(Z,W,X,U,Y,V,e){return O((W&X)|((~W)&U),Z,W,Y,V,e)},D=function(Z,W,X,U,Y,V,e){return O((W&U)|(X&(~U)),Z,W,Y,V,e)},M=function(Z,W,X,U,Y,V,e){return O(W^X^U,Z,W,Y,V,e)},K=function(Z,W,X,U,Y,V,e){return O(X^(W|(~U)),Z,W,Y,V,e)},L=function(W,Z){var Y=W[0],X=W[1],U=W[2],V=W[3];Y=Q(Y,X,U,V,Z[0],7,-680876936);V=Q(V,Y,X,U,Z[1],12,-389564586);U=Q(U,V,Y,X,Z[2],17,606105819);X=Q(X,U,V,Y,Z[3],22,-1044525330);Y=Q(Y,X,U,V,Z[4],7,-176418897);V=Q(V,Y,X,U,Z[5],12,1200080426);U=Q(U,V,Y,X,Z[6],17,-1473231341);X=Q(X,U,V,Y,Z[7],22,-45705983);Y=Q(Y,X,U,V,Z[8],7,1770035416);V=Q(V,Y,X,U,Z[9],12,-1958414417);U=Q(U,V,Y,X,Z[10],17,-42063);X=Q(X,U,V,Y,Z[11],22,-1990404162);Y=Q(Y,X,U,V,Z[12],7,1804603682);V=Q(V,Y,X,U,Z[13],12,-40341101);U=Q(U,V,Y,X,Z[14],17,-1502002290);X=Q(X,U,V,Y,Z[15],22,1236535329);Y=D(Y,X,U,V,Z[1],5,-165796510);V=D(V,Y,X,U,Z[6],9,-1069501632);U=D(U,V,Y,X,Z[11],14,643717713);X=D(X,U,V,Y,Z[0],20,-373897302);Y=D(Y,X,U,V,Z[5],5,-701558691);V=D(V,Y,X,U,Z[10],9,38016083);U=D(U,V,Y,X,Z[15],14,-660478335);X=D(X,U,V,Y,Z[4],20,-405537848);Y=D(Y,X,U,V,Z[9],5,568446438);V=D(V,Y,X,U,Z[14],9,-1019803690);U=D(U,V,Y,X,Z[3],14,-187363961);X=D(X,U,V,Y,Z[8],20,1163531501);Y=D(Y,X,U,V,Z[13],5,-1444681467);V=D(V,Y,X,U,Z[2],9,-51403784);U=D(U,V,Y,X,Z[7],14,1735328473);X=D(X,U,V,Y,Z[12],20,-1926607734);Y=M(Y,X,U,V,Z[5],4,-378558);V=M(V,Y,X,U,Z[8],11,-2022574463);U=M(U,V,Y,X,Z[11],16,1839030562);X=M(X,U,V,Y,Z[14],23,-35309556);Y=M(Y,X,U,V,Z[1],4,-1530992060);V=M(V,Y,X,U,Z[4],11,1272893353);U=M(U,V,Y,X,Z[7],16,-155497632);X=M(X,U,V,Y,Z[10],23,-1094730640);Y=M(Y,X,U,V,Z[13],4,681279174);V=M(V,Y,X,U,Z[0],11,-358537222);U=M(U,V,Y,X,Z[3],16,-722521979);X=M(X,U,V,Y,Z[6],23,76029189);Y=M(Y,X,U,V,Z[9],4,-640364487);V=M(V,Y,X,U,Z[12],11,-421815835);U=M(U,V,Y,X,Z[15],16,530742520);X=M(X,U,V,Y,Z[2],23,-995338651);Y=K(Y,X,U,V,Z[0],6,-198630844);V=K(V,Y,X,U,Z[7],10,1126891415);U=K(U,V,Y,X,Z[14],15,-1416354905);X=K(X,U,V,Y,Z[5],21,-57434055);Y=K(Y,X,U,V,Z[12],6,1700485571);V=K(V,Y,X,U,Z[3],10,-1894986606);U=K(U,V,Y,X,Z[10],15,-1051523);X=K(X,U,V,Y,Z[1],21,-2054922799);Y=K(Y,X,U,V,Z[8],6,1873313359);V=K(V,Y,X,U,Z[15],10,-30611744);U=K(U,V,Y,X,Z[6],15,-1560198380);X=K(X,U,V,Y,Z[13],21,1309151649);Y=K(Y,X,U,V,Z[4],6,-145523070);V=K(V,Y,X,U,Z[11],10,-1120210379);U=K(U,V,Y,X,Z[2],15,718787259);X=K(X,U,V,Y,Z[9],21,-343485551);W[0]=R(Y,W[0]);W[1]=R(X,W[1]);W[2]=R(U,W[2]);W[3]=R(V,W[3])},P=function(V){var U=[],W;for(W=0;W<64;W+=4){U[W>>2]=V.charCodeAt(W)+(V.charCodeAt(W+1)<<8)+(V.charCodeAt(W+2)<<16)+(V.charCodeAt(W+3)<<24)}return U},T=function(W){var U=[],V;for(V=0;V<64;V+=4){U[V>>2]=W[V]+(W[V+1]<<8)+(W[V+2]<<16)+(W[V+3]<<24)}return U},J=function(U){var a=U.length,Z=[1732584193,-271733879,-1732584194,271733878],b,Y,c,X,V,W;for(b=64;b<=a;b+=64){L(Z,P(U.substring(b-64,b)))}U=U.substring(b-64);Y=U.length;c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<Y;b+=1){c[b>>2]|=U.charCodeAt(b)<<((b%4)<<3)}c[b>>2]|=128<<((b%4)<<3);if(b>55){L(Z,c);for(b=0;b<16;b+=1){c[b]=0}}X=a*8;X=X.toString(16).match(/(.*?)(.{0,8})$/);V=parseInt(X[2],16);W=parseInt(X[1],16)||0;c[14]=V;c[15]=W;L(Z,c);return Z},I=function(c){var Z=c.length,Y=[1732584193,-271733879,-1732584194,271733878],b,X,d,W,U,V;for(b=64;b<=Z;b+=64){L(Y,T(c.subarray(b-64,b)))}c=(b-64)<Z?c.subarray(b-64):new Uint8Array(0);X=c.length;d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;b<X;b+=1){d[b>>2]|=c[b]<<((b%4)<<3)}d[b>>2]|=128<<((b%4)<<3);if(b>55){L(Y,d);for(b=0;b<16;b+=1){d[b]=0}}W=Z*8;W=W.toString(16).match(/(.*?)(.{0,8})$/);U=parseInt(W[2],16);V=parseInt(W[1],16)||0;d[14]=U;d[15]=V;L(Y,d);return Y},N=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],S=function(U){var V="",W;for(W=0;W<4;W+=1){V+=N[(U>>(W*8+4))&15]+N[(U>>(W*8))&15]}return V},E=function(V){var U;for(U=0;U<V.length;U+=1){V[U]=S(V[U])}return V.join("")},G=function(U){return E(J(U))},H=function(){this.reset()};if(G("hello")!=="5d41402abc4b2a76b9719d911017c592"){R=function(V,W){var U=(V&65535)+(W&65535),X=(V>>16)+(W>>16)+(U>>16);return(X<<16)|(U&65535)}}H.prototype.append=function(U){if(/[\u0080-\uFFFF]/.test(U)){U=unescape(encodeURIComponent(U))}this.appendBinary(U);return this};H.prototype.appendBinary=function(W){this._buff+=W;this._length+=W.length;var U=this._buff.length,V;for(V=64;V<=U;V+=64){L(this._state,P(this._buff.substring(V-64,V)))}this._buff=this._buff.substr(V-64);return this};H.prototype.end=function(Z){var X=this._buff,U=X.length,V,W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Y;for(V=0;V<U;V+=1){W[V>>2]|=X.charCodeAt(V)<<((V%4)<<3)}this._finish(W,U);Y=!!Z?this._state:E(this._state);this.reset();return Y};H.prototype._finish=function(Y,V){var W=V,U,Z,X;Y[W>>2]|=128<<((W%4)<<3);if(W>55){L(this._state,Y);for(W=0;W<16;W+=1){Y[W]=0}}U=this._length*8;U=U.toString(16).match(/(.*?)(.{0,8})$/);Z=parseInt(U[2],16);X=parseInt(U[1],16)||0;Y[14]=Z;Y[15]=X;L(this._state,Y)};H.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};H.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};H.hash=function(V,W){if(/[\u0080-\uFFFF]/.test(V)){V=unescape(encodeURIComponent(V))}var U=J(V);return !!W?U:E(U)};H.hashBinary=function(V,W){var U=J(V);return !!W?U:E(U)};H.ArrayBuffer=function(){this.reset()};H.ArrayBuffer.prototype.append=function(W){var X=this._concatArrayBuffer(this._buff,W),U=X.length,V;this._length+=W.byteLength;for(V=64;V<=U;V+=64){L(this._state,T(X.subarray(V-64,V)))}this._buff=(V-64)<U?X.subarray(V-64):new Uint8Array(0);return this};H.ArrayBuffer.prototype.end=function(Z){var X=this._buff,U=X.length,W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],V,Y;for(V=0;V<U;V+=1){W[V>>2]|=X[V]<<((V%4)<<3)}this._finish(W,U);Y=!!Z?this._state:E(this._state);this.reset();return Y};H.ArrayBuffer.prototype._finish=H.prototype._finish;H.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};H.ArrayBuffer.prototype.destroy=H.prototype.destroy;H.ArrayBuffer.prototype._concatArrayBuffer=function(X,U){var W=X.length,V=new Uint8Array(W+U.byteLength);V.set(X);V.set(new Uint8Array(U),W);return V};H.ArrayBuffer.hash=function(V,W){var U=I(new Uint8Array(V));return !!W?U:E(U)};return F.register("Md5",{init:function(){},loadFromBlob:function(Y){var W=Y.getSource(),a=2*1024*1024,c=Math.ceil(W.size/a),Z=0,U=this.owner,d=new H.ArrayBuffer(),b=this,V=W.mozSlice||W.webkitSlice||W.slice,e,X;X=new FileReader();e=function(){var g,f;g=Z*a;f=Math.min(g+a,W.size);X.onload=function(h){d.append(h.target.result);U.trigger("progress",{total:Y.size,loaded:f})};X.onloadend=function(){X.onloadend=X.onload=null;if(++Z<c){setTimeout(e,1)}else{setTimeout(function(){U.trigger("load");b.result=d.end();e=Y=W=d=null;U.trigger("complete")},50)}};X.readAsArrayBuffer(V.call(W,g,f))};e()},getResult:function(){return this.result}})});C("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(K,J,E){var H=K.$,I="flash",G={};function D(){var N;try{N=navigator.plugins["Shockwave Flash"];N=N.description}catch(M){try{N=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(L){N="0.0"}}N=N.match(/\d+/g);return parseFloat(N[0]+"."+N[1],10)}function F(){var L={},N={},P=this.destroy,Q=this,O=K.guid("webuploader_");J.apply(Q,arguments);Q.type=I;Q.exec=function(W,S){var V=this,T=V.uid,U=K.slice(arguments,2),R;N[T]=V;if(G[W]){if(!L[T]){L[T]=new G[W](V,Q)}R=L[T];if(R[S]){return R[S].apply(R,U)}}return Q.flashExec.apply(V,arguments)};function M(U,T){var R=U.type||U,S,V;S=R.split("::");V=S[0];R=S[1];if(R==="Ready"&&V===Q.uid){Q.trigger("ready")}else{if(N[V]){N[V].trigger(R.toLowerCase(),U,T)}}}A[O]=function(){var R=arguments;setTimeout(function(){M.apply(null,R)},1)};this.jsreciver=O;this.destroy=function(){return P&&P.apply(this,arguments)};this.flashExec=function(U,R){var S=Q.getFlash(),T=K.slice(arguments,2);return S.exec(this.uid,U,R,T)}}K.inherits(J,{constructor:F,init:function(){var N=this.getContainer(),M=this.options,L;N.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});L='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+M.swf+'" ';if(K.browser.ie){L+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}L+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+M.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';N.html(L)},getFlash:function(){if(this._flash){return this._flash}this._flash=H("#"+this.uid).get(0);return this._flash}});F.register=function(M,L){L=G[M]=K.inherits(E,H.extend({flashExec:function(){var O=this.owner,N=this.getRuntime();return N.flashExec.apply(O,arguments)}},L));return L};if(D()>=11.4){J.addRuntime(I,F)}return F});C("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(E,D){var F=E.$;return D.register("FilePicker",{init:function(H){var I=F.extend({},H),J,G;J=I.accept&&I.accept.length;for(G=0;G<J;G++){if(!I.accept[G].title){I.accept[G].title="Files"}}delete I.button;delete I.id;delete I.container;this.flashExec("FilePicker","init",I)},destroy:function(){this.flashExec("FilePicker","destroy")}})});C("runtime/flash/image",["runtime/flash/runtime"],function(D){return D.register("Image",{loadFromBlob:function(E){var F=this.owner;F.info()&&this.flashExec("Image","info",F.info());F.meta()&&this.flashExec("Image","meta",F.meta());this.flashExec("Image","loadFromBlob",E.uid)}})});C("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(E,D,F){var G=E.$;return D.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var L=this.owner,H=this.options,K=this._initAjax(),I=L._blob,J=H.server,M;K.connectRuntime(I.ruid);if(H.sendAsBinary){J+=(/\?/.test(J)?"&":"?")+G.param(L._formData);M=I.uid}else{G.each(L._formData,function(O,N){K.exec("append",O,N)});K.exec("appendBlob",H.fileVal,I.uid,H.filename||L._formData.name||"")}this._setRequestHeader(K,H.headers);K.exec("send",{method:H.method,url:J,forceURLStream:H.forceURLStream,mimeType:"application/octet-stream"},M)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var H=this._xhr;if(H){H.exec("abort");H.destroy();this._xhr=H=null}},destroy:function(){this.abort()},_initAjax:function(){var H=this,I=new F("XMLHttpRequest");I.on("uploadprogress progress",function(K){var J=K.loaded/K.total;J=Math.min(1,Math.max(0,J));return H.trigger("progress",J)});I.on("load",function(){var L=I.exec("getStatus"),J=false,M="",K;I.off();H._xhr=null;if(L>=200&&L<300){J=true}else{if(L>=500&&L<600){J=true;M="server"}else{M="http"}}if(J){H._response=I.exec("getResponse");H._response=decodeURIComponent(H._response);K=A.JSON&&A.JSON.parse||function(N){try{return new Function("return "+N).call()}catch(O){return{}}};H._responseJson=H._response?K(H._response):{}}I.destroy();I=null;return M?H.trigger("error",M):H.trigger("load")});I.on("error",function(){I.off();H._xhr=null;H.trigger("error","http")});H._xhr=I;return I},_setRequestHeader:function(I,H){G.each(H,function(J,K){I.exec("setRequestHeader",J,K)})}})});C("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(E,D){return E.register("Blob",{slice:function(H,G){var F=this.flashExec("Blob","slice",H,G);return new D(F.uid,F)}})});C("runtime/flash/md5",["runtime/flash/runtime"],function(D){return D.register("Md5",{init:function(){},loadFromBlob:function(E){return this.flashExec("Md5","loadFromBlob",E.uid)}})});C("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(D){return D});C("widgets/log",["base","uploader","widgets/widget"],function(F,E){var I=F.$,K=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",H=(location.hostname||location.host||"protected").toLowerCase(),J=H&&/baidu/i.exec(H),D;if(!J){return}D={dv:3,master:"webuploader",online:/test/.exec(H)?0:1,module:"",product:H,type:0};function G(O){var L=I.extend({},D,O),N=K.replace(/^(.*)\?/,"$1"+I.param(L)),M=new Image();M.src=N}return E.register({name:"log",init:function(){var N=this.owner,M=0,L=0;N.on("error",function(O){G({type:2,c_error_code:O})}).on("uploadError",function(P,O){G({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+O})}).on("uploadComplete",function(O){M++;L+=O.size}).on("uploadFinished",function(){G({c_count:M,c_size:L});M=L=0});G({c_usage:1})}})});C("webuploader",["preset/all","widgets/log"],function(D){return D});return B("webuploader")});