(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("./searchcursor"),require("../scroll/annotatescrollbar"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./searchcursor","../scroll/annotatescrollbar"],A)}else{A(CodeMirror)}}})(function(D){D.defineExtension("showMatchesOnScrollbar",function(G,F,E){if(typeof E=="string"){E={className:E}}if(!E){E={}}return new A(this,G,F,E)});function A(K,H,G,F){this.cm=K;this.options=F;var J={listenForChanges:false};for(var I in F){J[I]=F[I]}if(!J.className){J.className="CodeMirror-search-match"}this.annotation=K.annotateScrollbar(J);this.query=H;this.caseFold=G;this.gap={from:K.firstLine(),to:K.lastLine()+1};this.matches=[];this.update=null;this.findMatches();this.annotation.update(this.matches);var E=this;K.on("change",this.changeHandler=function(M,L){E.onChange(L)})}var B=1000;A.prototype.findMatches=function(){if(!this.gap){return}for(var F=0;F<this.matches.length;F++){var G=this.matches[F];if(G.from.line>=this.gap.to){break}if(G.to.line>=this.gap.from){this.matches.splice(F--,1)}}var E=this.cm.getSearchCursor(this.query,D.Pos(this.gap.from,0),this.caseFold);var H=this.options&&this.options.maxMatches||B;while(E.findNext()){var G={from:E.from(),to:E.to()};if(G.from.line>=this.gap.to){break}this.matches.splice(F++,0,G);if(this.matches.length>H){break}}this.gap=null};function C(F,E,G){if(F<=E){return F}return Math.max(E,F+G)}A.prototype.onChange=function(L){var G=L.from.line;var H=D.changeEnd(L).line;var K=H-L.to.line;if(this.gap){this.gap.from=Math.min(C(this.gap.from,G,K),L.from.line);this.gap.to=Math.max(C(this.gap.to,G,K),L.from.line)}else{this.gap={from:L.from.line,to:H+1}}if(K){for(var J=0;J<this.matches.length;J++){var F=this.matches[J];var E=C(F.from.line,G,K);if(E!=F.from.line){F.from=D.Pos(E,F.from.ch)}var M=C(F.to.line,G,K);if(M!=F.to.line){F.to=D.Pos(M,F.to.ch)}}}clearTimeout(this.update);var I=this;this.update=setTimeout(function(){I.updateAfterChange()},250)};A.prototype.updateAfterChange=function(){this.findMatches();this.annotation.update(this.matches)};A.prototype.clear=function(){this.cm.off("change",this.changeHandler);this.annotation.clear()}});