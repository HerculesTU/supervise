(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(F){var B={};var A=/[^\s\u00a0]/;var G=F.Pos;function D(H){var I=H.search(A);return I==-1?0:I}F.commands.toggleComment=function(H){H.toggleComment()};F.defineExtension("toggleComment",function(K){if(!K){K=B}var I=this;var H=Infinity,O=this.listSelections(),M=null;for(var J=O.length-1;J>=0;J--){var L=O[J].from(),N=O[J].to();if(L.line>=H){continue}if(N.line>=H){N=G(H,0)}H=L.line;if(M==null){if(I.uncomment(L,N,K)){M="un"}else{I.lineComment(L,N,K);M="line"}}else{if(M=="un"){I.uncomment(L,N,K)}else{I.lineComment(L,N,K)}}}});function E(J,H,I){return/\bstring\b/.test(J.getTokenTypeAt(G(H.line,0)))&&!/^[\'\"`]/.test(I)}function C(J,I){var H=J.getMode();return H.useInnerComments===false||!H.innerMode?H:J.getModeAt(I)}F.defineExtension("lineComment",function(K,O,J){if(!J){J=B}var N=this,L=C(N,K);var Q=N.getLine(K.line);if(Q==null||E(N,K,Q)){return}var M=J.lineComment||L.lineComment;if(!M){if(J.blockCommentStart||L.blockCommentStart){J.fullLines=true;N.blockComment(K,O,J)}return}var H=Math.min(O.ch!=0||O.line==K.line?O.line+1:O.line,N.lastLine()+1);var P=J.padding==null?" ":J.padding;var I=J.commentBlankLines||K.line==O.line;N.operation(function(){if(J.indent){var R=null;for(var S=K.line;S<H;++S){var V=N.getLine(S);var U=V.slice(0,D(V));if(R==null||R.length>U.length){R=U}}for(var S=K.line;S<H;++S){var V=N.getLine(S),T=R.length;if(!I&&!A.test(V)){continue}if(V.slice(0,T)!=R){T=D(V)}N.replaceRange(R+M+P,G(S,0),G(S,T))}}else{for(var S=K.line;S<H;++S){if(I||A.test(N.getLine(S))){N.replaceRange(M+P,G(S,0))}}}})});F.defineExtension("blockComment",function(L,O,K){if(!K){K=B}var N=this,M=C(N,L);var P=K.blockCommentStart||M.blockCommentStart;var I=K.blockCommentEnd||M.blockCommentEnd;if(!P||!I){if((K.lineComment||M.lineComment)&&K.fullLines!=false){N.lineComment(L,O,K)}return}if(/\bcomment\b/.test(N.getTokenTypeAt(G(L.line,0)))){return}var J=Math.min(O.line,N.lastLine());if(J!=L.line&&O.ch==0&&A.test(N.getLine(J))){--J}var H=K.padding==null?" ":K.padding;if(L.line>J){return}N.operation(function(){if(K.fullLines!=false){var S=A.test(N.getLine(J));N.replaceRange(H+I,G(J));N.replaceRange(P+H,G(L.line,0));var R=K.blockCommentLead||M.blockCommentLead;if(R!=null){for(var Q=L.line+1;Q<=J;++Q){if(Q!=J||S){N.replaceRange(R+H,G(Q,0))}}}}else{N.replaceRange(I,O);N.replaceRange(P,L)}})});F.defineExtension("uncomment",function(T,H,X){if(!X){X=B}var d=this,J=C(d,T);var R=Math.min(H.ch!=0||H.line==T.line?H.line:H.line-1,d.lastLine()),I=Math.min(T.line,R);var Y=X.lineComment||J.lineComment,U=[];var P=X.padding==null?" ":X.padding,W;lineComment:{if(!Y){break lineComment}for(var Z=I;Z<=R;++Z){var L=d.getLine(Z);var S=L.indexOf(Y);if(S>-1&&!/comment/.test(d.getTokenTypeAt(G(Z,S+1)))){S=-1}if(S==-1&&A.test(L)){break lineComment}if(S>-1&&A.test(L.slice(0,S))){break lineComment}U.push(L)}d.operation(function(){for(var f=I;f<=R;++f){var j=U[f-I];var g=j.indexOf(Y),h=g+Y.length;if(g<0){continue}if(j.slice(h,h+P.length)==P){h+=P.length}W=true;d.replaceRange("",G(f,g),G(f,h))}});if(W){return true}}var N=X.blockCommentStart||J.blockCommentStart;var c=X.blockCommentEnd||J.blockCommentEnd;if(!N||!c){return false}var K=X.blockCommentLead||J.blockCommentLead;var O=d.getLine(I),e=O.indexOf(N);if(e==-1){return false}var b=R==I?O:d.getLine(R);var M=b.indexOf(c,R==I?e+N.length:0);if(M==-1&&I!=R){b=d.getLine(--R);M=b.indexOf(c)}if(M==-1||!/comment/.test(d.getTokenTypeAt(G(I,e+1)))||!/comment/.test(d.getTokenTypeAt(G(R,M+1)))){return false}var a=O.lastIndexOf(N,T.ch);var Q=a==-1?-1:O.slice(0,T.ch).indexOf(c,a+N.length);if(a!=-1&&Q!=-1&&Q+c.length!=T.ch){return false}Q=b.indexOf(c,H.ch);var V=b.slice(H.ch).lastIndexOf(N,Q-H.ch);a=(Q==-1||V==-1)?-1:H.ch+V;if(Q!=-1&&a!=-1&&a!=H.ch){return false}d.operation(function(){d.replaceRange("",G(R,M-(P&&b.slice(M-P.length,M)==P?P.length:0)),G(R,M+c.length));var f=e+N.length;if(P&&O.slice(f,f+P.length)==P){f+=P.length}d.replaceRange("",G(I,e),G(I,f));if(K){for(var g=I+1;g<=R;++g){var j=d.getLine(g),k=j.indexOf(K);if(k==-1||A.test(j.slice(0,k))){continue}var h=k+K.length;if(P&&j.slice(h,h+P.length)==P){h+=P.length}d.replaceRange("",G(g,k),G(g,h))}}});return true})});