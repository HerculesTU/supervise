(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(M){var K="CodeMirror-hint";var C="CodeMirror-hint-active";M.showHint=function(U,R,Q){if(!R){return U.showHint(Q)}if(Q&&Q.async){R.async=true}var T={hint:R};if(Q){for(var S in Q){T[S]=Q[S]}}return U.showHint(T)};M.defineExtension("showHint",function(S){S=A(this,this.getCursor("start"),S);var Q=this.listSelections();if(Q.length>1){return}if(this.somethingSelected()){if(!S.hint.supportsSelection){return}for(var R=0;R<Q.length;R++){if(Q[R].head.line!=Q[R].anchor.line){return}}}if(this.state.completionActive){this.state.completionActive.close()}var T=this.state.completionActive=new P(this,S);if(!T.options.hint){return}M.signal(this,"startCompletion",this);T.update(true)});function P(S,R){this.cm=S;this.options=R;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var Q=this;S.on("cursorActivity",this.activityFunc=function(){Q.cursorActivity()})}var G=window.requestAnimationFrame||function(Q){return setTimeout(Q,1000/60)};var H=window.cancelAnimationFrame||clearTimeout;P.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){M.signal(this.data,"close")}if(this.widget){this.widget.close()}M.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(S,Q){var R=S.list[Q];if(R.hint){R.hint(this.cm,S,R)}else{this.cm.replaceRange(F(R),R.from||S.from,R.to||S.to,"complete")}M.signal(S,"pick",R);this.close()},cursorActivity:function(){if(this.debounce){H(this.debounce);this.debounce=0}var R=this.cm.getCursor(),S=this.cm.getLine(R.line);if(R.line!=this.startPos.line||S.length-R.ch!=this.startLen-this.startPos.ch||R.ch<this.startPos.ch||this.cm.somethingSelected()||(R.ch&&this.options.closeCharacters.test(S.charAt(R.ch-1)))){this.close()}else{var Q=this;this.debounce=G(function(){Q.update()});if(this.widget){this.widget.disable()}}},update:function(S){if(this.tick==null){return}var Q=this,R=++this.tick;N(this.options.hint,this.cm,this.options,function(T){if(Q.tick==R){Q.finishUpdate(T,S)}})},finishUpdate:function(S,Q){if(this.data){M.signal(this.data,"update")}var R=(this.widget&&this.widget.picked)||(Q&&this.options.completeSingle);if(this.widget){this.widget.close()}if(S&&this.data&&J(this.data,S)){return}this.data=S;if(S&&S.list.length){if(R&&S.list.length==1){this.pick(S,0)}else{this.widget=new I(this,S);M.signal(S,"shown")}}}};function J(R,Q){var S=M.cmpPos(Q.from,R.from);return S>0&&R.to.ch-R.from.ch!=Q.to.ch-Q.from.ch}function A(V,Q,R){var U=V.options.hintOptions;var S={};for(var T in D){S[T]=D[T]}if(U){for(var T in U){if(U[T]!==undefined){S[T]=U[T]}}}if(R){for(var T in R){if(R[T]!==undefined){S[T]=R[T]}}}if(S.hint.resolve){S.hint=S.hint.resolve(V,Q)}return S}function F(Q){if(typeof Q=="string"){return Q}else{return Q.text}}function B(U,S){var T={Up:function(){S.moveFocus(-1)},Down:function(){S.moveFocus(1)},PageUp:function(){S.moveFocus(-S.menuSize()+1,true)},PageDown:function(){S.moveFocus(S.menuSize()-1,true)},Home:function(){S.setFocus(0)},End:function(){S.setFocus(S.length-1)},Enter:S.pick,Tab:S.pick,Esc:S.close};var R=U.options.customKeys;var V=R?{}:T;function Q(Y,Z){var a;if(typeof Z!="string"){a=function(b){return Z(b,S)}}else{if(T.hasOwnProperty(Z)){a=T[Z]}else{a=Z}}V[Y]=a}if(R){for(var W in R){if(R.hasOwnProperty(W)){Q(W,R[W])}}}var X=U.options.extraKeys;if(X){for(var W in X){if(X.hasOwnProperty(W)){Q(W,X[W])}}}return V}function O(R,Q){while(Q&&Q!=R){if(Q.nodeName.toUpperCase()==="LI"&&Q.parentNode==R){return Q}Q=Q.parentNode}}function I(f,n){this.completion=f;this.data=n;this.picked=false;var g=this,l=f.cm;var j=this.hints=document.createElement("ul");j.className="CodeMirror-hints";this.selectedHint=n.selectedHint||0;var W=n.list;for(var X=0;X<W.length;++X){var Q=j.appendChild(document.createElement("li")),T=W[X];var d=K+(X!=this.selectedHint?"":" "+C);if(T.className!=null){d=T.className+" "+d}Q.className=d;if(T.render){T.render(Q,n,T)}else{Q.appendChild(document.createTextNode(T.displayText||F(T)))}Q.hintId=X}var o=l.cursorCoords(f.options.alignWithWord?n.from:null);var m=o.left,a=o.bottom,h=true;j.style.left=m+"px";j.style.top=a+"px";var p=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var b=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(f.options.container||document.body).appendChild(j);var V=j.getBoundingClientRect(),Z=V.bottom-b;var R=j.scrollHeight>j.clientHeight+1;var c=l.getScrollInfo();if(Z>0){var k=V.bottom-V.top,e=o.top-(o.bottom-V.top);if(e-k>0){j.style.top=(a=o.top-k)+"px";h=false}else{if(k>b){j.style.height=(b-5)+"px";j.style.top=(a=o.bottom-V.top)+"px";var Y=l.getCursor();if(n.from.ch!=Y.ch){o=l.cursorCoords(Y);j.style.left=(m=o.left)+"px";V=j.getBoundingClientRect()}}}}var U=V.right-p;if(U>0){if(V.right-V.left>p){j.style.width=(p-5)+"px";U-=(V.right-V.left)-p}j.style.left=(m=o.left-U)+"px"}if(R){for(var q=j.firstChild;q;q=q.nextSibling){q.style.paddingRight=l.display.nativeBarWidth+"px"}}l.addKeyMap(this.keyMap=B(f,{moveFocus:function(r,i){g.changeActive(g.selectedHint+r,i)},setFocus:function(i){g.changeActive(i)},menuSize:function(){return g.screenAmount()},length:W.length,close:function(){f.close()},pick:function(){g.pick()},data:n}));if(f.options.closeOnUnfocus){var S;l.on("blur",this.onBlur=function(){S=setTimeout(function(){f.close()},100)});l.on("focus",this.onFocus=function(){clearTimeout(S)})}l.on("scroll",this.onScroll=function(){var i=l.getScrollInfo(),t=l.getWrapperElement().getBoundingClientRect();var s=a+c.top-i.top;var r=s-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!h){r+=j.offsetHeight}if(r<=t.top||r>=t.bottom){return f.close()}j.style.top=s+"px";j.style.left=(m+c.left-i.left)+"px"});M.on(j,"dblclick",function(i){var r=O(j,i.target||i.srcElement);if(r&&r.hintId!=null){g.changeActive(r.hintId);g.pick()}});M.on(j,"click",function(i){var r=O(j,i.target||i.srcElement);if(r&&r.hintId!=null){g.changeActive(r.hintId);if(f.options.completeOnSingleClick){g.pick()}}});M.on(j,"mousedown",function(){setTimeout(function(){l.focus()},20)});M.signal(n,"select",W[0],j.firstChild);return true}I.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var Q=this.completion.cm;if(this.completion.options.closeOnUnfocus){Q.off("blur",this.onBlur);Q.off("focus",this.onFocus)}Q.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var Q=this;this.keyMap={Enter:function(){Q.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(R,Q){if(R>=this.data.list.length){R=Q?this.data.list.length-1:0}else{if(R<0){R=Q?0:this.data.list.length-1}}if(this.selectedHint==R){return}var S=this.hints.childNodes[this.selectedHint];S.className=S.className.replace(" "+C,"");S=this.hints.childNodes[this.selectedHint=R];S.className+=" "+C;if(S.offsetTop<this.hints.scrollTop){this.hints.scrollTop=S.offsetTop-3}else{if(S.offsetTop+S.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=S.offsetTop+S.offsetHeight-this.hints.clientHeight+3}}M.signal(this.data,"select",this.data.list[this.selectedHint],S)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};function E(T,S){if(!T.somethingSelected()){return S}var R=[];for(var Q=0;Q<S.length;Q++){if(S[Q].supportsSelection){R.push(S[Q])}}return R}function N(Q,U,S,T){if(Q.async){Q(U,T,S)}else{var R=Q(U,S);if(R&&R.then){R.then(T)}else{T(R)}}}function L(T,R){var S=T.getHelpers(R,"hint"),Q;if(S.length){var U=function(Y,V,X){var W=E(Y,S);function Z(a){if(a==W.length){return V(null)}N(W[a],Y,X,function(b){if(b&&b.list.length>0){V(b)}else{Z(a+1)}})}Z(0)};U.async=true;U.supportsSelection=true;return U}else{if(Q=T.getHelper(T.getCursor(),"hintWords")){return function(V){return M.hint.fromList(V,{words:Q})}}else{if(M.hint.anyword){return function(W,V){return M.hint.anyword(W,V)}}else{return function(){}}}}}M.registerHelper("hint","auto",{resolve:L});M.registerHelper("hint","fromList",function(R,V){var Q=R.getCursor(),Z=R.getTokenAt(Q);var Y=M.Pos(Q.line,Z.end);if(Z.string&&/\w/.test(Z.string[Z.string.length-1])){var S=Z.string,W=M.Pos(Q.line,Z.start)}else{var S="",W=Y}var U=[];for(var T=0;T<V.words.length;T++){var X=V.words[T];if(X.slice(0,S.length)==S){U.push(X)}}if(U.length){return{list:U,from:W,to:Y}}});M.commands.autocomplete=M.showHint;var D={hint:M.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};M.defineOption("hintOptions",null)});