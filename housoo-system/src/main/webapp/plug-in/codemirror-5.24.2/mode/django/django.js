(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("django:inner",function(){var E=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],J=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],D=["==","!=","<",">","<=",">="],C=["in","not","or","and"];E=new RegExp("^\\b("+E.join("|")+")\\b");J=new RegExp("^\\b("+J.join("|")+")\\b");D=new RegExp("^\\b("+D.join("|")+")\\b");C=new RegExp("^\\b("+C.join("|")+")\\b");function F(M,L){if(M.match("{{")){L.tokenize=I;return"tag"}else{if(M.match("{%")){L.tokenize=H;return"tag"}else{if(M.match("{#")){L.tokenize=B;return"comment"}}}while(M.next()!=null&&!M.match(/\{[{%#]/,false)){}return null}function K(M,L){return function(P,O){if(!O.escapeNext&&P.eat(M)){O.tokenize=L}else{if(O.escapeNext){O.escapeNext=false}var N=P.next();if(N=="\\"){O.escapeNext=true}}return"string"}}function I(M,L){if(L.waitDot){L.waitDot=false;if(M.peek()!="."){return"null"}if(M.match(/\.\W+/)){return"error"}else{if(M.eat(".")){L.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(L.waitPipe){L.waitPipe=false;if(M.peek()!="|"){return"null"}if(M.match(/\.\W+/)){return"error"}else{if(M.eat("|")){L.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(L.waitProperty){L.waitProperty=false;if(M.match(/\b(\w+)\b/)){L.waitDot=true;L.waitPipe=true;return"property"}}if(L.waitFilter){L.waitFilter=false;if(M.match(J)){return"variable-2"}}if(M.eatSpace()){L.waitProperty=false;return"null"}if(M.match(/\b\d+(\.\d+)?\b/)){return"number"}if(M.match("'")){L.tokenize=K("'",L.tokenize);return"string"}else{if(M.match('"')){L.tokenize=K('"',L.tokenize);return"string"}}if(M.match(/\b(\w+)\b/)&&!L.foundVariable){L.waitDot=true;L.waitPipe=true;return"variable"}if(M.match("}}")){L.waitProperty=null;L.waitFilter=null;L.waitDot=null;L.waitPipe=null;L.tokenize=F;return"tag"}M.next();return"null"}function H(N,M){if(M.waitDot){M.waitDot=false;if(N.peek()!="."){return"null"}if(N.match(/\.\W+/)){return"error"}else{if(N.eat(".")){M.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(M.waitPipe){M.waitPipe=false;if(N.peek()!="|"){return"null"}if(N.match(/\.\W+/)){return"error"}else{if(N.eat("|")){M.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(M.waitProperty){M.waitProperty=false;if(N.match(/\b(\w+)\b/)){M.waitDot=true;M.waitPipe=true;return"property"}}if(M.waitFilter){M.waitFilter=false;if(N.match(J)){return"variable-2"}}if(N.eatSpace()){M.waitProperty=false;return"null"}if(N.match(/\b\d+(\.\d+)?\b/)){return"number"}if(N.match("'")){M.tokenize=K("'",M.tokenize);return"string"}else{if(N.match('"')){M.tokenize=K('"',M.tokenize);return"string"}}if(N.match(D)){return"operator"}if(N.match(C)){return"keyword"}var L=N.match(E);if(L){if(L[0]=="comment"){M.blockCommentTag=true}return"keyword"}if(N.match(/\b(\w+)\b/)){M.waitDot=true;M.waitPipe=true;return"variable"}if(N.match("%}")){M.waitProperty=null;M.waitFilter=null;M.waitDot=null;M.waitPipe=null;if(M.blockCommentTag){M.blockCommentTag=false;M.tokenize=G}else{M.tokenize=F}return"tag"}N.next();return"null"}function B(M,L){if(M.match(/^.*?#\}/)){L.tokenize=F}else{M.skipToEnd()}return"comment"}function G(M,L){if(M.match(/\{%\s*endcomment\s*%\}/,false)){L.tokenize=H;M.match("{%");return"tag"}else{M.next();return"comment"}}return{startState:function(){return{tokenize:F}},token:function(M,L){return L.tokenize(M,L)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});A.defineMode("django",function(C){var B=A.getMode(C,"text/html");var D=A.getMode(C,"django:inner");return A.overlayMode(B,D)});A.defineMIME("text/x-django","django")});