(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../meta"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("markdown",function(Y,F){var a=A.getMode(Y,"text/html");var K=a.name=="null";function Z(j){if(A.findModeByName){var k=A.findModeByName(j);if(k){j=k.mime||k.mimes[0]}}var i=A.getMode(Y,j);return i.name=="null"?null:i}if(F.highlightFormatting===undefined){F.highlightFormatting=false}if(F.maxBlockquoteDepth===undefined){F.maxBlockquoteDepth=0}if(F.underscoresBreakWords===undefined){F.underscoresBreakWords=true}if(F.taskLists===undefined){F.taskLists=false}if(F.strikethrough===undefined){F.strikethrough=false}if(F.tokenTypeOverrides===undefined){F.tokenTypeOverrides={}}var M={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var X in M){if(M.hasOwnProperty(X)&&F.tokenTypeOverrides[X]){M[X]=F.tokenTypeOverrides[X]}}var B=/^([*\-_])(?:\s*\1){2,}\s*$/,Q=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,S=/^\[(x| )\](?=\s)/,E=F.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,O=/^ *(?:\={1,}|-{1,})\s*$/,I=/^[^#!\[\]*_\\<>` "'(~]+/,L=new RegExp("^("+(F.fencedCodeBlocks===true?"~~~+|```+":F.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)");function N(k,j,i){j.f=j.inline=i;return i(k,j)}function H(k,j,i){j.f=j.block=i;return i(k,j)}function C(i){return !i||!/\S/.test(i.string)}function f(i){i.linkTitle=false;i.em=false;i.strong=false;i.strikethrough=false;i.quote=0;i.indentedCode=false;if(K&&i.f==g){i.f=c;i.block=D}i.trailingSpace=0;i.trailingSpaceNewLine=false;i.prevLine=i.thisLine;i.thisLine=null;return null}function D(o,m){var j=o.sol();var k=m.list!==false,n=m.indentedCode;m.indentedCode=false;if(k){if(m.indentationDiff>=0){if(m.indentationDiff<4){m.indentation-=m.indentationDiff}m.list=null}else{if(m.indentation>0){m.list=null}else{m.list=false}}}var i=null;if(m.indentationDiff>=4){o.skipToEnd();if(n||C(m.prevLine)){m.indentation-=4;m.indentedCode=true;return M.code}else{return null}}else{if(o.eatSpace()){return null}else{if((i=o.match(E))&&i[1].length<=6){m.header=i[1].length;if(F.highlightFormatting){m.formatting="header"}m.f=m.inline;return G(m)}else{if(!C(m.prevLine)&&!m.quote&&!k&&!n&&(i=o.match(O))){m.header=i[0].charAt(0)=="="?1:2;if(F.highlightFormatting){m.formatting="header"}m.f=m.inline;return G(m)}else{if(o.eat(">")){m.quote=j?1:m.quote+1;if(F.highlightFormatting){m.formatting="quote"}o.eatSpace();return G(m)}else{if(o.peek()==="["){return N(o,m,e)}else{if(o.match(B,true)){m.hr=true;return M.hr}else{if(i=o.match(Q)){var l=i[1]?"ol":"ul";m.indentation=o.column()+o.current().length;m.list=true;while(m.listStack&&o.column()<m.listStack[m.listStack.length-1]){m.listStack.pop()}m.listStack.push(m.indentation);if(F.taskLists&&o.match(S,false)){m.taskList=true}m.f=m.inline;if(F.highlightFormatting){m.formatting=["list","list-"+l]}return G(m)}else{if(F.fencedCodeBlocks&&(i=o.match(L,true))){m.fencedChars=i[1];m.localMode=Z(i[2]);if(m.localMode){m.localState=A.startState(m.localMode)}m.f=m.block=T;if(F.highlightFormatting){m.formatting="code-block"}m.code=-1;return G(m)}}}}}}}}}return N(o,m,m.inline)}function g(l,j){var i=a.token(l,j.htmlState);if(!K){var k=A.innerMode(a,j.htmlState);if((k.mode.name=="xml"&&k.state.tagStart===null&&(!k.state.context&&k.state.tokenize.isInText))||(j.md_inside&&l.current().indexOf(">")>-1)){j.f=c;j.block=D;j.htmlState=null}}return i}function T(j,i){if(i.fencedChars&&j.match(i.fencedChars)){if(F.highlightFormatting){i.formatting="code-block"}i.localMode=i.localState=null;i.f=i.block=P;return G(i)}else{if(i.fencedChars&&j.skipTo(i.fencedChars)){return"comment"}else{if(i.localMode){return i.localMode.token(j,i.localState)}else{j.skipToEnd();return M.code}}}}function P(k,j){k.match(j.fencedChars);j.block=D;j.f=c;j.fencedChars=null;if(F.highlightFormatting){j.formatting="code-block"}j.code=1;var i=G(j);j.code=0;return i}function G(m){var l=[];if(m.formatting){l.push(M.formatting);if(typeof m.formatting==="string"){m.formatting=[m.formatting]}for(var j=0;j<m.formatting.length;j++){l.push(M.formatting+"-"+m.formatting[j]);if(m.formatting[j]==="header"){l.push(M.formatting+"-"+m.formatting[j]+"-"+m.header)}if(m.formatting[j]==="quote"){if(!F.maxBlockquoteDepth||F.maxBlockquoteDepth>=m.quote){l.push(M.formatting+"-"+m.formatting[j]+"-"+m.quote)}else{l.push("error")}}}}if(m.taskOpen){l.push("meta");return l.length?l.join(" "):null}if(m.taskClosed){l.push("property");return l.length?l.join(" "):null}if(m.linkHref){l.push(M.linkHref,"url")}else{if(m.strong){l.push(M.strong)}if(m.em){l.push(M.em)}if(m.strikethrough){l.push(M.strikethrough)}if(m.linkText){l.push(M.linkText)}if(m.code){l.push(M.code)}if(m.image){l.push(M.image)}if(m.imageAltText){l.push(M.imageAltText,"link")}if(m.imageMarker){l.push(M.imageMarker)}}if(m.header){l.push(M.header,M.header+"-"+m.header)}if(m.quote){l.push(M.quote);if(!F.maxBlockquoteDepth||F.maxBlockquoteDepth>=m.quote){l.push(M.quote+"-"+m.quote)}else{l.push(M.quote+"-"+F.maxBlockquoteDepth)}}if(m.list!==false){var k=(m.listStack.length-1)%3;if(!k){l.push(M.list1)}else{if(k===1){l.push(M.list2)}else{l.push(M.list3)}}}if(m.trailingSpaceNewLine){l.push("trailing-space-new-line")}else{if(m.trailingSpace){l.push("trailing-space-"+(m.trailingSpace%2?"a":"b"))}}return l.length?l.join(" "):null}function h(j,i){if(j.match(I,true)){return G(i)}return undefined}function c(y,m){var Aa=m.text(y,m);if(typeof Aa!=="undefined"){return Aa}if(m.list){m.list=null;return G(m)}if(m.taskList){var v=y.match(S,true)[1]!=="x";if(v){m.taskOpen=true}else{m.taskClosed=true}if(F.highlightFormatting){m.formatting="task"}m.taskList=false;return G(m)}m.taskOpen=false;m.taskClosed=false;if(m.header&&y.match(/^#+$/,true)){if(F.highlightFormatting){m.formatting="header"}return G(m)}var x=y.sol();var o=y.next();if(m.linkTitle){m.linkTitle=false;var i=o;if(o==="("){i=")"}i=(i+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var p="^\\s*(?:[^"+i+"\\\\]+|\\\\\\\\|\\\\.)"+i;if(y.match(new RegExp(p),true)){return M.linkHref}}if(o==="`"){var q=m.formatting;if(F.highlightFormatting){m.formatting="code"}y.eatWhile("`");var l=y.current().length;if(m.code==0){m.code=l;return G(m)}else{if(l==m.code){var k=G(m);m.code=0;return k}else{m.formatting=q;return G(m)}}}else{if(m.code){return G(m)}}if(o==="\\"){y.next();if(F.highlightFormatting){var z=G(m);var u=M.formatting+"-escape";return z?z+" "+u:u}}if(o==="!"&&y.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){m.imageMarker=true;m.image=true;if(F.highlightFormatting){m.formatting="image"}return G(m)}if(o==="["&&m.imageMarker&&y.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,false)){m.imageMarker=false;m.imageAltText=true;if(F.highlightFormatting){m.formatting="image"}return G(m)}if(o==="]"&&m.imageAltText){if(F.highlightFormatting){m.formatting="image"}var z=G(m);m.imageAltText=false;m.image=false;m.inline=m.f=J;return z}if(o==="["&&y.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,false)&&!m.image){m.linkText=true;if(F.highlightFormatting){m.formatting="link"}return G(m)}if(o==="]"&&m.linkText&&y.match(/\(.*?\)| ?\[.*?\]/,false)){if(F.highlightFormatting){m.formatting="link"}var z=G(m);m.linkText=false;m.inline=m.f=J;return z}if(o==="<"&&y.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){m.f=m.inline=U;if(F.highlightFormatting){m.formatting="link"}var z=G(m);if(z){z+=" "}else{z=""}return z+M.linkInline}if(o==="<"&&y.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){m.f=m.inline=U;if(F.highlightFormatting){m.formatting="link"}var z=G(m);if(z){z+=" "}else{z=""}return z+M.linkEmail}if(o==="<"&&y.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,false)){var n=y.string.indexOf(">",y.pos);if(n!=-1){var s=y.string.substring(y.start,n);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(s)){m.md_inside=true}}y.backUp(1);m.htmlState=A.startState(a);return H(y,m,g)}if(o==="<"&&y.match(/^\/\w*?>/)){m.md_inside=false;return"tag"}var j=false;if(!F.underscoresBreakWords){if(o==="_"&&y.peek()!=="_"&&y.match(/(\w)/,false)){var w=y.pos-2;if(w>=0){var r=y.string.charAt(w);if(r!=="_"&&r.match(/(\w)/,false)){j=true}}}}if(o==="*"||(o==="_"&&!j)){if(x&&y.peek()===" "){}else{if(m.strong===o&&y.eat(o)){if(F.highlightFormatting){m.formatting="strong"}var k=G(m);m.strong=false;return k}else{if(!m.strong&&y.eat(o)){m.strong=o;if(F.highlightFormatting){m.formatting="strong"}return G(m)}else{if(m.em===o){if(F.highlightFormatting){m.formatting="em"}var k=G(m);m.em=false;return k}else{if(!m.em){m.em=o;if(F.highlightFormatting){m.formatting="em"}return G(m)}}}}}}else{if(o===" "){if(y.eat("*")||y.eat("_")){if(y.peek()===" "){return G(m)}else{y.backUp(1)}}}}if(F.strikethrough){if(o==="~"&&y.eatWhile(o)){if(m.strikethrough){if(F.highlightFormatting){m.formatting="strikethrough"}var k=G(m);m.strikethrough=false;return k}else{if(y.match(/^[^\s]/,false)){m.strikethrough=true;if(F.highlightFormatting){m.formatting="strikethrough"}return G(m)}}}else{if(o===" "){if(y.match(/^~~/,true)){if(y.peek()===" "){return G(m)}else{y.backUp(2)}}}}}if(o===" "){if(y.match(/ +$/,false)){m.trailingSpace++}else{if(m.trailingSpace){m.trailingSpaceNewLine=true}}}return G(m)}function U(l,k){var j=l.next();if(j===">"){k.f=k.inline=c;if(F.highlightFormatting){k.formatting="link"}var i=G(k);if(i){i+=" "}else{i=""}return i+M.linkInline}l.match(/^[^>]+/,true);return M.linkInline}function J(k,j){if(k.eatSpace()){return null}var i=k.next();if(i==="("||i==="["){j.f=j.inline=b(i==="("?")":"]",0);if(F.highlightFormatting){j.formatting="link-string"}j.linkHref=true;return G(j)}return"error"}var V={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/};function b(i){return function(m,l){var k=m.next();if(k===i){l.f=l.inline=c;if(F.highlightFormatting){l.formatting="link-string"}var j=G(l);l.linkHref=false;return j}m.match(V[i]);l.linkHref=true;return G(l)}}function e(j,i){if(j.match(/^([^\]\\]|\\.)*\]:/,false)){i.f=R;j.next();if(F.highlightFormatting){i.formatting="link"}i.linkText=true;return G(i)}return N(j,i,c)}function R(k,j){if(k.match(/^\]:/,true)){j.f=j.inline=d;if(F.highlightFormatting){j.formatting="link"}var i=G(j);j.linkText=false;return i}k.match(/^([^\]\\]|\\.)+/,true);return M.linkText}function d(j,i){if(j.eatSpace()){return null}j.match(/^[^\s]+/,true);if(j.peek()===undefined){i.linkTitle=true}else{j.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}i.f=i.inline=c;return M.linkHref+" url"}var W={startState:function(){return{f:D,prevLine:null,thisLine:null,block:D,htmlState:null,indentation:0,inline:c,text:h,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(i){return{f:i.f,prevLine:i.prevLine,thisLine:i.thisLine,block:i.block,htmlState:i.htmlState&&A.copyState(a,i.htmlState),indentation:i.indentation,localMode:i.localMode,localState:i.localMode?A.copyState(i.localMode,i.localState):null,inline:i.inline,text:i.text,formatting:false,linkTitle:i.linkTitle,code:i.code,em:i.em,strong:i.strong,strikethrough:i.strikethrough,header:i.header,hr:i.hr,taskList:i.taskList,list:i.list,listStack:i.listStack.slice(0),quote:i.quote,indentedCode:i.indentedCode,trailingSpace:i.trailingSpace,trailingSpaceNewLine:i.trailingSpaceNewLine,md_inside:i.md_inside,fencedChars:i.fencedChars}},token:function(l,k){k.formatting=false;if(l!=k.thisLine){var j=k.header||k.hr;k.header=0;k.hr=false;if(l.match(/^\s*$/,true)||j){f(k);if(!j){return null}k.prevLine=null}k.prevLine=k.thisLine;k.thisLine=l;k.taskList=false;k.trailingSpace=0;k.trailingSpaceNewLine=false;k.f=k.block;var i=l.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;k.indentationDiff=Math.min(i-k.indentation,4);k.indentation=k.indentation+k.indentationDiff;if(i>0){return null}}return k.f(l,k)},innerMode:function(i){if(i.block==g){return{state:i.htmlState,mode:a}}if(i.localState){return{state:i.localState,mode:i.localMode}}return{state:i,mode:W}},blankLine:f,getType:G,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return W},"xml");A.defineMIME("text/x-markdown","markdown")});