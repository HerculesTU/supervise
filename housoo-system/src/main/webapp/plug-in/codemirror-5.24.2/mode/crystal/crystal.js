(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("crystal",function(Z){function E(e,f){return new RegExp((f?"":"^")+"(?:"+e.join("|")+")"+(f?"$":"\\b"))}function Y(e,g,f){f.tokenize.push(e);return e(g,f)}var a=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var V=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var F=/^(?:\[\][?=]?)/;var M=/^(?:\.(?:\.{2})?|->|[?:])/;var L=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var G=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var B=E(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","select","sizeof","struct","super","then","type","typeof","uninitialized","union","unless","until","when","while","with","yield","__DIR__","__END_LINE__","__FILE__","__LINE__"]);var N=E(["true","false","nil","self"]);var J=["def","fun","macro","class","module","struct","lib","enum","union","do","for"];var b=E(J);var I=["if","unless","case","while","until","begin","then"];var T=E(I);var C=["end","else","elsif","rescue","ensure"];var d=E(C);var K=["\\)","\\}","\\]"];var R=new RegExp("^(?:"+K.join("|")+")$");var W={"def":Q,"fun":Q,"macro":O,"class":U,"module":U,"struct":U,"lib":U,"enum":U,"union":U};var S={"[":"]","{":"}","(":")","<":">"};function H(j,h){if(j.eatSpace()){return null}if(h.lastToken!="\\"&&j.match("{%",false)){return Y(c("%","%"),j,h)}if(h.lastToken!="\\"&&j.match("{{",false)){return Y(c("{","}"),j,h)}if(j.peek()=="#"){j.skipToEnd();return"comment"}var f;if(j.match(L)){j.eat(/[?!]/);f=j.current();if(j.eat(":")){return"atom"}else{if(h.lastToken=="."){return"property"}else{if(B.test(f)){if(b.test(f)){if(!(f=="fun"&&h.blocks.indexOf("lib")>=0)&&!(f=="def"&&h.lastToken=="abstract")){h.blocks.push(f);h.currentIndent+=1}}else{if((h.lastStyle=="operator"||!h.lastStyle)&&T.test(f)){h.blocks.push(f);h.currentIndent+=1}else{if(f=="end"){h.blocks.pop();h.currentIndent-=1}}}if(W.hasOwnProperty(f)){h.tokenize.push(W[f])}return"keyword"}else{if(N.test(f)){return"atom"}}}}return"variable"}if(j.eat("@")){if(j.peek()=="["){return Y(D("[","]","meta"),j,h)}j.eat("@");j.match(L)||j.match(G);return"variable-2"}if(j.match(G)){return"tag"}if(j.eat(":")){if(j.eat('"')){return Y(X('"',"atom",false),j,h)}else{if(j.match(L)||j.match(G)||j.match(a)||j.match(V)||j.match(F)){return"atom"}}j.eat(":");return"operator"}if(j.eat('"')){return Y(X('"',"string",true),j,h)}if(j.peek()=="%"){var g="string";var e=true;var i;if(j.match("%r")){g="string-2";i=j.next()}else{if(j.match("%w")){e=false;i=j.next()}else{if(j.match("%q")){e=false;i=j.next()}else{if(i=j.match(/^%([^\w\s=])/)){i=i[1]}else{if(j.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}}}}if(S.hasOwnProperty(i)){i=S[i]}return Y(X(i,g,e),j,h)}if(f=j.match(/^<<-('?)([A-Z]\w*)\1/)){return Y(P(f[2],!f[1]),j,h)}if(j.eat("'")){j.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);j.eat("'");return"atom"}if(j.eat("0")){if(j.eat("x")){j.match(/^[0-9a-fA-F]+/)}else{if(j.eat("o")){j.match(/^[0-7]+/)}else{if(j.eat("b")){j.match(/^[01]+/)}}}return"number"}if(j.eat(/^\d/)){j.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(j.match(a)){j.eat("=");return"operator"}if(j.match(V)||j.match(M)){return"operator"}if(f=j.match(/[({[]/,false)){f=f[0];return Y(D(f,S[f],null),j,h)}if(j.eat("\\")){j.next();return"meta"}j.next();return null}function D(e,h,g,f){return function(k,i){if(!f&&k.match(e)){i.tokenize[i.tokenize.length-1]=D(e,h,g,true);i.currentIndent+=1;return g}var j=H(k,i);if(k.current()===h){i.tokenize.pop();i.currentIndent-=1;j=g}return j}}function c(e,g,f){return function(i,h){if(!f&&i.match("{"+e)){h.currentIndent+=1;h.tokenize[h.tokenize.length-1]=c(e,g,true);return"meta"}if(i.match(g+"}")){h.currentIndent-=1;h.tokenize.pop();return"meta"}return H(i,h)}}function O(g,f){if(g.eatSpace()){return null}var e;if(e=g.match(L)){if(e=="def"){return"keyword"}g.eat(/[?!]/)}f.tokenize.pop();return"def"}function Q(f,e){if(f.eatSpace()){return null}if(f.match(L)){f.eat(/[!?]/)}else{f.match(a)||f.match(V)||f.match(F)}e.tokenize.pop();return"def"}function U(f,e){if(f.eatSpace()){return null}f.match(G);e.tokenize.pop();return"def"}function X(f,e,g){return function(k,j){var h=false;while(k.peek()){if(!h){if(k.match("{%",false)){j.tokenize.push(c("%","%"));return e}if(k.match("{{",false)){j.tokenize.push(c("{","}"));return e}if(g&&k.match("#{",false)){j.tokenize.push(D("#{","}","meta"));return e}var i=k.next();if(i==f){j.tokenize.pop();return e}h=g&&i=="\\"}else{k.next();h=false}}return e}}function P(e,f){return function(i,h){if(i.sol()){i.eatSpace();if(i.match(e)){h.tokenize.pop();return"string"}}var g=false;while(i.peek()){if(!g){if(i.match("{%",false)){h.tokenize.push(c("%","%"));return"string"}if(i.match("{{",false)){h.tokenize.push(c("{","}"));return"string"}if(f&&i.match("#{",false)){h.tokenize.push(D("#{","}","meta"));return"string"}g=f&&i.next()=="\\"}else{i.next();g=false}}return"string"}}return{startState:function(){return{tokenize:[H],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(h,g){var f=g.tokenize[g.tokenize.length-1](h,g);var e=h.current();if(f&&f!="comment"){g.lastToken=e;g.lastStyle=f}return f},indent:function(f,e){e=e.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(d.test(e)||R.test(e)){return Z.indentUnit*(f.currentIndent-1)}return Z.indentUnit*f.currentIndent},fold:"indent",electricInput:E(K.concat(C),true),lineComment:"#"}});A.defineMIME("text/x-crystal","crystal")});